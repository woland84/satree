(function(e,t){(function(e){var t={clone:function(e){if(e==null||typeof e!="object")return e;var n=new e.constructor;for(var r in e)n[r]=t.clone(e[r]);return n},exists:function(e){if(e===null||e===undefined){return false}return true},createClassObject:function(n,r,i,s,o,u){var a=n.split(".");var f=e;if(a.length>1){for(var l=0;l<a.length-1;l++){var c=a[l];if(!this.exists(f[c])){f[c]=new Object}f=f[c]}}var h=function(){for(var e in o){this["$"+e]=t.clone(o[e].value)}for(var n in u){this["_"+n]=t.clone(u[n])}if(t.exists(i)){for(var a in i.prototype){if(a.charAt(0)=="_"&&a.charAt(1)!="_"||a.charAt(0)=="$"){if(!i.prototype[a]instanceof Function){this[a]=t.clone(i.prototype[a])}}}}if(t.exists(s)){for(var f=0;f<s.length;f++){for(var l in s[f].internals){this["_"+l]=t.clone(s[f].internals[l])}for(var l in s[f].properties){this["$"+l]=t.clone(s[f].properties[l].value)}}}r.apply(this,arguments)};f[a[a.length-1]]=h;f=f[a[a.length-1]];return f},addPropertyToClass:function(e,t,n){var r=t.charAt(0).toUpperCase()+t.slice(1);e.prototype["$"+t]=n.value;e.prototype["get"+r]=this.exists(n.get)?n.get:function(){return this["$"+t]};e.prototype["set"+r]=this.exists(n.set)?n.set:function(e){this["$"+t]=e}},addPropertiesToClass:function(e,t){for(var n in t){if(t[n]instanceof Object){this.addPropertyToClass(e,n,t[n])}else{throw Error("The property should be an object, either {}, or something like {get : function(){}..}")}}},addStaticsToClass:function(e,t){for(var n in t){e[n]=t[n];e.prototype[n]=t[n]}},addMethodsToClass:function(e,t,n){for(var r in t){if(!n&&this.exists(e.prototype[r])&&e.hasOwnProperty(r)){continue}e.prototype[r]=t[r]}},checkNeedsInClass:function(e,t){for(var n in t.needs){var r=e.prototype[n];if(!this.exists(r)||!(r instanceof t.needs[n])){throw Error("Your class has not passed the traits checks. You need to fulfill this dependency: ["+n+":"+t.needs[n].name+"]")}}},addTraitsToClass:function(e,t){for(var n=0;n<t.length;n++){var r=t[n];this.checkNeedsInClass(e,r);if(this.exists(r.methods)){this.addMethodsToClass(e,r.methods);this.addInternalsToClass(e,r.internals);this.addPropertiesToClass(e,r.properties)}}},addInternalsToClass:function(e,t){for(var n in t){var r="_"+n;e.prototype[r]=t[n]}},extendClass:function(e,t){try{e.prototype=new t}catch(n){throw Error("The class that you are trying to extend throws a fatal error when calling the constructor."+"Please adjust it so that it won't throw an error if no parameters are passed.")}e.prototype.parent=t;e.prototype.constructor=e},createTrait:function(t,n){var r=t.split(".");var i=e;for(var s=0;s<r.length-1;s++){if(!this.exists(i[r[s]])){i[r[s]]=new Object}i=i[r[s]]}i[r[r.length-1]]=n;return i},addNeeds:function(e,t){e.__needs__=t},addMetaData:function(e,t,n,r){e.prototype.__meta__={name:t,"extends":n,"implements":r}}};var n={defineClass:function(e,n){if(t.exists(n["init"])){var r=t.createClassObject(e,n["init"],n["extends"],n["implements"],n["properties"],n["internals"])}else{throw Error("Your class should have one constructor. You might want to define a trait if you do not need a constructor.")}if(t.exists(n["extends"])){t.extendClass(r,n["extends"])}if(t.exists(n["methods"])){t.addMethodsToClass(r,n["methods"],true)}if(t.exists(n["properties"])){t.addPropertiesToClass(r,n["properties"])}if(t.exists(n["statics"])){t.addStaticsToClass(r,n["statics"])}if(t.exists(n["internals"])){t.addInternalsToClass(r,n["internals"])}if(t.exists(n["implements"])){var i=n["implements"];if(!i instanceof Array){i=[i]}t.addTraitsToClass(r,i)}t.addMetaData(r,e,n["extends"],n["implements"])},defineTrait:function(e,n){n.needs=n.needs?n.needs:{};n.properties=n.properties?n.properties:{};n.methods=n.methods?n.methods:{};var r=t.createTrait(e,n)}};e["FlancheJs"]=n})(window);(function(){window.$jit=function(e){e=e||window;for(var t in $jit){if($jit[t].$extend){e[t]=$jit[t]}}};$jit.version="2.0.1";var e=function(e){return document.getElementById(e)};e.empty=function(){};e.extend=function(e,t){for(var n in t||{}){e[n]=t[n]}return e};e.lambda=function(e){return typeof e=="function"?e:function(){return e}};e.time=Date.now||function(){return+(new Date)};e.splat=function(t){var n=e.type(t);return n?n!="array"?[t]:t:[]};e.type=function(t){var n=e.type.s.call(t).match(/^\[object\s(.*)\]$/)[1].toLowerCase();if(n!="object"){return n}if(t&&t.$$family){return t.$$family}return t&&t.nodeName&&t.nodeType==1?"element":n};e.type.s=Object.prototype.toString;e.each=function(t,n){var r=e.type(t);if(r=="object"){for(var i in t){n(t[i],i)}}else{for(var s=0,o=t.length;s<o;s++){n(t[s],s)}}};e.indexOf=function(e,t){if(Array.indexOf){return e.indexOf(t)}for(var n=0,r=e.length;n<r;n++){if(e[n]===t){return n}}return-1};e.map=function(t,n){var r=[];e.each(t,function(e,t){r.push(n(e,t))});return r};e.reduce=function(e,t,n){var r=e.length;if(r==0){return n}var i=arguments.length==3?n:e[--r];while(r--){i=t(i,e[r])}return i};e.merge=function(){var t={};for(var n=0,r=arguments.length;n<r;n++){var i=arguments[n];if(e.type(i)!="object"){continue}for(var s in i){var o=i[s],u=t[s];t[s]=u&&e.type(o)=="object"&&e.type(u)=="object"?e.merge(u,o):e.unlink(o)}}return t};e.unlink=function(t){var n;switch(e.type(t)){case"object":n={};for(var r in t){n[r]=e.unlink(t[r])}break;case"array":n=[];for(var i=0,s=t.length;i<s;i++){n[i]=e.unlink(t[i])}break;default:return t}return n};e.zip=function(){if(arguments.length===0){return[]}for(var e=0,t=[],n=arguments.length,r=arguments[0].length;e<r;e++){for(var i=0,s=[];i<n;i++){s.push(arguments[i][e])}t.push(s)}return t};e.rgbToHex=function(e,t){if(e.length<3){return null}if(e.length==4&&e[3]==0&&!t){return"transparent"}var n=[];for(var r=0;r<3;r++){var i=(e[r]-0).toString(16);n.push(i.length==1?"0"+i:i)}return t?n:"#"+n.join("")};e.hexToRgb=function(e){if(e.length!=7){e=e.match(/^#?(\w{1,2})(\w{1,2})(\w{1,2})$/);e.shift();if(e.length!=3){return null}var t=[];for(var n=0;n<3;n++){var r=e[n];if(r.length==1){r+=r}t.push(parseInt(r,16))}return t}else{e=parseInt(e.slice(1),16);return[e>>16,e>>8&255,e&255]}};e.destroy=function(t){e.clean(t);if(t.parentNode){t.parentNode.removeChild(t)}if(t.clearAttributes){t.clearAttributes()}};e.clean=function(t){for(var n=t.childNodes,r=0,i=n.length;r<i;r++){e.destroy(n[r])}};e.addEvent=function(e,t,n){if(e.addEventListener){e.addEventListener(t,n,false)}else{e.attachEvent("on"+t,n)}};e.addEvents=function(t,n){for(var r in n){e.addEvent(t,r,n[r])}};e.hasClass=function(e,t){return(" "+e.className+" ").indexOf(" "+t+" ")>-1};e.addClass=function(t,n){if(!e.hasClass(t,n)){t.className=t.className+" "+n}};e.removeClass=function(e,t){e.className=e.className.replace(new RegExp("(^|\\s)"+t+"(?:\\s|$)"),"$1")};e.getPos=function(e){function r(e){var t={x:0,y:0};while(e&&!s(e)){t.x+=e.offsetLeft;t.y+=e.offsetTop;e=e.offsetParent}return t}function i(e){var t={x:0,y:0};while(e&&!s(e)){t.x+=e.scrollLeft;t.y+=e.scrollTop;e=e.parentNode}return t}function s(e){return/^(?:body|html)$/i.test(e.tagName)}var t=r(e);var n=i(e);return{x:t.x-n.x,y:t.y-n.y}};e.event={get:function(e,t){t=t||window;return e||t.event},getWheel:function(e){return e.wheelDelta?e.wheelDelta/120:-(e.detail||0)/3},isRightClick:function(e){return e.which==3||e.button==2},getPos:function(e,t){t=t||window;e=e||t.event;var n=t.document;n=n.documentElement||n.body;if(e.touches&&e.touches.length){e=e.touches[0]}var r={x:e.pageX||e.clientX+n.scrollLeft,y:e.pageY||e.clientY+n.scrollTop};return r},stop:function(e){if(e.stopPropagation){e.stopPropagation()}e.cancelBubble=true;if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}}};$jit.util=$jit.id=e;var t=function(n){n=n||{};var r=function(){for(var n in this){if(typeof this[n]!="function"){this[n]=e.unlink(this[n])}}this.constructor=r;if(t.prototyping){return this}var i=this.initialize?this.initialize.apply(this,arguments):this;this.$$family="class";return i};for(var i in t.Mutators){if(!n[i]){continue}n=t.Mutators[i](n,n[i]);delete n[i]}e.extend(r,this);r.constructor=t;r.prototype=n;return r};t.Mutators={Implements:function(n,r){e.each(e.splat(r),function(e){t.prototyping=e;var r=typeof e=="function"?new e:e;for(var i in r){if(!(i in n)){n[i]=r[i]}}delete t.prototyping});return n}};e.extend(t,{inherit:function(n,r){for(var i in r){var s=r[i];var o=n[i];var u=e.type(s);if(o&&u=="function"){if(s!=o){t.override(n,i,s)}}else{if(u=="object"){n[i]=e.merge(o,s)}else{n[i]=s}}}return n},override:function(e,n,r){var i=t.prototyping;if(i&&e[n]!=i[n]){i=null}var s=function(){var t=this.parent;this.parent=i?i[n]:e[n];var s=r.apply(this,arguments);this.parent=t;return s};e[n]=s}});t.prototype.implement=function(){var n=this.prototype;e.each(Array.prototype.slice.call(arguments||[]),function(e){t.inherit(n,e)});return this};$jit.Class=t;$jit.json={prune:function(e,t){this.each(e,function(e,n){if(n==t&&e.children){delete e.children;e.children=[]}})},getParent:function(e,t){if(e.id==t){return false}var n=e.children;if(n&&n.length>0){for(var r=0;r<n.length;r++){if(n[r].id==t){return e}else{var i=this.getParent(n[r],t);if(i){return i}}}}return false},getSubtree:function(e,t){if(e.id==t){return e}for(var n=0,r=e.children;r&&n<r.length;n++){var i=this.getSubtree(r[n],t);if(i!=null){return i}}return null},eachLevel:function(e,t,n,r){if(t<=n){r(e,t);if(!e.children){return}for(var i=0,s=e.children;i<s.length;i++){this.eachLevel(s[i],t+1,n,r)}}},each:function(e,t){this.eachLevel(e,0,Number.MAX_VALUE,t)}};$jit.Trans={$extend:true,linear:function(e){return e}};var n=$jit.Trans;(function(){var t=function(t,n){n=e.splat(n);return e.extend(t,{easeIn:function(e){return t(e,n)},easeOut:function(e){return 1-t(1-e,n)},easeInOut:function(e){return e<=.5?t(2*e,n)/2:(2-t(2*(1-e),n))/2}})};var r={Pow:function(e,t){return Math.pow(e,t[0]||6)},Expo:function(e){return Math.pow(2,8*(e-1))},Circ:function(e){return 1-Math.sin(Math.acos(e))},Sine:function(e){return 1-Math.sin((1-e)*Math.PI/2)},Back:function(e,t){t=t[0]||1.618;return Math.pow(e,2)*((t+1)*e-t)},Bounce:function(e){var t;for(var n=0,r=1;1;n+=r,r/=2){if(e>=(7-4*n)/11){t=r*r-Math.pow((11-6*n-11*e)/4,2);break}}return t},Elastic:function(e,t){return Math.pow(2,10*--e)*Math.cos(20*e*Math.PI*(t[0]||1)/3)}};e.each(r,function(e,r){n[r]=t(e)});e.each(["Quad","Cubic","Quart","Quint"],function(e,r){n[e]=t(function(e){return Math.pow(e,[r+2])})})})();var r=new t({initialize:function(e){this.setOptions(e)},setOptions:function(t){var r={duration:2500,fps:40,transition:n.Quart.easeInOut,compute:e.empty,complete:e.empty,link:"ignore"};this.opt=e.merge(r,t||{});return this},step:function(){var t=e.time(),n=this.opt;if(t<this.time+n.duration){var r=n.transition((t-this.time)/n.duration);n.compute(r)}else{this.timer=clearInterval(this.timer);n.compute(1);n.complete()}},start:function(){if(!this.check()){return this}this.time=0;this.startTimer();return this},startTimer:function(){var t=this,n=this.opt.fps;if(this.timer){return false}this.time=e.time()-this.time;this.timer=setInterval(function(){t.step()},Math.round(1e3/n));return true},pause:function(){this.stopTimer();return this},resume:function(){this.startTimer();return this},stopTimer:function(){if(!this.timer){return false}this.time=e.time()-this.time;this.timer=clearInterval(this.timer);return true},check:function(){if(!this.timer){return true}if(this.opt.link=="cancel"){this.stopTimer();return true}return false}});var i=function(){var t=arguments;for(var n=0,r=t.length,s={};n<r;n++){var o=i[t[n]];if(o.$extend){e.extend(s,o)}else{s[t[n]]=o}}return s};i.AreaChart={$extend:true,animate:true,labelOffset:3,type:"stacked",Tips:{enable:false,onShow:e.empty,onHide:e.empty},Events:{enable:false,onClick:e.empty},selectOnHover:true,showAggregates:true,showLabels:true,filterOnClick:false,restoreOnRightClick:false};i.Margin={$extend:false,top:0,left:0,right:0,bottom:0};i.Canvas={$extend:true,injectInto:"id",type:"2D",width:false,height:false,useCanvas:false,withLabels:true,background:false,Scene:{Lighting:{enable:false,ambient:[1,1,1],directional:{direction:{x:-100,y:-100,z:-100},color:[.5,.3,.1]}}}};i.Tree={$extend:true,orientation:"top",subtreeOffset:8,siblingOffset:5,indent:10,multitree:false,align:"center"};i.Node={$extend:false,overridable:false,type:"circle",color:"#ccb",alpha:1,dim:3,height:20,width:90,autoHeight:false,autoWidth:false,lineWidth:1,transform:true,align:"center",angularWidth:1,span:1,CanvasStyles:{}};i.Edge={$extend:false,overridable:false,type:"line",color:"#ccb",lineWidth:1,dim:15,alpha:1,epsilon:7,CanvasStyles:{}};i.Fx={$extend:true,fps:40,duration:2500,transition:$jit.Trans.Quart.easeInOut,clearCanvas:true};i.Label={$extend:false,overridable:false,type:"HTML",style:" ",size:10,family:"sans-serif",textAlign:"center",textBaseline:"alphabetic",color:"#fff"};i.Tips={$extend:false,enable:false,type:"auto",offsetX:20,offsetY:20,force:false,onShow:e.empty,onHide:e.empty};i.NodeStyles={$extend:false,enable:false,type:"auto",stylesHover:false,stylesClick:false};i.Events={$extend:false,enable:false,enableForEdges:false,type:"auto",onClick:e.empty,onRightClick:e.empty,onMouseMove:e.empty,onMouseEnter:e.empty,onMouseLeave:e.empty,onDragStart:e.empty,onDragMove:e.empty,onDragCancel:e.empty,onDragEnd:e.empty,onTouchStart:e.empty,onTouchMove:e.empty,onTouchEnd:e.empty,onMouseWheel:e.empty};i.Navigation={$extend:false,enable:false,type:"auto",panning:false,zooming:false};i.Controller={$extend:true,onBeforeCompute:e.empty,onAfterCompute:e.empty,onCreateLabel:e.empty,onPlaceLabel:e.empty,onComplete:e.empty,onBeforePlotLine:e.empty,onAfterPlotLine:e.empty,onBeforePlotNode:e.empty,onAfterPlotNode:e.empty,request:false};var s={initialize:function(e,t){this.viz=t;this.canvas=t.canvas;this.config=t.config[e];this.nodeTypes=t.fx.nodeTypes;var n=this.config.type;this.dom=n=="auto"?t.config.Label.type!="Native":n!="Native";this.labelContainer=this.dom&&t.labels.getLabelContainer();this.isEnabled()&&this.initializePost()},initializePost:e.empty,setAsProperty:e.lambda(false),isEnabled:function(){return this.config.enable},isLabel:function(t,n,r){t=e.event.get(t,n);var i=this.labelContainer,s=t.target||t.srcElement,o=t.relatedTarget;if(r){return o&&o==this.viz.canvas.getCtx().canvas&&!!s&&this.isDescendantOf(s,i)}else{return this.isDescendantOf(s,i)}},isDescendantOf:function(e,t){while(e&&e.parentNode){if(e.parentNode==t){return e}e=e.parentNode}return false}};var o={onMouseUp:e.empty,onMouseDown:e.empty,onMouseMove:e.empty,onMouseOver:e.empty,onMouseOut:e.empty,onMouseWheel:e.empty,onTouchStart:e.empty,onTouchMove:e.empty,onTouchEnd:e.empty,onTouchCancel:e.empty};var u=new t({initialize:function(e){this.viz=e;this.canvas=e.canvas;this.node=false;this.edge=false;this.registeredObjects=[];this.attachEvents()},attachEvents:function(){var t=this.canvas.getElement(),n=this;t.oncontextmenu=e.lambda(false);e.addEvents(t,{mouseup:function(t,r){var i=e.event.get(t,r);n.handleEvent("MouseUp",t,r,n.makeEventObject(t,r),e.event.isRightClick(i))},mousedown:function(t,r){var i=e.event.get(t,r);n.handleEvent("MouseDown",t,r,n.makeEventObject(t,r),e.event.isRightClick(i))},mousemove:function(e,t){n.handleEvent("MouseMove",e,t,n.makeEventObject(e,t))},mouseover:function(e,t){n.handleEvent("MouseOver",e,t,n.makeEventObject(e,t))},mouseout:function(e,t){n.handleEvent("MouseOut",e,t,n.makeEventObject(e,t))},touchstart:function(e,t){n.handleEvent("TouchStart",e,t,n.makeEventObject(e,t))},touchmove:function(e,t){n.handleEvent("TouchMove",e,t,n.makeEventObject(e,t))},touchend:function(e,t){n.handleEvent("TouchEnd",e,t,n.makeEventObject(e,t))}});var r=function(t,r){var i=e.event.get(t,r);var s=e.event.getWheel(i);n.handleEvent("MouseWheel",t,r,s)};if(!document.getBoxObjectFor&&window.mozInnerScreenX==null){e.addEvent(t,"mousewheel",r)}else{t.addEventListener("DOMMouseScroll",r,false)}},register:function(e){this.registeredObjects.push(e)},handleEvent:function(){var e=Array.prototype.slice.call(arguments),t=e.shift();for(var n=0,r=this.registeredObjects,i=r.length;n<i;n++){r[n]["on"+t].apply(r[n],e)}},makeEventObject:function(t,n){var r=this,i=this.viz.graph,s=this.viz.fx,o=s.nodeTypes,u=s.edgeTypes;return{pos:false,node:false,edge:false,contains:false,getNodeCalled:false,getEdgeCalled:false,getPos:function(){var i=r.viz.canvas,s=i.getSize(),o=i.getPos(),u=i.translateOffsetX,a=i.translateOffsetY,f=i.scaleOffsetX,l=i.scaleOffsetY,c=e.event.getPos(t,n);this.pos={x:(c.x-o.x-s.width/2-u)*1/f,y:(c.y-o.y-s.height/2-a)*1/l};return this.pos},getNode:function(){if(this.getNodeCalled){return this.node}this.getNodeCalled=true;for(var e in i.nodes){var t=i.nodes[e],n=t&&o[t.getData("type")],u=n&&n.contains&&n.contains.call(s,t,this.getPos());if(u){this.contains=u;return r.node=this.node=t}}return r.node=this.node=false},getEdge:function(){if(this.getEdgeCalled){return this.edge}this.getEdgeCalled=true;var e={};for(var t in i.edges){var n=i.edges[t];e[t]=true;for(var o in n){if(o in e){continue}var a=n[o],f=a&&u[a.getData("type")],l=f&&f.contains&&f.contains.call(s,a,this.getPos());if(l){this.contains=l;return r.edge=this.edge=a}}}return r.edge=this.edge=false},getContains:function(){if(this.getNodeCalled){return this.contains}this.getNode();return this.contains}}}});var a={initializeExtras:function(){var t=new u(this),n=this;e.each(["NodeStyles","Tips","Navigation","Events"],function(e){var r=new a.Classes[e](e,n);if(r.isEnabled()){t.register(r)}if(r.setAsProperty()){n[e.toLowerCase()]=r}})}};a.Classes={};a.Classes.Events=new t({Implements:[s,o],initializePost:function(){this.fx=this.viz.fx;this.ntypes=this.viz.fx.nodeTypes;this.etypes=this.viz.fx.edgeTypes;this.hovered=false;this.pressed=false;this.touched=false;this.touchMoved=false;this.moved=false},setAsProperty:e.lambda(true),onMouseUp:function(t,n,r,i){var s=e.event.get(t,n);if(!this.moved){if(i){this.config.onRightClick(this.hovered,r,s)}else{this.config.onClick(this.pressed,r,s)}}if(this.pressed){if(this.moved){this.config.onDragEnd(this.pressed,r,s)}else{this.config.onDragCancel(this.pressed,r,s)}this.pressed=this.moved=false}},onMouseOut:function(t,n,r){var i=e.event.get(t,n),s;if(this.dom&&(s=this.isLabel(t,n,true))){this.config.onMouseLeave(this.viz.graph.getNode(s.id),r,i);this.hovered=false;return}var o=i.relatedTarget,u=this.canvas.getElement();while(o&&o.parentNode){if(u==o.parentNode){return}o=o.parentNode}if(this.hovered){this.config.onMouseLeave(this.hovered,r,i);this.hovered=false}},onMouseOver:function(t,n,r){var i=e.event.get(t,n),s;if(this.dom&&(s=this.isLabel(t,n,true))){this.hovered=this.viz.graph.getNode(s.id);this.config.onMouseEnter(this.hovered,r,i)}},onMouseMove:function(t,n,r){var i,s=e.event.get(t,n);if(this.pressed){this.moved=true;this.config.onDragMove(this.pressed,r,s);return}if(this.dom){this.config.onMouseMove(this.hovered,r,s)}else{if(this.hovered){var o=this.hovered;var u=o.nodeFrom?this.etypes[o.getData("type")]:this.ntypes[o.getData("type")];var a=u&&u.contains&&u.contains.call(this.fx,o,r.getPos());if(a){this.config.onMouseMove(o,r,s);return}else{this.config.onMouseLeave(o,r,s);this.hovered=false}}if(this.hovered=r.getNode()||this.config.enableForEdges&&r.getEdge()){this.config.onMouseEnter(this.hovered,r,s)}else{this.config.onMouseMove(false,r,s)}}},onMouseWheel:function(t,n,r){this.config.onMouseWheel(r,e.event.get(t,n))},onMouseDown:function(t,n,r){var i=e.event.get(t,n),s;if(this.dom){if(s=this.isLabel(t,n)){this.pressed=this.viz.graph.getNode(s.id)}}else{this.pressed=r.getNode()||this.config.enableForEdges&&r.getEdge()}this.pressed&&this.config.onDragStart(this.pressed,r,i)},onTouchStart:function(t,n,r){var i=e.event.get(t,n),s;if(this.dom&&(s=this.isLabel(t,n))){this.touched=this.viz.graph.getNode(s.id)}else{this.touched=r.getNode()||this.config.enableForEdges&&r.getEdge()}this.touched&&this.config.onTouchStart(this.touched,r,i)},onTouchMove:function(t,n,r){var i=e.event.get(t,n);if(this.touched){this.touchMoved=true;this.config.onTouchMove(this.touched,r,i)}},onTouchEnd:function(t,n,r){var i=e.event.get(t,n);if(this.touched){if(this.touchMoved){this.config.onTouchEnd(this.touched,r,i)}else{this.config.onTouchCancel(this.touched,r,i)}this.touched=this.touchMoved=false}}});a.Classes.Tips=new t({Implements:[s,o],initializePost:function(){if(document.body){var t=e("_tooltip")||document.createElement("div");t.id="_tooltip";t.className="tip";e.extend(t.style,{position:"absolute",display:"none",zIndex:13e3});document.body.appendChild(t);this.tip=t;this.node=false}},setAsProperty:e.lambda(true),onMouseOut:function(t,n){var r=e.event.get(t,n);if(this.dom&&this.isLabel(t,n,true)){this.hide(true);return}var i=t.relatedTarget,s=this.canvas.getElement();while(i&&i.parentNode){if(s==i.parentNode){return}i=i.parentNode}this.hide(false)},onMouseOver:function(e,t){var n;if(this.dom&&(n=this.isLabel(e,t,false))){this.node=this.viz.graph.getNode(n.id);this.config.onShow(this.tip,this.node,n)}},onMouseMove:function(t,n,r){if(this.dom&&this.isLabel(t,n)){this.setTooltipPosition(e.event.getPos(t,n))}if(!this.dom){var i=r.getNode();if(!i){this.hide(true);return}if(this.config.force||!this.node||this.node.id!=i.id){this.node=i;this.config.onShow(this.tip,i,r.getContains())}this.setTooltipPosition(e.event.getPos(t,n))}},setTooltipPosition:function(e){var t=this.tip,n=t.style,r=this.config;n.display="";var i={height:document.body.clientHeight,width:document.body.clientWidth};var s={width:t.offsetWidth,height:t.offsetHeight};var o=r.offsetX,u=r.offsetY;n.top=(e.y+u+s.height>i.height?e.y-s.height-u:e.y+u)+"px";n.left=(e.x+s.width+o>i.width?e.x-s.width-o:e.x+o)+"px"},hide:function(e){this.tip.style.display="none";e&&this.config.onHide()}});a.Classes.NodeStyles=new t({Implements:[s,o],initializePost:function(){this.fx=this.viz.fx;this.types=this.viz.fx.nodeTypes;this.nStyles=this.config;this.nodeStylesOnHover=this.nStyles.stylesHover;this.nodeStylesOnClick=this.nStyles.stylesClick;this.hoveredNode=false;this.fx.nodeFxAnimation=new r;this.down=false;this.move=false},onMouseOut:function(e,t){this.down=this.move=false;if(!this.hoveredNode){return}if(this.dom&&this.isLabel(e,t,true)){this.toggleStylesOnHover(this.hoveredNode,false)}var n=e.relatedTarget,r=this.canvas.getElement();while(n&&n.parentNode){if(r==n.parentNode){return}n=n.parentNode}this.toggleStylesOnHover(this.hoveredNode,false);this.hoveredNode=false},onMouseOver:function(e,t){var n;if(this.dom&&(n=this.isLabel(e,t,true))){var r=this.viz.graph.getNode(n.id);if(r.selected){return}this.hoveredNode=r;this.toggleStylesOnHover(this.hoveredNode,true)}},onMouseDown:function(e,t,n,r){if(r){return}var i;if(this.dom&&(i=this.isLabel(e,t))){this.down=this.viz.graph.getNode(i.id)}else{if(!this.dom){this.down=n.getNode()}}this.move=false},onMouseUp:function(e,t,n,r){if(r){return}if(!this.move){this.onClick(n.getNode())}this.down=this.move=false},getRestoredStyles:function(e,t){var n={},r=this["nodeStylesOn"+t];for(var i in r){n[i]=e.styles["$"+i]}return n},toggleStylesOnHover:function(e,t){if(this.nodeStylesOnHover){this.toggleStylesOn("Hover",e,t)}},toggleStylesOnClick:function(e,t){if(this.nodeStylesOnClick){this.toggleStylesOn("Click",e,t)}},toggleStylesOn:function(t,r,i){var s=this.viz;var o=this.nStyles;if(i){var u=this;if(!r.styles){r.styles=e.merge(r.data,{})}for(var a in this["nodeStylesOn"+t]){var f="$"+a;if(!(f in r.styles)){r.styles[f]=r.getData(a)}}s.fx.nodeFx(e.extend({elements:{id:r.id,properties:u["nodeStylesOn"+t]},transition:n.Quart.easeOut,duration:300,fps:40},this.config))}else{var l=this.getRestoredStyles(r,t);s.fx.nodeFx(e.extend({elements:{id:r.id,properties:l},transition:n.Quart.easeOut,duration:300,fps:40},this.config))}},onClick:function(e){if(!e){return}var t=this.nodeStylesOnClick;if(!t){return}if(e.selected){this.toggleStylesOnClick(e,false);delete e.selected}else{this.viz.graph.eachNode(function(e){if(e.selected){for(var n in t){e.setData(n,e.styles["$"+n],"end")}delete e.selected}});this.toggleStylesOnClick(e,true);e.selected=true;delete e.hovered;this.hoveredNode=false}},onMouseMove:function(e,t,n){if(this.down){this.move=true}if(this.dom&&this.isLabel(e,t)){return}var r=this.nodeStylesOnHover;if(!r){return}if(!this.dom){if(this.hoveredNode){var i=this.types[this.hoveredNode.getData("type")];var s=i&&i.contains&&i.contains.call(this.fx,this.hoveredNode,n.getPos());if(s){return}}var o=n.getNode();if(!this.hoveredNode&&!o){return}if(o.hovered){return}if(o&&!o.selected){this.fx.nodeFxAnimation.stopTimer();this.viz.graph.eachNode(function(e){if(e.hovered&&!e.selected){for(var t in r){e.setData(t,e.styles["$"+t],"end")}delete e.hovered}});o.hovered=true;this.hoveredNode=o;this.toggleStylesOnHover(o,true)}else{if(this.hoveredNode&&!this.hoveredNode.selected){this.fx.nodeFxAnimation.stopTimer();this.toggleStylesOnHover(this.hoveredNode,false);delete this.hoveredNode.hovered;this.hoveredNode=false}}}}});a.Classes.Navigation=new t({Implements:[s,o],initializePost:function(){this.pos=false;this.pressed=false},onMouseWheel:function(t,n,r){if(!this.config.zooming){return}e.event.stop(e.event.get(t,n));var i=this.config.zooming/1e3,s=1+r*i;this.canvas.scale(s,s)},onMouseDown:function(e,t,n){if(!this.config.panning){return}if(this.config.panning=="avoid nodes"&&(this.dom?this.isLabel(e,t):n.getNode())){return}this.pressed=true;this.pos=n.getPos();var r=this.canvas,i=r.translateOffsetX,s=r.translateOffsetY,o=r.scaleOffsetX,u=r.scaleOffsetY;this.pos.x*=o;this.pos.x+=i;this.pos.y*=u;this.pos.y+=s},onMouseMove:function(e,t,n){if(!this.config.panning){return}if(!this.pressed){return}if(this.config.panning=="avoid nodes"&&(this.dom?this.isLabel(e,t):n.getNode())){return}var r=this.pos,i=n.getPos(),s=this.canvas,o=s.translateOffsetX,u=s.translateOffsetY,a=s.scaleOffsetX,f=s.scaleOffsetY;i.x*=a;i.y*=f;i.x+=o;i.y+=u;var l=i.x-r.x,c=i.y-r.y;this.pos=i;this.canvas.translate(l*1/a,c*1/f)},onMouseUp:function(e,t,n,r){if(!this.config.panning){return}this.pressed=false}});var f;(function(){function i(t,n){var i=document.createElement(t);for(var s in n){if(typeof n[s]=="object"){e.extend(i[s],n[s])}else{i[s]=n[s]}}if(t=="canvas"&&!r&&G_vmlCanvasManager){i=G_vmlCanvasManager.initElement(document.body.appendChild(i))}return i}var n=typeof HTMLCanvasElement,r=n=="object"||n=="function";$jit.Canvas=f=new t({canvases:[],pos:false,element:false,labelContainer:false,translateOffsetX:0,translateOffsetY:0,scaleOffsetX:1,scaleOffsetY:1,initialize:function(t,n){this.viz=t;this.opt=this.config=n;var r=e.type(n.injectInto)=="string"?n.injectInto:n.injectInto.id,s=n.type,o=r+"-label",u=e(r),a=n.width||u.offsetWidth,l=n.height||u.offsetHeight;this.id=r;var c={injectInto:r,width:a,height:l};this.element=i("div",{id:r+"-canvaswidget",style:{position:"relative",width:a+"px",height:l+"px"}});this.labelContainer=this.createLabelContainer(n.Label.type,o,c);this.canvases.push(new f.Base[s]({config:e.extend({idSuffix:"-canvas"},c),plot:function(e){t.fx.plot()},resize:function(){t.refresh()}}));var h=n.background;if(h){var p=new f.Background[h.type](t,e.extend(h,c));this.canvases.push(new f.Base[s](p))}var d=this.canvases.length;while(d--){this.element.appendChild(this.canvases[d].canvas);if(d>0){this.canvases[d].plot()}}this.element.appendChild(this.labelContainer);u.appendChild(this.element);var v=null,m=this;e.addEvent(window,"scroll",function(){clearTimeout(v);v=setTimeout(function(){m.getPos(true)},500)})},getCtx:function(e){return this.canvases[e||0].getCtx()},getConfig:function(){return this.opt},getElement:function(){return this.element},getSize:function(e){return this.canvases[e||0].getSize()},resize:function(e,t){this.getPos(true);this.translateOffsetX=this.translateOffsetY=0;this.scaleOffsetX=this.scaleOffsetY=1;for(var n=0,r=this.canvases.length;n<r;n++){this.canvases[n].resize(e,t)}var i=this.element.style;i.width=e+"px";i.height=t+"px";if(this.labelContainer){this.labelContainer.style.width=e+"px"}},translate:function(e,t,n){this.translateOffsetX+=e*this.scaleOffsetX;this.translateOffsetY+=t*this.scaleOffsetY;for(var r=0,i=this.canvases.length;r<i;r++){this.canvases[r].translate(e,t,n)}},scale:function(e,t,n){var r=this.scaleOffsetX*e,i=this.scaleOffsetY*t;var s=this.translateOffsetX*(e-1)/r,o=this.translateOffsetY*(t-1)/i;this.scaleOffsetX=r;this.scaleOffsetY=i;for(var u=0,a=this.canvases.length;u<a;u++){this.canvases[u].scale(e,t,true)}this.translate(s,o,false)},getPos:function(t){if(t||!this.pos){return this.pos=e.getPos(this.getElement())}return this.pos},clear:function(e){this.canvases[e||0].clear()},path:function(e,t){var n=this.canvases[0].getCtx();n.beginPath();t(n);n[e]();n.closePath()},createLabelContainer:function(e,t,n){var r="http://www.w3.org/2000/svg";if(e=="HTML"||e=="Native"){return i("div",{id:t,style:{overflow:"visible",position:"absolute",top:0,left:0,width:n.width+"px",height:0}})}else{if(e=="SVG"){var s=document.createElementNS(r,"svg:svg");s.setAttribute("width",n.width);s.setAttribute("height",n.height);var o=s.style;o.position="absolute";o.left=o.top="0px";var u=document.createElementNS(r,"svg:g");u.setAttribute("width",n.width);u.setAttribute("height",n.height);u.setAttribute("x",0);u.setAttribute("y",0);u.setAttribute("id",t);s.appendChild(u);return s}}}});f.Base={};f.Base["2D"]=new t({translateOffsetX:0,translateOffsetY:0,scaleOffsetX:1,scaleOffsetY:1,initialize:function(e){this.viz=e;this.opt=e.config;this.size=false;this.createCanvas();this.translateToCenter()},createCanvas:function(){var e=this.opt,t=e.width,n=e.height;this.canvas=i("canvas",{id:e.injectInto+e.idSuffix,width:t,height:n,style:{position:"absolute",top:0,left:0,width:t+"px",height:n+"px"}})},getCtx:function(){if(!this.ctx){return this.ctx=this.canvas.getContext("2d")}return this.ctx},getSize:function(){if(this.size){return this.size}var e=this.canvas;return this.size={width:e.width,height:e.height}},translateToCenter:function(e){var t=this.getSize(),n=e?t.width-e.width-this.translateOffsetX*2:t.width;height=e?t.height-e.height-this.translateOffsetY*2:t.height;var r=this.getCtx();e&&r.scale(1/this.scaleOffsetX,1/this.scaleOffsetY);r.translate(n/2,height/2)},resize:function(e,t){var n=this.getSize(),i=this.canvas,s=i.style;this.size=false;i.width=e;i.height=t;s.width=e+"px";s.height=t+"px";if(!r){this.translateToCenter(n)}else{this.translateToCenter()}this.translateOffsetX=this.translateOffsetY=0;this.scaleOffsetX=this.scaleOffsetY=1;this.clear();this.viz.resize(e,t,this)},translate:function(e,t,n){var r=this.scaleOffsetX,i=this.scaleOffsetY;this.translateOffsetX+=e*r;this.translateOffsetY+=t*i;this.getCtx().translate(e,t);!n&&this.plot()},scale:function(e,t,n){this.scaleOffsetX*=e;this.scaleOffsetY*=t;this.getCtx().scale(e,t);!n&&this.plot()},clear:function(){var e=this.getSize(),t=this.translateOffsetX,n=this.translateOffsetY,r=this.scaleOffsetX,i=this.scaleOffsetY;this.getCtx().clearRect((-e.width/2-t)*1/r,(-e.height/2-n)*1/i,e.width*1/r,e.height*1/i)},plot:function(){this.clear();this.viz.plot(this)}});f.Background={};f.Background.Circles=new t({initialize:function(t,n){this.viz=t;this.config=e.merge({idSuffix:"-bkcanvas",levelDistance:100,numberOfCircles:6,CanvasStyles:{},offset:0},n)},resize:function(e,t,n){this.plot(n)},plot:function(e){var t=e.canvas,n=e.getCtx(),r=this.config,i=r.CanvasStyles;for(var s in i){n[s]=i[s]}var o=r.numberOfCircles,u=r.levelDistance;for(var a=1;a<=o;a++){n.beginPath();n.arc(0,0,u*a,0,2*Math.PI,false);n.stroke();n.closePath()}}})})();var l=function(e,t){this.theta=e||0;this.rho=t||0};$jit.Polar=l;l.prototype={getc:function(e){return this.toComplex(e)},getp:function(){return this},set:function(e){e=e.getp();this.theta=e.theta;this.rho=e.rho},setc:function(e,t){this.rho=Math.sqrt(e*e+t*t);this.theta=Math.atan2(t,e);if(this.theta<0){this.theta+=Math.PI*2}},setp:function(e,t){this.theta=e;this.rho=t},clone:function(){return new l(this.theta,this.rho)},toComplex:function(e){var t=Math.cos(this.theta)*this.rho;var n=Math.sin(this.theta)*this.rho;if(e){return{x:t,y:n}}return new h(t,n)},add:function(e){return new l(this.theta+e.theta,this.rho+e.rho)},scale:function(e){return new l(this.theta,this.rho*e)},equals:function(e){return this.theta==e.theta&&this.rho==e.rho},$add:function(e){this.theta=this.theta+e.theta;this.rho+=e.rho;return this},$madd:function(e){this.theta=(this.theta+e.theta)%(Math.PI*2);this.rho+=e.rho;return this},$scale:function(e){this.rho*=e;return this},isZero:function(){var e=1e-4,t=Math.abs;return t(this.theta)<e&&t(this.rho)<e},interpolate:function(e,t){var n=Math.PI,r=n*2;var i=function(e){var t=e<0?e%r+r:e%r;return t};var s=this.theta,o=e.theta;var u,a=Math.abs(s-o);if(a==n){if(s>o){u=i(o+(s-r-o)*t)}else{u=i(o-r+(s-o)*t)}}else{if(a>=n){if(s>o){u=i(o+(s-r-o)*t)}else{u=i(o-r+(s-(o-r))*t)}}else{u=i(o+(s-o)*t)}}var f=(this.rho-e.rho)*t+e.rho;return{theta:u,rho:f}}};var c=function(e,t){return new l(e,t)};l.KER=c(0,0);var h=function(e,t){this.x=e||0;this.y=t||0};$jit.Complex=h;h.prototype={getc:function(){return this},getp:function(e){return this.toPolar(e)},set:function(e){e=e.getc(true);this.x=e.x;this.y=e.y},setc:function(e,t){this.x=e;this.y=t},setp:function(e,t){this.x=Math.cos(e)*t;this.y=Math.sin(e)*t},clone:function(){return new h(this.x,this.y)},toPolar:function(e){var t=this.norm();var n=Math.atan2(this.y,this.x);if(n<0){n+=Math.PI*2}if(e){return{theta:n,rho:t}}return new l(n,t)},norm:function(){return Math.sqrt(this.squaredNorm())},squaredNorm:function(){return this.x*this.x+this.y*this.y},add:function(e){return new h(this.x+e.x,this.y+e.y)},prod:function(e){return new h(this.x*e.x-this.y*e.y,this.y*e.x+this.x*e.y)},conjugate:function(){return new h(this.x,-this.y)},scale:function(e){return new h(this.x*e,this.y*e)},equals:function(e){return this.x==e.x&&this.y==e.y},$add:function(e){this.x+=e.x;this.y+=e.y;return this},$prod:function(e){var t=this.x,n=this.y;this.x=t*e.x-n*e.y;this.y=n*e.x+t*e.y;return this},$conjugate:function(){this.y=-this.y;return this},$scale:function(e){this.x*=e;this.y*=e;return this},$div:function(e){var t=this.x,n=this.y;var r=e.squaredNorm();this.x=t*e.x+n*e.y;this.y=n*e.x-t*e.y;return this.$scale(1/r)},isZero:function(){var e=1e-4,t=Math.abs;return t(this.x)<e&&t(this.y)<e}};var p=function(e,t){return new h(e,t)};h.KER=p(0,0);$jit.Graph=new t({initialize:function(t,n,r,i){var s={klass:h,Node:{}};this.Node=n;this.Edge=r;this.Label=i;this.opt=e.merge(s,t||{});this.nodes={};this.edges={};var o=this;this.nodeList={};for(var u in v){o.nodeList[u]=function(e){return function(){var t=Array.prototype.slice.call(arguments);o.eachNode(function(n){n[e].apply(n,t)})}}(u)}},getNode:function(e){if(this.hasNode(e)){return this.nodes[e]}return false},get:function(e){return this.getNode(e)},getByName:function(e){for(var t in this.nodes){var n=this.nodes[t];if(n.name==e){return n}}return false},getAdjacence:function(e,t){if(e in this.edges){return this.edges[e][t]}return false},addNode:function(t){if(!this.nodes[t.id]){var n=this.edges[t.id]={};this.nodes[t.id]=new d.Node(e.extend({id:t.id,name:t.name,data:e.merge(t.data||{},{}),adjacencies:n},this.opt.Node),this.opt.klass,this.Node,this.Edge,this.Label)}return this.nodes[t.id]},addAdjacence:function(e,t,n){if(!this.hasNode(e.id)){this.addNode(e)}if(!this.hasNode(t.id)){this.addNode(t)}e=this.nodes[e.id];t=this.nodes[t.id];if(!e.adjacentTo(t)){var r=this.edges[e.id]=this.edges[e.id]||{};var i=this.edges[t.id]=this.edges[t.id]||{};r[t.id]=i[e.id]=new d.Adjacence(e,t,n,this.Edge,this.Label);return r[t.id]}return this.edges[e.id][t.id]},removeNode:function(e){if(this.hasNode(e)){delete this.nodes[e];var t=this.edges[e];for(var n in t){delete this.edges[n][e]}delete this.edges[e]}},removeAdjacence:function(e,t){delete this.edges[e][t];delete this.edges[t][e]},hasNode:function(e){return e in this.nodes},empty:function(){this.nodes={};this.edges={}}});var d=$jit.Graph;var v;(function(){var t=function(e,t,n,r,i){var s;n=n||"current";e="$"+(e?e+"-":"");if(n=="current"){s=this.data}else{if(n=="start"){s=this.startData}else{if(n=="end"){s=this.endData}}}var o=e+t;if(r){return s[o]}if(!this.Config.overridable){return i[t]||0}return o in s?s[o]:o in this.data?this.data[o]:i[t]||0};var n=function(e,t,n,r){r=r||"current";e="$"+(e?e+"-":"");var i;if(r=="current"){i=this.data}else{if(r=="start"){i=this.startData}else{if(r=="end"){i=this.endData}}}i[e+t]=n};var r=function(t,n){t="$"+(t?t+"-":"");var r=this;e.each(n,function(e){var n=t+e;delete r.data[n];delete r.endData[n];delete r.startData[n]})};v={getData:function(e,n,r){return t.call(this,"",e,n,r,this.Config)},setData:function(e,t,r){n.call(this,"",e,t,r)},setDataset:function(t,n){t=e.splat(t);for(var r in n){for(var i=0,s=e.splat(n[r]),o=t.length;i<o;i++){this.setData(r,s[i],t[i])}}},removeData:function(){r.call(this,"",Array.prototype.slice.call(arguments))},getCanvasStyle:function(e,n,r){return t.call(this,"canvas",e,n,r,this.Config.CanvasStyles)},setCanvasStyle:function(e,t,r){n.call(this,"canvas",e,t,r)},setCanvasStyles:function(t,n){t=e.splat(t);for(var r in n){for(var i=0,s=e.splat(n[r]),o=t.length;i<o;i++){this.setCanvasStyle(r,s[i],t[i])}}},removeCanvasStyle:function(){r.call(this,"canvas",Array.prototype.slice.call(arguments))},getLabelData:function(e,n,r){return t.call(this,"label",e,n,r,this.Label)},setLabelData:function(e,t,r){n.call(this,"label",e,t,r)},setLabelDataset:function(t,n){t=e.splat(t);for(var r in n){for(var i=0,s=e.splat(n[r]),o=t.length;i<o;i++){this.setLabelData(r,s[i],t[i])}}},removeLabelData:function(){r.call(this,"label",Array.prototype.slice.call(arguments))}}})();d.Node=new t({initialize:function(t,n,r,i,s){var o={id:"",name:"",data:{},startData:{},endData:{},adjacencies:{},selected:false,drawn:false,exist:false,angleSpan:{begin:0,end:0},pos:new n,startPos:new n,endPos:new n};e.extend(this,e.extend(o,t));this.Config=this.Node=r;this.Edge=i;this.Label=s},adjacentTo:function(e){return e.id in this.adjacencies},getAdjacency:function(e){return this.adjacencies[e]},getPos:function(e){e=e||"current";if(e=="current"){return this.pos}else{if(e=="end"){return this.endPos}else{if(e=="start"){return this.startPos}}}},setPos:function(e,t){t=t||"current";var n;if(t=="current"){n=this.pos}else{if(t=="end"){n=this.endPos}else{if(t=="start"){n=this.startPos}}}n.set(e)}});d.Node.implement(v);d.Adjacence=new t({initialize:function(e,t,n,r,i){this.nodeFrom=e;this.nodeTo=t;this.data=n||{};this.startData={};this.endData={};this.Config=this.Edge=r;this.Label=i}});d.Adjacence.implement(v);d.Util={filter:function(t){if(!t||!(e.type(t)=="string")){return function(){return true}}var n=t.split(" ");return function(e){for(var t=0;t<n.length;t++){if(e[n[t]]){return false}}return true}},getNode:function(e,t){return e.nodes[t]},eachNode:function(e,t,n){var r=this.filter(n);for(var i in e.nodes){if(r(e.nodes[i])){t(e.nodes[i])}}},each:function(e,t,n){this.eachNode(e,t,n)},eachAdjacency:function(e,t,n){var r=e.adjacencies,i=this.filter(n);for(var s in r){var o=r[s];if(i(o)){if(o.nodeFrom!=e){var u=o.nodeFrom;o.nodeFrom=o.nodeTo;o.nodeTo=u}t(o,s)}}},computeLevels:function(e,t,n,r){n=n||0;var i=this.filter(r);this.eachNode(e,function(e){e._flag=false;e._depth=-1},r);var s=e.getNode(t);s._depth=n;var o=[s];while(o.length!=0){var u=o.pop();u._flag=true;this.eachAdjacency(u,function(e){var t=e.nodeTo;if(t._flag==false&&i(t)){if(t._depth<0){t._depth=u._depth+1+n}o.unshift(t)}},r)}},eachBFS:function(e,t,n,r){var i=this.filter(r);this.clean(e);var s=[e.getNode(t)];while(s.length!=0){var o=s.pop();o._flag=true;n(o,o._depth);this.eachAdjacency(o,function(e){var t=e.nodeTo;if(t._flag==false&&i(t)){t._flag=true;s.unshift(t)}},r)}},eachLevel:function(e,t,n,r,i){var s=e._depth,o=this.filter(i),u=this;n=n===false?Number.MAX_VALUE-s:n;(function a(e,t,n){var i=e._depth;if(i>=t&&i<=n&&o(e)){r(e,i)}if(i<n){u.eachAdjacency(e,function(e){var r=e.nodeTo;if(r._depth>i){a(r,t,n)}})}})(e,t+s,n+s)},eachSubgraph:function(e,t,n){this.eachLevel(e,0,false,t,n)},eachSubnode:function(e,t,n){this.eachLevel(e,1,1,t,n)},anySubnode:function(t,n,r){var i=false;n=n||e.lambda(true);var s=e.type(n)=="string"?function(e){return e[n]}:n;this.eachSubnode(t,function(e){if(s(e)){i=true}},r);return i},getSubnodes:function(t,n,r){var i=[],s=this;n=n||0;var o,u;if(e.type(n)=="array"){o=n[0];u=n[1]}else{o=n;u=Number.MAX_VALUE-t._depth}this.eachLevel(t,o,u,function(e){i.push(e)},r);return i},getParents:function(e){var t=[];this.eachAdjacency(e,function(n){var r=n.nodeTo;if(r._depth<e._depth){t.push(r)}});return t},isDescendantOf:function(e,t){if(e.id==t){return true}var n=this.getParents(e),r=false;for(var i=0;!r&&i<n.length;i++){r=r||this.isDescendantOf(n[i],t)}return r},clean:function(e){this.eachNode(e,function(e){e._flag=false})},getClosestNodeToOrigin:function(e,t,n){return this.getClosestNodeToPos(e,l.KER,t,n)},getClosestNodeToPos:function(e,t,n,r){var i=null;n=n||"current";t=t&&t.getc(true)||h.KER;var s=function(e,t){var n=e.x-t.x,r=e.y-t.y;return n*n+r*r};this.eachNode(e,function(e){i=i==null||s(e.getPos(n).getc(true),t)<s(i.getPos(n).getc(true),t)?e:i},r);return i}};e.each(["get","getNode","each","eachNode","computeLevels","eachBFS","clean","getClosestNodeToPos","getClosestNodeToOrigin"],function(e){d.prototype[e]=function(){return d.Util[e].apply(d.Util,[this].concat(Array.prototype.slice.call(arguments)))}});e.each(["eachAdjacency","eachLevel","eachSubgraph","eachSubnode","anySubnode","getSubnodes","getParents","isDescendantOf"],function(e){d.Node.prototype[e]=function(){return d.Util[e].apply(d.Util,[this].concat(Array.prototype.slice.call(arguments)))}});d.Op={options:{type:"nothing",duration:2e3,hideLabels:true,fps:30},initialize:function(e){this.viz=e},removeNode:function(t,n){var r=this.viz;var i=e.merge(this.options,r.controller,n);var s=e.splat(t);var o,u,a;switch(i.type){case"nothing":for(o=0;o<s.length;o++){r.graph.removeNode(s[o])}break;case"replot":this.removeNode(s,{type:"nothing"});r.labels.clearLabels();r.refresh(true);break;case"fade:seq":case"fade":u=this;for(o=0;o<s.length;o++){a=r.graph.getNode(s[o]);a.setData("alpha",0,"end")}r.fx.animate(e.merge(i,{modes:["node-property:alpha"],onComplete:function(){u.removeNode(s,{type:"nothing"});r.labels.clearLabels();r.reposition();r.fx.animate(e.merge(i,{modes:["linear"]}))}}));break;case"fade:con":u=this;for(o=0;o<s.length;o++){a=r.graph.getNode(s[o]);a.setData("alpha",0,"end");a.ignore=true}r.reposition();r.fx.animate(e.merge(i,{modes:["node-property:alpha","linear"],onComplete:function(){u.removeNode(s,{type:"nothing"});i.onComplete&&i.onComplete()}}));break;case"iter":u=this;r.fx.sequence({condition:function(){return s.length!=0},step:function(){u.removeNode(s.shift(),{type:"nothing"});r.labels.clearLabels()},onComplete:function(){i.onComplete&&i.onComplete()},duration:Math.ceil(i.duration/s.length)});break;default:this.doError()}},removeEdge:function(t,n){var r=this.viz;var i=e.merge(this.options,r.controller,n);var s=e.type(t[0])=="string"?[t]:t;var o,u,a;switch(i.type){case"nothing":for(o=0;o<s.length;o++){r.graph.removeAdjacence(s[o][0],s[o][1])}break;case"replot":this.removeEdge(s,{type:"nothing"});r.refresh(true);break;case"fade:seq":case"fade":u=this;for(o=0;o<s.length;o++){a=r.graph.getAdjacence(s[o][0],s[o][1]);if(a){a.setData("alpha",0,"end")}}r.fx.animate(e.merge(i,{modes:["edge-property:alpha"],onComplete:function(){u.removeEdge(s,{type:"nothing"});r.reposition();r.fx.animate(e.merge(i,{modes:["linear"]}))}}));break;case"fade:con":u=this;for(o=0;o<s.length;o++){a=r.graph.getAdjacence(s[o][0],s[o][1]);if(a){a.setData("alpha",0,"end");a.ignore=true}}r.reposition();r.fx.animate(e.merge(i,{modes:["edge-property:alpha","linear"],onComplete:function(){u.removeEdge(s,{type:"nothing"});i.onComplete&&i.onComplete()}}));break;case"iter":u=this;r.fx.sequence({condition:function(){return s.length!=0},step:function(){u.removeEdge(s.shift(),{type:"nothing"});r.labels.clearLabels()},onComplete:function(){i.onComplete()},duration:Math.ceil(i.duration/s.length)});break;default:this.doError()}},sum:function(t,n){var r=this.viz;var i=e.merge(this.options,r.controller,n),s=r.root;var o;r.root=n.id||r.root;switch(i.type){case"nothing":o=r.construct(t);o.eachNode(function(e){e.eachAdjacency(function(e){r.graph.addAdjacence(e.nodeFrom,e.nodeTo,e.data)})});break;case"replot":r.refresh(true);this.sum(t,{type:"nothing"});r.refresh(true);break;case"fade:seq":case"fade":case"fade:con":that=this;o=r.construct(t);var u=this.preprocessSum(o);var a=!u?["node-property:alpha"]:["node-property:alpha","edge-property:alpha"];r.reposition();if(i.type!="fade:con"){r.fx.animate(e.merge(i,{modes:["linear"],onComplete:function(){r.fx.animate(e.merge(i,{modes:a,onComplete:function(){i.onComplete()}}))}}))}else{r.graph.eachNode(function(e){if(e.id!=s&&e.pos.isZero()){e.pos.set(e.endPos);e.startPos.set(e.endPos)}});r.fx.animate(e.merge(i,{modes:["linear"].concat(a)}))}break;default:this.doError()}},morph:function(t,n,r){r=r||{};var i=this.viz;var s=e.merge(this.options,i.controller,n),o=i.root;var u;i.root=n.id||i.root;switch(s.type){case"nothing":u=i.construct(t);u.eachNode(function(e){var t=i.graph.hasNode(e.id);e.eachAdjacency(function(e){var t=!!i.graph.getAdjacence(e.nodeFrom.id,e.nodeTo.id);i.graph.addAdjacence(e.nodeFrom,e.nodeTo,e.data);if(t){var n=i.graph.getAdjacence(e.nodeFrom.id,e.nodeTo.id);for(var r in e.data||{}){n.data[r]=e.data[r]}}});if(t){var n=i.graph.getNode(e.id);for(var r in e.data||{}){n.data[r]=e.data[r]}}});i.graph.eachNode(function(e){e.eachAdjacency(function(e){if(!u.getAdjacence(e.nodeFrom.id,e.nodeTo.id)){i.graph.removeAdjacence(e.nodeFrom.id,e.nodeTo.id)}});if(!u.hasNode(e.id)){i.graph.removeNode(e.id)}});break;case"replot":i.labels.clearLabels(true);this.morph(t,{type:"nothing"});i.refresh(true);i.refresh(true);break;case"fade:seq":case"fade":case"fade:con":that=this;u=i.construct(t);var a="node-property"in r&&e.map(e.splat(r["node-property"]),function(e){return"$"+e});i.graph.eachNode(function(t){var n=u.getNode(t.id);if(!n){t.setData("alpha",1);t.setData("alpha",1,"start");t.setData("alpha",0,"end");t.ignore=true}else{var r=n.data;for(var i in r){if(a&&e.indexOf(a,i)>-1){t.endData[i]=r[i]}else{t.data[i]=r[i]}}}});i.graph.eachNode(function(e){if(e.ignore){return}e.eachAdjacency(function(e){if(e.nodeFrom.ignore||e.nodeTo.ignore){return}var t=u.getNode(e.nodeFrom.id);var n=u.getNode(e.nodeTo.id);if(!t.adjacentTo(n)){var e=i.graph.getAdjacence(t.id,n.id);f=true;e.setData("alpha",1);e.setData("alpha",1,"start");e.setData("alpha",0,"end")}})});var f=this.preprocessSum(u);var c=!f?["node-property:alpha"]:["node-property:alpha","edge-property:alpha"];c[0]=c[0]+("node-property"in r?":"+e.splat(r["node-property"]).join(":"):"");c[1]=(c[1]||"edge-property:alpha")+("edge-property"in r?":"+e.splat(r["edge-property"]).join(":"):"");if("label-property"in r){c.push("label-property:"+e.splat(r["label-property"]).join(":"))}if(i.reposition){i.reposition()}else{i.compute("end")}i.graph.eachNode(function(e){if(e.id!=o&&e.pos.getp().equals(l.KER)){e.pos.set(e.endPos);e.startPos.set(e.endPos)}});i.fx.animate(e.merge(s,{modes:[r.position||"polar"].concat(c),onComplete:function(){i.graph.eachNode(function(e){if(e.ignore){i.graph.removeNode(e.id)}});i.graph.eachNode(function(e){e.eachAdjacency(function(e){if(e.ignore){i.graph.removeAdjacence(e.nodeFrom.id,e.nodeTo.id)}})});s.onComplete()}}));break;default:}},contract:function(t,n){var r=this.viz;if(t.collapsed||!t.anySubnode(e.lambda(true))){return}n=e.merge(this.options,r.config,n||{},{modes:["node-property:alpha:span","linear"]});t.collapsed=true;(function i(e){e.eachSubnode(function(e){e.ignore=true;e.setData("alpha",0,n.type=="animate"?"end":"current");i(e)})})(t);if(n.type=="animate"){r.compute("end");if(r.rotated){r.rotate(r.rotated,"none",{property:"end"})}(function s(e){e.eachSubnode(function(e){e.setPos(t.getPos("end"),"end");s(e)})})(t);r.fx.animate(n)}else{if(n.type=="replot"){r.refresh()}}},expand:function(t,n){if(!("collapsed"in t)){return}var r=this.viz;n=e.merge(this.options,r.config,n||{},{modes:["node-property:alpha:span","linear"]});delete t.collapsed;(function i(e){e.eachSubnode(function(e){delete e.ignore;e.setData("alpha",1,n.type=="animate"?"end":"current");i(e)})})(t);if(n.type=="animate"){r.compute("end");if(r.rotated){r.rotate(r.rotated,"none",{property:"end"})}r.fx.animate(n)}else{if(n.type=="replot"){r.refresh()}}},preprocessSum:function(e){var t=this.viz;e.eachNode(function(e){if(!t.graph.hasNode(e.id)){t.graph.addNode(e);var n=t.graph.getNode(e.id);n.setData("alpha",0);n.setData("alpha",0,"start");n.setData("alpha",1,"end")}});var n=false;e.eachNode(function(e){e.eachAdjacency(function(e){var r=t.graph.getNode(e.nodeFrom.id);var i=t.graph.getNode(e.nodeTo.id);if(!r.adjacentTo(i)){var e=t.graph.addAdjacence(r,i,e.data);if(r.startAlpha==r.endAlpha&&i.startAlpha==i.endAlpha){n=true;e.setData("alpha",0);e.setData("alpha",0,"start");e.setData("alpha",1,"end")}}})});return n}};var m={none:{render:e.empty,contains:e.lambda(false)},circle:{render:function(e,t,n,r){var i=r.getCtx();i.beginPath();i.arc(t.x,t.y,n,0,Math.PI*2,true);i.closePath();i[e]()},contains:function(e,t,n){var r=e.x-t.x,i=e.y-t.y,s=r*r+i*i;return s<=n*n}},ellipse:{render:function(e,t,n,r,i){var s=i.getCtx(),o=1,u=1,a=1,f=1,l=0;if(n>r){l=n/2;u=r/n;f=n/r}else{l=r/2;o=n/r;a=r/n}s.save();s.scale(o,u);s.beginPath();s.arc(t.x*a,t.y*f,l,0,Math.PI*2,true);s.closePath();s[e]();s.restore()},contains:function(e,t,n,r){var i=0,s=1,o=1,u=0,a=0,f=0;if(n>r){i=n/2;o=r/n}else{i=r/2;s=n/r}u=(e.x-t.x)*(1/s);a=(e.y-t.y)*(1/o);f=u*u+a*a;return f<=i*i}},square:{render:function(e,t,n,r){r.getCtx()[e+"Rect"](t.x-n,t.y-n,2*n,2*n)},contains:function(e,t,n){return Math.abs(t.x-e.x)<=n&&Math.abs(t.y-e.y)<=n}},rectangle:{render:function(e,t,n,r,i){i.getCtx()[e+"Rect"](t.x-n/2,t.y-r/2,n,r)},contains:function(e,t,n,r){return Math.abs(t.x-e.x)<=n/2&&Math.abs(t.y-e.y)<=r/2}},triangle:{render:function(e,t,n,r){var i=r.getCtx(),s=t.x,o=t.y-n,u=s-n,a=t.y+n,f=s+n,l=a;i.beginPath();i.moveTo(s,o);i.lineTo(u,a);i.lineTo(f,l);i.closePath();i[e]()},contains:function(e,t,n){return m.circle.contains(e,t,n)}},star:{render:function(e,t,n,r){var i=r.getCtx(),s=Math.PI/5;i.save();i.translate(t.x,t.y);i.beginPath();i.moveTo(n,0);for(var o=0;o<9;o++){i.rotate(s);if(o%2==0){i.lineTo(n/.525731*.200811,0)}else{i.lineTo(n,0)}}i.closePath();i[e]();i.restore()},contains:function(e,t,n){return m.circle.contains(e,t,n)}}};var g={line:{render:function(e,t,n){var r=n.getCtx();r.beginPath();r.moveTo(e.x,e.y);r.lineTo(t.x,t.y);r.stroke()},contains:function(e,t,n,r){var i=Math.min,s=Math.max,o=i(e.x,t.x),u=s(e.x,t.x),a=i(e.y,t.y),f=s(e.y,t.y);if(n.x>=o&&n.x<=u&&n.y>=a&&n.y<=f){if(Math.abs(t.x-e.x)<=r){return true}var l=(t.y-e.y)/(t.x-e.x)*(n.x-e.x)+e.y;return Math.abs(l-n.y)<=r}return false}},arrow:{render:function(e,t,n,r,i){var s=i.getCtx();if(r){var o=e;e=t;t=o}var u=new h(t.x-e.x,t.y-e.y);u.$scale(n/u.norm());var a=new h(t.x-u.x,t.y-u.y),f=new h(-u.y/2,u.x/2),l=a.add(f),c=a.$add(f.$scale(-1));s.beginPath();s.moveTo(e.x,e.y);s.lineTo(t.x,t.y);s.stroke();s.beginPath();s.moveTo(l.x,l.y);s.lineTo(c.x,c.y);s.lineTo(t.x,t.y);s.closePath();s.fill()},contains:function(e,t,n,r){return g.line.contains(e,t,n,r)}},hyperline:{render:function(e,t,n,r){function f(e,t){var n=e.x*t.y-e.y*t.x,r=n;var i=e.squaredNorm(),s=t.squaredNorm();if(n==0){return{x:0,y:0,ratio:-1}}var o=(e.y*s-t.y*i+e.y-t.y)/n;var u=(t.x*i-e.x*s+t.x-e.x)/r;var a=-o/2;var f=-u/2;var l=(o*o+u*u)/4-1;if(l<0){return{x:0,y:0,ratio:-1}}var c=Math.sqrt(l);var h={x:a,y:f,ratio:c>1e3?-1:c,a:o,b:u};return h}function a(e,t){return e<t?e+Math.PI>t?false:true:t+Math.PI>e?true:false}var i=r.getCtx();var s=f(e,t);if(s.a>1e3||s.b>1e3||s.ratio<0){i.beginPath();i.moveTo(e.x*n,e.y*n);i.lineTo(t.x*n,t.y*n);i.stroke()}else{var o=Math.atan2(t.y-s.y,t.x-s.x);var u=Math.atan2(e.y-s.y,e.x-s.x);var a=a(o,u);i.beginPath();i.arc(s.x*n,s.y*n,s.ratio*n,o,u,a);i.stroke()}},contains:e.lambda(false)}};d.Plot={initialize:function(e,t){this.viz=e;this.config=e.config;this.node=e.config.Node;this.edge=e.config.Edge;this.animation=new r;this.nodeTypes=new t.Plot.NodeTypes;this.edgeTypes=new t.Plot.EdgeTypes;this.labels=e.labels},nodeHelper:m,edgeHelper:g,Interpolator:{map:{border:"color",color:"color",width:"number",height:"number",dim:"number",alpha:"number",lineWidth:"number",angularWidth:"number",span:"number",valueArray:"array-number",dimArray:"array-number"},canvas:{globalAlpha:"number",fillStyle:"color",strokeStyle:"color",lineWidth:"number",shadowBlur:"number",shadowColor:"color",shadowOffsetX:"number",shadowOffsetY:"number",miterLimit:"number"},label:{size:"number",color:"color"},compute:function(e,t,n){return e+(t-e)*n},moebius:function(e,t,n,r){var i=r.scale(-n);if(i.norm()<1){var s=i.x,o=i.y;var u=e.startPos.getc().moebiusTransformation(i);e.pos.setc(u.x,u.y);i.x=s;i.y=o}},linear:function(e,t,n){var r=e.startPos.getc(true);var i=e.endPos.getc(true);e.pos.setc(this.compute(r.x,i.x,n),this.compute(r.y,i.y,n))},polar:function(e,t,n){var r=e.startPos.getp(true);var i=e.endPos.getp();var s=i.interpolate(r,n);e.pos.setp(s.theta,s.rho)},number:function(e,t,n,r,i){var s=e[r](t,"start");var o=e[r](t,"end");e[i](t,this.compute(s,o,n))},color:function(t,n,r,i,s){var o=e.hexToRgb(t[i](n,"start"));var u=e.hexToRgb(t[i](n,"end"));var a=this.compute;var f=e.rgbToHex([parseInt(a(o[0],u[0],r)),parseInt(a(o[1],u[1],r)),parseInt(a(o[2],u[2],r))]);t[s](n,f)},"array-number":function(e,t,n,r,i){var s=e[r](t,"start"),o=e[r](t,"end"),u=[];for(var a=0,f=s.length;a<f;a++){var l=s[a],c=o[a];if(l.length){for(var h=0,p=l.length,d=[];h<p;h++){d.push(this.compute(l[h],c[h],n))}u.push(d)}else{u.push(this.compute(l,c,n))}}e[i](t,u)},node:function(e,t,n,r,i,s){r=this[r];if(t){var o=t.length;for(var u=0;u<o;u++){var a=t[u];this[r[a]](e,a,n,i,s)}}else{for(var a in r){this[r[a]](e,a,n,i,s)}}},edge:function(e,t,n,r,i,s){var o=e.adjacencies;for(var u in o){this["node"](o[u],t,n,r,i,s)}},"node-property":function(e,t,n){this["node"](e,t,n,"map","getData","setData")},"edge-property":function(e,t,n){this["edge"](e,t,n,"map","getData","setData")},"label-property":function(e,t,n){this["node"](e,t,n,"label","getLabelData","setLabelData")},"node-style":function(e,t,n){this["node"](e,t,n,"canvas","getCanvasStyle","setCanvasStyle")},"edge-style":function(e,t,n){this["edge"](e,t,n,"canvas","getCanvasStyle","setCanvasStyle")}},sequence:function(t){var n=this;t=e.merge({condition:e.lambda(false),step:e.empty,onComplete:e.empty,duration:200},t||{});var r=setInterval(function(){if(t.condition()){t.step()}else{clearInterval(r);t.onComplete()}n.viz.refresh(true)},t.duration)},prepare:function(t){var n=this.viz.graph,r={"node-property":{getter:"getData",setter:"setData"},"edge-property":{getter:"getData",setter:"setData"},"node-style":{getter:"getCanvasStyle",setter:"setCanvasStyle"},"edge-style":{getter:"getCanvasStyle",setter:"setCanvasStyle"}};var i={};if(e.type(t)=="array"){for(var s=0,o=t.length;s<o;s++){var u=t[s].split(":");i[u.shift()]=u}}else{for(var a in t){if(a=="position"){i[t.position]=[]}else{i[a]=e.splat(t[a])}}}n.eachNode(function(t){t.startPos.set(t.pos);e.each(["node-property","node-style"],function(e){if(e in i){var n=i[e];for(var s=0,o=n.length;s<o;s++){t[r[e].setter](n[s],t[r[e].getter](n[s]),"start")}}});e.each(["edge-property","edge-style"],function(e){if(e in i){var n=i[e];t.eachAdjacency(function(t){for(var i=0,s=n.length;i<s;i++){t[r[e].setter](n[i],t[r[e].getter](n[i]),"start")}})}})});return i},animate:function(t,n){t=e.merge(this.viz.config,t||{});var r=this,i=this.viz,s=i.graph,o=this.Interpolator,u=t.type==="nodefx"?this.nodeFxAnimation:this.animation;var a=this.prepare(t.modes);if(t.hideLabels){this.labels.hideLabels(true)}u.setOptions(e.extend(t,{$animating:false,compute:function(e){s.eachNode(function(t){for(var r in a){o[r](t,a[r],e,n)}});r.plot(t,this.$animating,e);this.$animating=true},complete:function(){if(t.hideLabels){r.labels.hideLabels(false)}r.plot(t);t.onComplete()}})).start()},nodeFx:function(t){var n=this.viz,r=n.graph,i=this.nodeFxAnimation,s=e.merge(this.viz.config,{elements:{id:false,properties:{}},reposition:false});t=e.merge(s,t||{},{onBeforeCompute:e.empty,onAfterCompute:e.empty});i.stopTimer();var o=t.elements.properties;if(!t.elements.id){r.eachNode(function(e){for(var t in o){e.setData(t,o[t],"end")}})}else{var u=e.splat(t.elements.id);e.each(u,function(e){var t=r.getNode(e);if(t){for(var n in o){t.setData(n,o[n],"end")}}})}var a=[];for(var f in o){a.push(f)}var l=["node-property:"+a.join(":")];if(t.reposition){l.push("linear");n.compute("end")}this.animate(e.merge(t,{modes:l,type:"nodefx"}))},plot:function(e,t){var n=this.viz,r=n.graph,i=n.canvas,s=n.root,o=this,u=i.getCtx(),a=Math.min,e=e||this.viz.controller;e.clearCanvas&&i.clear();var f=r.getNode(s);if(!f){return}var l=!!f.visited;r.eachNode(function(n){var r=n.getData("alpha");n.eachAdjacency(function(r){var s=r.nodeTo;if(!!s.visited===l&&n.drawn&&s.drawn){!t&&e.onBeforePlotLine(r);o.plotLine(r,i,t);!t&&e.onAfterPlotLine(r)}});if(n.drawn){!t&&e.onBeforePlotNode(n);o.plotNode(n,i,t);!t&&e.onAfterPlotNode(n)}if(!o.labelsHidden&&e.withLabels){if(n.drawn&&r>=.95){o.labels.plotLabel(i,n,e)}else{o.labels.hideLabel(n,false)}}n.visited=!l})},plotTree:function(e,t,n){var r=this,i=this.viz,s=i.canvas,o=this.config,u=s.getCtx();var a=e.getData("alpha");e.eachSubnode(function(i){if(t.plotSubtree(e,i)&&i.exist&&i.drawn){var o=e.getAdjacency(i.id);!n&&t.onBeforePlotLine(o);r.plotLine(o,s,n);!n&&t.onAfterPlotLine(o);r.plotTree(i,t,n)}});if(e.drawn){!n&&t.onBeforePlotNode(e);this.plotNode(e,s,n);!n&&t.onAfterPlotNode(e);if(!t.hideLabels&&t.withLabels&&a>=.95){this.labels.plotLabel(s,e,t)}else{this.labels.hideLabel(e,false)}}else{this.labels.hideLabel(e,true)}},plotNode:function(e,t,n){var r=e.getData("type"),i=this.node.CanvasStyles;if(r!="none"){var s=e.getData("lineWidth"),o=e.getData("color"),u=e.getData("alpha"),a=t.getCtx();a.save();a.lineWidth=s;a.fillStyle=a.strokeStyle=o;a.globalAlpha=u;for(var f in i){a[f]=e.getCanvasStyle(f)}this.nodeTypes[r].render.call(this,e,t,n);a.restore()}},plotLine:function(e,t,n){var r=e.getData("type"),i=this.edge.CanvasStyles;if(r!="none"){var s=e.getData("lineWidth"),o=e.getData("color"),u=t.getCtx(),a=e.nodeFrom,f=e.nodeTo;u.save();u.lineWidth=s;u.fillStyle=u.strokeStyle=o;u.globalAlpha=Math.min(a.getData("alpha"),f.getData("alpha"),e.getData("alpha"));for(var l in i){u[l]=e.getCanvasStyle(l)}this.edgeTypes[r].render.call(this,e,t,n);u.restore()}}};d.Plot3D=e.merge(d.Plot,{Interpolator:{linear:function(e,t,n){var r=e.startPos.getc(true);var i=e.endPos.getc(true);e.pos.setc(this.compute(r.x,i.x,n),this.compute(r.y,i.y,n),this.compute(r.z,i.z,n))}},plotNode:function(e,t){if(e.getData("type")=="none"){return}this.plotElement(e,t,{getAlpha:function(){return e.getData("alpha")}})},plotLine:function(e,t){if(e.getData("type")=="none"){return}this.plotElement(e,t,{getAlpha:function(){return Math.min(e.nodeFrom.getData("alpha"),e.nodeTo.getData("alpha"),e.getData("alpha"))}})},plotElement:function(t,n,r){var i=n.getCtx(),s=new Matrix4,o=n.config.Scene.Lighting,u=n.canvases[0],a=u.program,f=u.camera;if(!t.geometry){t.geometry=new(O3D[t.getData("type")])}t.geometry.update(t);if(!t.webGLVertexBuffer){var l=[],c=[],h=[],p=0,d=t.geometry;for(var v=0,m=d.vertices,g=d.faces,y=g.length;v<y;v++){var b=g[v],w=m[b.a],E=m[b.b],S=m[b.c],x=b.d?m[b.d]:false,T=b.normal;l.push(w.x,w.y,w.z);l.push(E.x,E.y,E.z);l.push(S.x,S.y,S.z);if(x){l.push(x.x,x.y,x.z)}h.push(T.x,T.y,T.z);h.push(T.x,T.y,T.z);h.push(T.x,T.y,T.z);if(x){h.push(T.x,T.y,T.z)}c.push(p,p+1,p+2);if(x){c.push(p,p+2,p+3);p+=4}else{p+=3}}t.webGLVertexBuffer=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,t.webGLVertexBuffer);i.bufferData(i.ARRAY_BUFFER,new Float32Array(l),i.STATIC_DRAW);t.webGLFaceBuffer=i.createBuffer();i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t.webGLFaceBuffer);i.bufferData(i.ELEMENT_ARRAY_BUFFER,new Uint16Array(c),i.STATIC_DRAW);t.webGLFaceCount=c.length;t.webGLNormalBuffer=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,t.webGLNormalBuffer);i.bufferData(i.ARRAY_BUFFER,new Float32Array(h),i.STATIC_DRAW)}s.multiply(f.matrix,t.geometry.matrix);i.uniformMatrix4fv(a.viewMatrix,false,s.flatten());i.uniformMatrix4fv(a.projectionMatrix,false,f.projectionMatrix.flatten());var N=Matrix4.makeInvert(s);N.$transpose();i.uniformMatrix4fv(a.normalMatrix,false,N.flatten());var C=e.hexToRgb(t.getData("color"));C.push(r.getAlpha());i.uniform4f(a.color,C[0]/255,C[1]/255,C[2]/255,C[3]);i.uniform1i(a.enableLighting,o.enable);if(o.enable){if(o.ambient){var k=o.ambient;i.uniform3f(a.ambientColor,k[0],k[1],k[2])}if(o.directional){var L=o.directional,C=L.color,A=L.direction,O=(new Vector3(A.x,A.y,A.z)).normalize().$scale(-1);i.uniform3f(a.lightingDirection,O.x,O.y,O.z);i.uniform3f(a.directionalColor,C[0],C[1],C[2])}}i.bindBuffer(i.ARRAY_BUFFER,t.webGLVertexBuffer);i.vertexAttribPointer(a.position,3,i.FLOAT,false,0,0);i.bindBuffer(i.ARRAY_BUFFER,t.webGLNormalBuffer);i.vertexAttribPointer(a.normal,3,i.FLOAT,false,0,0);i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t.webGLFaceBuffer);i.drawElements(i.TRIANGLES,t.webGLFaceCount,i.UNSIGNED_SHORT,0)}});d.Label={};d.Label.Native=new t({initialize:function(e){this.viz=e},plotLabel:function(e,t,n){var r=e.getCtx();var i=t.pos.getc(true);r.font=t.getLabelData("style")+" "+t.getLabelData("size")+"px "+t.getLabelData("family");r.textAlign=t.getLabelData("textAlign");r.fillStyle=r.strokeStyle=t.getLabelData("color");r.textBaseline=t.getLabelData("textBaseline");this.renderLabel(e,t,n)},renderLabel:function(e,t,n){var r=e.getCtx();var i=t.pos.getc(true);r.fillText(t.name,i.x,i.y+t.getData("height")/2)},hideLabel:e.empty,hideLabels:e.empty});d.Label.DOM=new t({labelsHidden:false,labelContainer:false,labels:{},getLabelContainer:function(){return this.labelContainer?this.labelContainer:this.labelContainer=document.getElementById(this.viz.config.labelContainer)},getLabel:function(e){return e in this.labels&&this.labels[e]!=null?this.labels[e]:this.labels[e]=document.getElementById(e)},hideLabels:function(e){var t=this.getLabelContainer();if(e){t.style.display="none"}else{t.style.display=""}this.labelsHidden=e},clearLabels:function(e){for(var t in this.labels){if(e||!this.viz.graph.hasNode(t)){this.disposeLabel(t);delete this.labels[t]}}},disposeLabel:function(e){var t=this.getLabel(e);if(t&&t.parentNode){t.parentNode.removeChild(t)}},hideLabel:function(t,n){t=e.splat(t);var r=n?"":"none",i,s=this;e.each(t,function(e){var t=s.getLabel(e.id);if(t){t.style.display=r}})},fitsInCanvas:function(e,t){var n=t.getSize();if(e.x>=n.width||e.x<0||e.y>=n.height||e.y<0){return false}return true}});d.Label.HTML=new t({Implements:d.Label.DOM,plotLabel:function(e,t,n){var r=t.id,i=this.getLabel(r);if(!i&&!(i=document.getElementById(r))){i=document.createElement("div");var s=this.getLabelContainer();i.id=r;i.className="node";i.style.position="absolute";n.onCreateLabel(i,t);s.appendChild(i);this.labels[t.id]=i}this.placeLabel(i,t,n)}});d.Label.SVG=new t({Implements:d.Label.DOM,plotLabel:function(e,t,n){var r=t.id,i=this.getLabel(r);if(!i&&!(i=document.getElementById(r))){var s="http://www.w3.org/2000/svg";i=document.createElementNS(s,"svg:text");var o=document.createElementNS(s,"svg:tspan");i.appendChild(o);var u=this.getLabelContainer();i.setAttribute("id",r);i.setAttribute("class","node");u.appendChild(i);n.onCreateLabel(i,t);this.labels[t.id]=i}this.placeLabel(i,t,n)}});d.Geom=new t({initialize:function(e){this.viz=e;this.config=e.config;this.node=e.config.Node;this.edge=e.config.Edge},translate:function(t,n){n=e.splat(n);this.viz.graph.eachNode(function(r){e.each(n,function(e){r.getPos(e).$add(t)})})},setRightLevelToShow:function(t,n,r){var i=this.getRightLevelToShow(t,n),s=this.viz.labels,o=e.merge({execShow:true,execHide:true,onHide:e.empty,onShow:e.empty},r||{});t.eachLevel(0,this.config.levelsToShow,function(e){var n=e._depth-t._depth;if(n>i){o.onHide(e);if(o.execHide){e.drawn=false;e.exist=false;s.hideLabel(e,false)}}else{o.onShow(e);if(o.execShow){e.exist=true}}});t.drawn=true},getRightLevelToShow:function(e,t){var n=this.config;var r=n.levelsToShow;var i=n.constrained;if(!i){return r}while(!this.treeFitsInCanvas(e,t,r)&&r>1){r--}return r}});var y={construct:function(t){var n=e.type(t)=="array";var r=new d(this.graphOptions,this.config.Node,this.config.Edge,this.config.Label);if(!n){(function(e,t){e.addNode(t);if(t.children){for(var n=0,r=t.children;n<r.length;n++){e.addAdjacence(t,r[n]);arguments.callee(e,r[n])}}})(r,t)}else{(function(t,n){var r=function(e){for(var r=0,i=n.length;r<i;r++){if(n[r].id==e){return n[r]}}var s={id:e,name:e};return t.addNode(s)};for(var i=0,s=n.length;i<s;i++){t.addNode(n[i]);var o=n[i].adjacencies;if(o){for(var u=0,a=o.length;u<a;u++){var f=o[u],l={};if(typeof o[u]!="string"){l=e.merge(f.data,{});f=f.nodeTo}t.addAdjacence(n[i],r(f),l)}}}})(r,t)}return r},loadJSON:function(t,n){this.json=t;if(this.labels&&this.labels.clearLabels){this.labels.clearLabels(true)}this.graph=this.construct(t);if(e.type(t)!="array"){this.root=t.id}else{this.root=t[n?n:0].id}},toJSON:function(e){e=e||"tree";if(e=="tree"){var t={};var n=this.graph.getNode(this.root);var t=function i(e){var t={};t.id=e.id;t.name=e.name;t.data=e.data;var n=[];e.eachSubnode(function(e){n.push(i(e))});t.children=n;return t}(n);return t}else{var t=[];var r=!!this.graph.getNode(this.root).visited;this.graph.eachNode(function(e){var n={};n.id=e.id;n.name=e.name;n.data=e.data;var i=[];e.eachAdjacency(function(e){var t=e.nodeTo;if(!!t.visited===r){var n={};n.nodeTo=t.id;n.data=e.data;i.push(n)}});n.adjacencies=i;t.push(n);e.visited=!r});return t}}};var b=$jit.Layouts={};var w={label:null,compute:function(t,n,r){this.initializeLabel(r);var i=this.label,s=i.style;t.eachNode(function(t){var n=t.getData("autoWidth"),r=t.getData("autoHeight");if(n||r){delete t.data.$width;delete t.data.$height;delete t.data.$dim;var o=t.getData("width"),u=t.getData("height");s.width=n?"auto":o+"px";s.height=r?"auto":u+"px";i.innerHTML=t.name;var a=i.offsetWidth,f=i.offsetHeight;var l=t.getData("type");if(e.indexOf(["circle","square","triangle","star"],l)===-1){t.setData("width",a);t.setData("height",f)}else{var c=a>f?a:f;t.setData("width",c);t.setData("height",c);t.setData("dim",c)}}})},initializeLabel:function(e){if(!this.label){this.label=document.createElement("div");document.body.appendChild(this.label)}this.setLabelStyles(e)},setLabelStyles:function(t){e.extend(this.label.style,{visibility:"hidden",position:"absolute",width:"auto",height:"auto"});this.label.className="jit-autoadjust-label"}};b.Tree=function(){function r(e,t,n,r,i){var s=t.Node;var o=t.multitree;if(s.overridable){var u=-1,a=-1;e.eachNode(function(e){if(e._depth==n&&(!o||"$orn"in e.data&&e.data.$orn==r)){var t=e.getData("width",i);var s=e.getData("height",i);u=u<t?t:u;a=a<s?s:a}});return{width:u<0?s.width:u,height:a<0?s.height:a}}else{return s}}function i(e,t,n,r){var i=r=="left"||r=="right"?"y":"x";e.getPos(t)[i]+=n}function s(t,r){var i=[];e.each(t,function(e){e=n.call(e);e[0]+=r;e[1]+=r;i.push(e)});return i}function o(e,t){if(e.length==0){return t}if(t.length==0){return e}var n=e.shift(),r=t.shift();return[[n[0],r[1]]].concat(o(e,t))}function u(e,t){t=t||[];if(e.length==0){return t}var n=e.pop();return u(e,o(n,t))}function a(e,t,n,r,i){if(e.length<=i||t.length<=i){return 0}var s=e[i][1],o=t[i][0];return Math.max(a(e,t,n,r,++i)+n,s-o+r)}function f(e,t,n){function r(e,i,u){if(i.length<=u){return[]}var f=i[u],l=a(e,f,t,n,0);return[l].concat(r(o(e,s(f,l)),i,++u))}return r([],e,0)}function l(e,t,r){function i(e,n,u){if(n.length<=u){return[]}var f=n[u],l=-a(f,e,t,r,0);return[l].concat(i(o(s(f,l),e),n,++u))}e=n.call(e);var u=i([],e.reverse(),0);return u.reverse()}function c(e,t,n,r){var i=f(e,t,n),s=l(e,t,n);if(r=="left"){s=i}else{if(r=="right"){i=s}}for(var o=0,u=[];o<i.length;o++){u[o]=(i[o]+s[o])/2}return u}function h(e,t,n,o,a){function S(t,l,h){var p=t.getData(g,n);var m=l||t.getData(y,n);var x=[],T=[],N=false;var C=m+o.levelDistance;t.eachSubnode(function(t){if(t.exist&&(!f||"$orn"in t.data&&t.data.$orn==a)){if(!N){N=r(e,o,t._depth,a,n)}var i=S(t,N[y],h+C);x.push(i.tree);T.push(i.extent)}});var k=c(T,w,b,E);for(var A=0,_=[],j=[];A<x.length;A++){i(x[A],n,k[A],a);j.push(s(T[A],k[A]))}var F=[[-p/2,p/2]].concat(u(j));t.getPos(n)[d]=0;if(a=="top"||a=="left"){t.getPos(n)[v]=h}else{t.getPos(n)[v]=-h}return{tree:t,extent:F}}var f=o.multitree;var l=["x","y"],h=["width","height"];var p=+(a=="left"||a=="right");var d=l[p],v=l[1-p];var m=o.Node;var g=h[p],y=h[1-p];var b=o.siblingOffset;var w=o.subtreeOffset;var E=o.align;S(t,false,0)}var n=Array.prototype.slice;return new t({compute:function(t,n){var r=t||"start";var i=this.graph.getNode(this.root);e.extend(i,{drawn:true,exist:true,selected:true});w.compute(this.graph,r,this.config);if(!!n||!("_depth"in i)){this.graph.computeLevels(this.root,0,"ignore")}this.computePositions(i,r)},computePositions:function(t,n){var r=this.config;var i=r.multitree;var s=r.align;var o=s!=="center"&&r.indent;var u=r.orientation;var a=i?["top","right","bottom","left"]:[u];var f=this;e.each(a,function(e){h(f.graph,t,n,f.config,e,n);var r=["x","y"][+(e=="left"||e=="right")];(function u(t){t.eachSubnode(function(a){if(a.exist&&(!i||"$orn"in a.data&&a.data.$orn==e)){a.getPos(n)[r]+=t.getPos(n)[r];if(o){a.getPos(n)[r]+=s=="left"?o:-o}u(a)}})})(t)})}})}();$jit.ST=function(){function r(e){e=e||this.clickedNode;if(!this.config.constrained){return[]}var t=this.geom;var r=this.graph;var i=this.canvas;var s=e._depth,o=[];r.eachNode(function(t){if(t.exist&&!t.selected){if(t.isDescendantOf(e.id)){if(t._depth<=s){o.push(t)}}else{o.push(t)}}});var u=t.getRightLevelToShow(e,i);e.eachLevel(u,u,function(e){if(e.exist&&!e.selected){o.push(e)}});for(var a=0;a<n.length;a++){var f=this.graph.getNode(n[a]);if(!f.isDescendantOf(e.id)){o.push(f)}}return o}function s(e){var t=[],n=this.config;e=e||this.clickedNode;this.clickedNode.eachLevel(0,n.levelsToShow,function(e){if(n.multitree&&!("$orn"in e.data)&&e.anySubnode(function(e){return e.exist&&!e.drawn})){t.push(e)}else{if(e.drawn&&!e.anySubnode("drawn")){t.push(e)}}});return t}var n=[];return new t({Implements:[y,a,b.Tree],initialize:function(t){var n=$jit.ST;var r={levelsToShow:2,levelDistance:30,constrained:true,Node:{type:"rectangle"},duration:700,offsetX:0,offsetY:0};this.controller=this.config=e.merge(i("Canvas","Fx","Tree","Node","Edge","Controller","Tips","NodeStyles","Events","Navigation","Label"),r,t);var s=this.config;if(s.useCanvas){this.canvas=s.useCanvas;this.config.labelContainer=this.canvas.id+"-label"}else{if(s.background){s.background=e.merge({type:"Circles"},s.background)}this.canvas=new f(this,s);this.config.labelContainer=(typeof s.injectInto=="string"?s.injectInto:s.injectInto.id)+"-label"}this.graphOptions={klass:h};this.graph=new d(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new n.Label[s.Label.type](this);this.fx=new n.Plot(this,n);this.op=new n.Op(this);this.group=new n.Group(this);this.geom=new n.Geom(this);this.clickedNode=null;this.initializeExtras()},plot:function(){this.fx.plot(this.controller)},switchPosition:function(e,t,n){var r=this.geom,i=this.fx,s=this;if(!i.busy){i.busy=true;this.contract({onComplete:function(){r.switchOrientation(e);s.compute("end",false);i.busy=false;if(t=="animate"){s.onClick(s.clickedNode.id,n)}else{if(t=="replot"){s.select(s.clickedNode.id,n)}}}},e)}},switchAlignment:function(e,t,n){this.config.align=e;if(t=="animate"){this.select(this.clickedNode.id,n)}else{if(t=="replot"){this.onClick(this.clickedNode.id,n)}}},addNodeInPath:function(e){n.push(e);this.select(this.clickedNode&&this.clickedNode.id||this.root)},clearNodesInPath:function(e){n.length=0;this.select(this.clickedNode&&this.clickedNode.id||this.root)},refresh:function(){this.reposition();this.select(this.clickedNode&&this.clickedNode.id||this.root)},reposition:function(){this.graph.computeLevels(this.root,0,"ignore");this.geom.setRightLevelToShow(this.clickedNode,this.canvas);this.graph.eachNode(function(e){if(e.exist){e.drawn=true}});this.compute("end")},requestNodes:function(t,n){var r=e.merge(this.controller,n),i=this.config.levelsToShow;if(r.request){var s=[],o=t._depth;t.eachLevel(0,i,function(e){if(e.drawn&&!e.anySubnode()){s.push(e);e._level=i-(e._depth-o)}});this.group.requestNodes(s,r)}else{r.onComplete()}},contract:function(t,n){var i=this.config.orientation;var s=this.geom,o=this.group;if(n){s.switchOrientation(n)}var u=r.call(this);if(n){s.switchOrientation(i)}o.contract(u,e.merge(this.controller,t))},move:function(t,n){this.compute("end",false);var r=n.Move,i={x:r.offsetX,y:r.offsetY};if(r.enable){this.geom.translate(t.endPos.add(i).$scale(-1),"end")}this.fx.animate(e.merge(this.controller,{modes:["linear"]},n))},expand:function(t,n){var r=s.call(this,t);this.group.expand(r,e.merge(this.controller,n))},selectPath:function(t){function i(t){if(t==null||t.selected){return}t.selected=true;e.each(r.group.getSiblings([t])[t.id],function(e){e.exist=true;e.drawn=true});var n=t.getParents();n=n.length>0?n[0]:null;i(n)}var r=this;this.graph.eachNode(function(e){e.selected=false});for(var s=0,o=[t.id].concat(n);s<o.length;s++){i(this.graph.getNode(o[s]))}},setRoot:function(e,t,n){function u(){if(this.config.multitree&&o.data.$orn){var t=o.data.$orn;var u={left:"right",right:"left",top:"bottom",bottom:"top"}[t];s.data.$orn=u;(function a(t){t.eachSubnode(function(t){if(t.id!=e){t.data.$orn=u;a(t)}})})(s);delete o.data.$orn}this.root=e;this.clickedNode=o;this.graph.computeLevels(this.root,0,"ignore");this.geom.setRightLevelToShow(o,i,{execHide:false,onShow:function(e){if(!e.drawn){e.drawn=true;e.setData("alpha",1,"end");e.setData("alpha",0);e.pos.setc(o.pos.x,o.pos.y)}}});this.compute("end");this.busy=true;this.fx.animate({modes:["linear","node-property:alpha"],onComplete:function(){r.busy=false;r.onClick(e,{onComplete:function(){n&&n.onComplete()}})}})}if(this.busy){return}this.busy=true;var r=this,i=this.canvas;var s=this.graph.getNode(this.root);var o=this.graph.getNode(e);delete s.data.$orns;if(t=="animate"){u.call(this);r.selectPath(o)}else{if(t=="replot"){u.call(this);this.select(this.root)}}},addSubtree:function(t,n,r){if(n=="replot"){this.op.sum(t,e.extend({type:"replot"},r||{}))}else{if(n=="animate"){this.op.sum(t,e.extend({type:"fade:seq"},r||{}))}}},removeSubtree:function(t,n,r,i){var s=this.graph.getNode(t),o=[];s.eachLevel(+!n,false,function(e){o.push(e.id)});if(r=="replot"){this.op.removeNode(o,e.extend({type:"replot"},i||{}))}else{if(r=="animate"){this.op.removeNode(o,e.extend({type:"fade:seq"},i||{}))}}},select:function(t,n){var i=this.group,o=this.geom;var u=this.graph.getNode(t),a=this.canvas;var f=this.graph.getNode(this.root);var l=e.merge(this.controller,n);var c=this;l.onBeforeCompute(u);this.selectPath(u);this.clickedNode=u;this.requestNodes(u,{onComplete:function(){i.hide(i.prepare(r.call(c)),l);o.setRightLevelToShow(u,a);c.compute("current");c.graph.eachNode(function(e){var t=e.pos.getc(true);e.startPos.setc(t.x,t.y);e.endPos.setc(t.x,t.y);e.visited=false});var e={x:l.offsetX,y:l.offsetY};c.geom.translate(u.endPos.add(e).$scale(-1),["start","current","end"]);i.show(s.call(c));c.plot();l.onAfterCompute(c.clickedNode);l.onComplete()}})},onClick:function(t,n){var r=this.canvas,i=this,s=this.geom,o=this.config;var u={Move:{enable:true,offsetX:o.offsetX||0,offsetY:o.offsetY||0},setRightLevelToShowConfig:false,onBeforeRequest:e.empty,onBeforeContract:e.empty,onBeforeMove:e.empty,onBeforeExpand:e.empty};var a=e.merge(this.controller,u,n);if(!this.busy){this.busy=true;var f=this.graph.getNode(t);this.selectPath(f,this.clickedNode);this.clickedNode=f;a.onBeforeCompute(f);a.onBeforeRequest(f);this.requestNodes(f,{onComplete:function(){a.onBeforeContract(f);i.contract({onComplete:function(){s.setRightLevelToShow(f,r,a.setRightLevelToShowConfig);a.onBeforeMove(f);i.move(f,{Move:a.Move,onComplete:function(){a.onBeforeExpand(f);i.expand(f,{onComplete:function(){i.busy=false;a.onAfterCompute(t);a.onComplete()}})}})}})}})}}})}();$jit.ST.$extend=true;$jit.ST.Op=new t({Implements:d.Op});$jit.ST.Group=new t({initialize:function(e){this.viz=e;this.canvas=e.canvas;this.config=e.config;this.animation=new r;this.nodes=null},requestNodes:function(e,t){var n=0,r=e.length,i={};var s=function(){t.onComplete()};var o=this.viz;if(r==0){s()}for(var u=0;u<r;u++){i[e[u].id]=e[u];t.request(e[u].id,e[u]._level,{onComplete:function(e,t){if(t&&t.children){t.id=e;o.op.sum(t,{type:"nothing"})}if(++n==r){o.graph.computeLevels(o.root,0);s()}}})}},contract:function(t,n){var r=this.viz;var i=this;t=this.prepare(t);this.animation.setOptions(e.merge(n,{$animating:false,compute:function(e){if(e==1){e=.99}i.plotStep(1-e,n,this.$animating);this.$animating="contract"},complete:function(){i.hide(t,n)}})).start()},hide:function(t,n){var r=this.viz;for(var i=0;i<t.length;i++){if(true||!n||!n.request){t[i].eachLevel(1,false,function(t){if(t.exist){e.extend(t,{drawn:false,exist:false})}})}else{var s=[];t[i].eachLevel(1,false,function(e){s.push(e.id)});r.op.removeNode(s,{type:"nothing"});r.labels.clearLabels()}}n.onComplete()},expand:function(t,n){var r=this;this.show(t);this.animation.setOptions(e.merge(n,{$animating:false,compute:function(e){r.plotStep(e,n,this.$animating);this.$animating="expand"},complete:function(){r.plotStep(undefined,n,false);n.onComplete()}})).start()},show:function(t){var n=this.config;this.prepare(t);e.each(t,function(e){if(n.multitree&&!("$orn"in e.data)){delete e.data.$orns;var t=" ";e.eachSubnode(function(e){if("$orn"in e.data&&t.indexOf(e.data.$orn)<0&&e.exist&&!e.drawn){t+=e.data.$orn+" "}});e.data.$orns=t}e.eachLevel(0,n.levelsToShow,function(e){if(e.exist){e.drawn=true}})})},prepare:function(e){this.nodes=this.getNodesWithChildren(e);return this.nodes},getNodesWithChildren:function(e){var t=[],n=this.config,r=this.viz.root;e.sort(function(e,t){return(e._depth<=t._depth)-(e._depth>=t._depth)});for(var i=0;i<e.length;i++){if(e[i].anySubnode("exist")){for(var s=i+1,o=false;!o&&s<e.length;s++){if(!n.multitree||"$orn"in e[s].data){o=o||e[i].isDescendantOf(e[s].id)}}if(!o){t.push(e[i])}}}return t},plotStep:function(t,n,r){var i=this.viz,s=this.config,o=i.canvas,u=o.getCtx(),a=this.nodes;var f,l;var c={};for(f=0;f<a.length;f++){l=a[f];c[l.id]=[];var h=s.multitree&&!("$orn"in l.data);var p=h&&l.data.$orns;l.eachSubgraph(function(e){if(h&&p&&p.indexOf(e.data.$orn)>0&&e.drawn){e.drawn=false;c[l.id].push(e)}else{if((!h||!p)&&e.drawn){e.drawn=false;c[l.id].push(e)}}});l.drawn=true}if(a.length>0){i.fx.plot()}for(f in c){e.each(c[f],function(e){e.drawn=true})}for(f=0;f<a.length;f++){l=a[f];u.save();i.fx.plotSubtree(l,n,t,r);u.restore()}},getSiblings:function(t){var n={};e.each(t,function(e){var t=e.getParents();if(t.length==0){n[e.id]=[e]}else{var r=[];t[0].eachSubnode(function(e){r.push(e)});n[e.id]=r}});return n}});$jit.ST.Geom=new t({Implements:d.Geom,switchOrientation:function(e){this.config.orientation=e},dispatch:function(){var e=Array.prototype.slice.call(arguments);var t=e.shift(),n=e.length;var r=function(e){return typeof e=="function"?e():e};if(n==2){return t=="top"||t=="bottom"?r(e[0]):r(e[1])}else{if(n==4){switch(t){case"top":return r(e[0]);case"right":return r(e[1]);case"bottom":return r(e[2]);case"left":return r(e[3])}}}return undefined},getSize:function(e,t){var n=e.data,r=this.config;var i=r.siblingOffset;var s=r.multitree&&"$orn"in n&&n.$orn||r.orientation;var o=e.getData("width")+i;var u=e.getData("height")+i;if(!t){return this.dispatch(s,u,o)}else{return this.dispatch(s,o,u)}},getTreeBaseSize:function(e,t,n){var r=this.getSize(e,true),i=0,s=this;if(n(t,e)){return r}if(t===0){return 0}e.eachSubnode(function(e){i+=s.getTreeBaseSize(e,t-1,n)});return(r>i?r:i)+this.config.subtreeOffset},getEdge:function(e,t,n){var r=function(t,n){return function(){return e.pos.add(new h(t,n))}};var i=this.node;var s=e.getData("width");var o=e.getData("height");if(t=="begin"){if(i.align=="center"){return this.dispatch(n,r(0,o/2),r(-s/2,0),r(0,-o/2),r(s/2,0))}else{if(i.align=="left"){return this.dispatch(n,r(0,o),r(0,0),r(0,0),r(s,0))}else{if(i.align=="right"){return this.dispatch(n,r(0,0),r(-s,0),r(0,-o),r(0,0))}else{throw"align: not implemented"}}}}else{if(t=="end"){if(i.align=="center"){return this.dispatch(n,r(0,-o/2),r(s/2,0),r(0,o/2),r(-s/2,0))}else{if(i.align=="left"){return this.dispatch(n,r(0,0),r(s,0),r(0,o),r(0,0))}else{if(i.align=="right"){return this.dispatch(n,r(0,-o),r(0,0),r(0,0),r(-s,0))}else{throw"align: not implemented"}}}}}},getScaledTreePosition:function(e,t){var n=this.node;var r=e.getData("width");var i=e.getData("height");var s=this.config.multitree&&"$orn"in e.data&&e.data.$orn||this.config.orientation;var o=function(n,r){return function(){return e.pos.add(new h(n,r)).$scale(1-t)}};if(n.align=="left"){return this.dispatch(s,o(0,i),o(0,0),o(0,0),o(r,0))}else{if(n.align=="center"){return this.dispatch(s,o(0,i/2),o(-r/2,0),o(0,-i/2),o(r/2,0))}else{if(n.align=="right"){return this.dispatch(s,o(0,0),o(-r,0),o(0,-i),o(0,0))}else{throw"align: not implemented"}}}},treeFitsInCanvas:function(e,t,n){var r=t.getSize();var i=this.config.multitree&&"$orn"in e.data&&e.data.$orn||this.config.orientation;var s=this.dispatch(i,r.width,r.height);var o=this.getTreeBaseSize(e,n,function(e,t){return e===0||!t.anySubnode()});return o<s}});$jit.ST.Plot=new t({Implements:d.Plot,plotSubtree:function(t,n,r,i){var s=this.viz,o=s.canvas,u=s.config;r=Math.min(Math.max(.001,r),1);if(r>=0){t.drawn=false;var a=o.getCtx();var f=s.geom.getScaledTreePosition(t,r);a.translate(f.x,f.y);a.scale(r,r)}this.plotTree(t,e.merge(n,{withLabels:true,hideLabels:!!r,plotSubtree:function(e,n){var r=u.multitree&&!("$orn"in t.data);var i=r&&t.getData("orns");return!r||i.indexOf(t.getData("orn"))>-1}}),i);if(r>=0){t.drawn=true}},getAlignedPos:function(e,t,n){var r=this.node;var i,s;if(r.align=="center"){i={x:e.x-t/2,y:e.y-n/2}}else{if(r.align=="left"){s=this.config.orientation;if(s=="bottom"||s=="top"){i={x:e.x-t/2,y:e.y}}else{i={x:e.x,y:e.y-n/2}}}else{if(r.align=="right"){s=this.config.orientation;if(s=="bottom"||s=="top"){i={x:e.x-t/2,y:e.y-n}}else{i={x:e.x-t,y:e.y-n/2}}}else{throw"align: not implemented"}}}return i},getOrientation:function(e){var t=this.config;var n=t.orientation;if(t.multitree){var r=e.nodeFrom;var i=e.nodeTo;n="$orn"in r.data&&r.data.$orn||"$orn"in i.data&&i.data.$orn}return n}});$jit.ST.Label={};$jit.ST.Label.Native=new t({Implements:d.Label.Native,renderLabel:function(e,t,n){var r=e.getCtx(),i=t.pos.getc(true),s=t.getData("width"),o=t.getData("height"),u=this.viz.fx.getAlignedPos(i,s,o);r.fillText(t.name,u.x+s/2,u.y+o/2)}});$jit.ST.Label.DOM=new t({Implements:d.Label.DOM,placeLabel:function(e,t,n){var r=t.pos.getc(true),i=this.viz.config,s=i.Node,o=this.viz.canvas,u=t.getData("width"),a=t.getData("height"),f=o.getSize(),l,c;var h=o.translateOffsetX,p=o.translateOffsetY,d=o.scaleOffsetX,v=o.scaleOffsetY,m=r.x*d+h,g=r.y*v+p;if(s.align=="center"){l={x:Math.round(m-u/2+f.width/2),y:Math.round(g-a/2+f.height/2)}}else{if(s.align=="left"){c=i.orientation;if(c=="bottom"||c=="top"){l={x:Math.round(m-u/2+f.width/2),y:Math.round(g+f.height/2)}}else{l={x:Math.round(m+f.width/2),y:Math.round(g-a/2+f.height/2)}}}else{if(s.align=="right"){c=i.orientation;if(c=="bottom"||c=="top"){l={x:Math.round(m-u/2+f.width/2),y:Math.round(g-a+f.height/2)}}else{l={x:Math.round(m-u+f.width/2),y:Math.round(g-a/2+f.height/2)}}}else{throw"align: not implemented"}}}var y=e.style;y.left=l.x+"px";y.top=l.y+"px";y.display=this.fitsInCanvas(l,o)?"":"none";n.onPlaceLabel(e,t)}});$jit.ST.Label.SVG=new t({Implements:[$jit.ST.Label.DOM,d.Label.SVG],initialize:function(e){this.viz=e}});$jit.ST.Label.HTML=new t({Implements:[$jit.ST.Label.DOM,d.Label.HTML],initialize:function(e){this.viz=e}});$jit.ST.Plot.NodeTypes=new t({none:{render:e.empty,contains:e.lambda(false)},circle:{render:function(e,t){var n=e.getData("dim"),r=this.getAlignedPos(e.pos.getc(true),n,n),i=n/2;this.nodeHelper.circle.render("fill",{x:r.x+i,y:r.y+i},i,t)},contains:function(e,t){var n=e.getData("dim"),r=this.getAlignedPos(e.pos.getc(true),n,n),i=n/2;this.nodeHelper.circle.contains({x:r.x+i,y:r.y+i},t,i)}},square:{render:function(e,t){var n=e.getData("dim"),r=n/2,i=this.getAlignedPos(e.pos.getc(true),n,n);this.nodeHelper.square.render("fill",{x:i.x+r,y:i.y+r},r,t)},contains:function(e,t){var n=e.getData("dim"),r=this.getAlignedPos(e.pos.getc(true),n,n),i=n/2;this.nodeHelper.square.contains({x:r.x+i,y:r.y+i},t,i)}},ellipse:{render:function(e,t){var n=e.getData("width"),r=e.getData("height"),i=this.getAlignedPos(e.pos.getc(true),n,r);this.nodeHelper.ellipse.render("fill",{x:i.x+n/2,y:i.y+r/2},n,r,t)},contains:function(e,t){var n=e.getData("width"),r=e.getData("height"),i=this.getAlignedPos(e.pos.getc(true),n,r);this.nodeHelper.ellipse.contains({x:i.x+n/2,y:i.y+r/2},t,n,r)}},rectangle:{render:function(e,t){var n=e.getData("width"),r=e.getData("height"),i=this.getAlignedPos(e.pos.getc(true),n,r);this.nodeHelper.rectangle.render("fill",{x:i.x+n/2,y:i.y+r/2},n,r,t)},contains:function(e,t){var n=e.getData("width"),r=e.getData("height"),i=this.getAlignedPos(e.pos.getc(true),n,r);this.nodeHelper.rectangle.contains({x:i.x+n/2,y:i.y+r/2},t,n,r)}}});$jit.ST.Plot.EdgeTypes=new t({none:e.empty,line:{render:function(e,t){var n=this.getOrientation(e),r=e.nodeFrom,i=e.nodeTo,s=r._depth<i._depth,o=this.viz.geom.getEdge(s?r:i,"begin",n),u=this.viz.geom.getEdge(s?i:r,"end",n);this.edgeHelper.line.render(o,u,t)},contains:function(e,t){var n=this.getOrientation(e),r=e.nodeFrom,i=e.nodeTo,s=r._depth<i._depth,o=this.viz.geom.getEdge(s?r:i,"begin",n),u=this.viz.geom.getEdge(s?i:r,"end",n);return this.edgeHelper.line.contains(o,u,t,this.edge.epsilon)}},arrow:{render:function(e,t){var n=this.getOrientation(e),r=e.nodeFrom,i=e.nodeTo,s=e.getData("dim"),o=this.viz.geom.getEdge(r,"begin",n),u=this.viz.geom.getEdge(i,"end",n),a=e.data.$direction,f=a&&a.length>1&&a[0]!=r.id;this.edgeHelper.arrow.render(o,u,s,f,t)},contains:function(e,t){var n=this.getOrientation(e),r=e.nodeFrom,i=e.nodeTo,s=r._depth<i._depth,o=this.viz.geom.getEdge(s?r:i,"begin",n),u=this.viz.geom.getEdge(s?i:r,"end",n);return this.edgeHelper.arrow.contains(o,u,t,this.edge.epsilon)}},"quadratic:begin":{render:function(e,t){var n=this.getOrientation(e);var r=e.nodeFrom,i=e.nodeTo,s=r._depth<i._depth,o=this.viz.geom.getEdge(s?r:i,"begin",n),u=this.viz.geom.getEdge(s?i:r,"end",n),a=e.getData("dim"),f=t.getCtx();f.beginPath();f.moveTo(o.x,o.y);switch(n){case"left":f.quadraticCurveTo(o.x+a,o.y,u.x,u.y);break;case"right":f.quadraticCurveTo(o.x-a,o.y,u.x,u.y);break;case"top":f.quadraticCurveTo(o.x,o.y+a,u.x,u.y);break;case"bottom":f.quadraticCurveTo(o.x,o.y-a,u.x,u.y);break}f.stroke()}},"quadratic:end":{render:function(e,t){var n=this.getOrientation(e);var r=e.nodeFrom,i=e.nodeTo,s=r._depth<i._depth,o=this.viz.geom.getEdge(s?r:i,"begin",n),u=this.viz.geom.getEdge(s?i:r,"end",n),a=e.getData("dim"),f=t.getCtx();f.beginPath();f.moveTo(o.x,o.y);switch(n){case"left":f.quadraticCurveTo(u.x-a,u.y,u.x,u.y);break;case"right":f.quadraticCurveTo(u.x+a,u.y,u.x,u.y);break;case"top":f.quadraticCurveTo(u.x,u.y-a,u.x,u.y);break;case"bottom":f.quadraticCurveTo(u.x,u.y+a,u.x,u.y);break}f.stroke()}},bezier:{render:function(e,t){var n=this.getOrientation(e),r=e.nodeFrom,i=e.nodeTo,s=r._depth<i._depth,o=this.viz.geom.getEdge(s?r:i,"begin",n),u=this.viz.geom.getEdge(s?i:r,"end",n),a=e.getData("dim"),f=t.getCtx();f.beginPath();f.moveTo(o.x,o.y);switch(n){case"left":f.bezierCurveTo(o.x+a,o.y,u.x-a,u.y,u.x,u.y);break;case"right":f.bezierCurveTo(o.x-a,o.y,u.x+a,u.y,u.x,u.y);break;case"top":f.bezierCurveTo(o.x,o.y+a,u.x,u.y-a,u.x,u.y);break;case"bottom":f.bezierCurveTo(o.x,o.y-a,u.x,u.y+a,u.x,u.y);break}f.stroke()}}});$jit.ST.Plot.NodeTypes.implement({"areachart-stacked":{render:function(t,n){var r=t.pos.getc(true),i=t.getData("width"),s=t.getData("height"),o=this.getAlignedPos(r,i,s),u=o.x,a=o.y,f=t.getData("stringArray"),l=t.getData("dimArray"),c=t.getData("valueArray"),h=e.reduce(c,function(e,t){return e+t[0]},0),p=e.reduce(c,function(e,t){return e+t[1]},0),d=t.getData("colorArray"),v=d.length,m=t.getData("config"),g=t.getData("gradient"),y=m.showLabels,b=m.showAggregates,w=m.Label,E=t.getData("prev");var S=n.getCtx(),x=t.getData("border");if(d&&l&&f){for(var T=0,N=l.length,C=0,k=0,L=0;T<N;T++){S.fillStyle=S.strokeStyle=d[T%v];S.save();if(g&&(l[T][0]>0||l[T][1]>0)){var A=C+l[T][0],O=k+l[T][1],M=Math.atan((O-A)/i),_=55;var D=S.createLinearGradient(u+i/2,a-(A+O)/2,u+i/2+_*Math.sin(M),a-(A+O)/2+_*Math.cos(M));var P=e.rgbToHex(e.map(e.hexToRgb(d[T%v].slice(1)),function(e){return e*.85>>0}));D.addColorStop(0,d[T%v]);D.addColorStop(1,P);S.fillStyle=D}S.beginPath();S.moveTo(u,a-C);S.lineTo(u+i,a-k);S.lineTo(u+i,a-k-l[T][1]);S.lineTo(u,a-C-l[T][0]);S.lineTo(u,a-C);S.fill();S.restore();if(x){var H=x.name==f[T];var B=H?.7:.8;var P=e.rgbToHex(e.map(e.hexToRgb(d[T%v].slice(1)),function(e){return e*B>>0}));S.strokeStyle=P;S.lineWidth=H?4:1;S.save();S.beginPath();if(x.index===0){S.moveTo(u,a-C);S.lineTo(u,a-C-l[T][0])}else{S.moveTo(u+i,a-k);S.lineTo(u+i,a-k-l[T][1])}S.stroke();S.restore()}C+=l[T][0]||0;k+=l[T][1]||0;if(l[T][0]>0){L+=c[T][0]||0}}if(E&&w.type=="Native"){S.save();S.beginPath();S.fillStyle=S.strokeStyle=w.color;S.font=w.style+" "+w.size+"px "+w.family;S.textAlign="center";S.textBaseline="middle";var j=b(t.name,h,p,t,L);if(j!==false){S.fillText(j!==true?j:L,u,a-C-m.labelOffset-w.size/2,i)}if(y(t.name,h,p,t)){S.fillText(t.name,u,a+w.size/2+m.labelOffset)}S.restore()}}},contains:function(e,t){var n=e.pos.getc(true),r=e.getData("width"),i=e.getData("height"),s=this.getAlignedPos(n,r,i),o=s.x,u=s.y,a=e.getData("dimArray"),f=t.x-o;if(t.x<o||t.x>o+r||t.y>u||t.y<u-i){return false}for(var l=0,c=a.length,h=u,p=u;l<c;l++){var d=a[l];h-=d[0];p-=d[1];var v=h+(p-h)*f/r;if(t.y>=v){var m=+(f>r/2);return{name:e.getData("stringArray")[l],color:e.getData("colorArray")[l],value:e.getData("valueArray")[l][m],index:m}}}return false}}});$jit.AreaChart=new t({st:null,colors:["#416D9C","#70A35E","#EBB056","#C74243","#83548B","#909291","#557EAA"],selected:{},busy:false,initialize:function(t){this.controller=this.config=e.merge(i("Canvas","Margin","Label","AreaChart"),{Label:{type:"Native"}},t);var n=this.config.showLabels,r=e.type(n),s=this.config.showAggregates,o=e.type(s);this.config.showLabels=r=="function"?n:e.lambda(n);this.config.showAggregates=o=="function"?s:e.lambda(s);this.initializeViz()},initializeViz:function(){var t=this.config,n=this,r=t.type.split(":")[0],i={};var s=new $jit.ST({injectInto:t.injectInto,width:t.width,height:t.height,orientation:"bottom",levelDistance:0,siblingOffset:0,subtreeOffset:0,withLabels:t.Label.type!="Native",useCanvas:t.useCanvas,Label:{type:t.Label.type},Node:{overridable:true,type:"areachart-"+r,align:"left",width:1,height:1},Edge:{type:"none"},Tips:{enable:t.Tips.enable,type:"Native",force:true,onShow:function(e,n,r){var i=r;t.Tips.onShow(e,i,n)}},Events:{enable:true,type:"Native",onClick:function(e,r,i){if(!t.filterOnClick&&!t.Events.enable){return}var s=r.getContains();if(s){t.filterOnClick&&n.filter(s.name)}t.Events.enable&&t.Events.onClick(s,r,i)},onRightClick:function(e,r,i){if(!t.restoreOnRightClick){return}n.restore()},onMouseMove:function(e,r,i){if(!t.selectOnHover){return}if(e){var s=r.getContains();n.select(e.id,s.name,s.index)}else{n.select(false,false,false)}}},onCreateLabel:function(n,r){var s=t.Label,o=r.getData("valueArray"),u=e.reduce(o,function(e,t){return e+t[0]},0),a=e.reduce(o,function(e,t){return e+t[1]},0);if(r.getData("prev")){var f={wrapper:document.createElement("div"),aggregate:document.createElement("div"),label:document.createElement("div")};var l=f.wrapper,c=f.label,h=f.aggregate,p=l.style,d=c.style,v=h.style;i[r.id]=f;l.appendChild(c);l.appendChild(h);if(!t.showLabels(r.name,u,a,r)){c.style.display="none"}if(!t.showAggregates(r.name,u,a,r)){h.style.display="none"}p.position="relative";p.overflow="visible";p.fontSize=s.size+"px";p.fontFamily=s.family;p.color=s.color;p.textAlign="center";v.position=d.position="absolute";n.style.width=r.getData("width")+"px";n.style.height=r.getData("height")+"px";c.innerHTML=r.name;n.appendChild(l)}},onPlaceLabel:function(n,r){if(!r.getData("prev")){return}var s=i[r.id],o=s.wrapper.style,u=s.label.style,a=s.aggregate.style,f=r.getData("width"),l=r.getData("height"),c=r.getData("dimArray"),h=r.getData("valueArray"),p=e.reduce(h,function(e,t){return e+t[0]},0),d=e.reduce(h,function(e,t){return e+t[1]},0),v=parseInt(o.fontSize,10),m=n.style;if(c&&h){if(t.showLabels(r.name,p,d,r)){u.display=""}else{u.display="none"}var g=t.showAggregates(r.name,p,d,r);if(g!==false){a.display=""}else{a.display="none"}o.width=a.width=u.width=n.style.width=f+"px";a.left=u.left=-f/2+"px";for(var y=0,b=h.length,w=0,E=0;y<b;y++){if(c[y][0]>0){w+=h[y][0];E+=c[y][0]}}a.top=-v-t.labelOffset+"px";u.top=t.labelOffset+E+"px";n.style.top=parseInt(n.style.top,10)-E+"px";n.style.height=o.height=E+"px";s.aggregate.innerHTML=g!==true?g:w}}});var o=s.canvas.getSize(),u=t.Margin;s.config.offsetY=-o.height/2+u.bottom+(t.showLabels&&t.labelOffset+t.Label.size);s.config.offsetX=(u.right-u.left)/2;this.delegate=s;this.canvas=this.delegate.canvas},loadJSON:function(t){var n=e.time(),r=[],i=this.delegate,s=e.splat(t.label),o=e.splat(t.color||this.colors),u=this.config,a=!!u.type.split(":")[1],f=u.animate;for(var l=0,c=t.values,h=c.length;l<h-1;l++){var p=c[l],d=c[l-1],v=c[l+1];var m=e.splat(c[l].values),g=e.splat(c[l+1].values);var y=e.zip(m,g);var b=0,w=0;r.push({id:n+p.label,name:p.label,data:{value:y,$valueArray:y,$colorArray:o,$stringArray:s,$next:v.label,$prev:d?d.label:false,$config:u,$gradient:a},children:[]})}var E={id:n+"$root",name:"",data:{$type:"none",$width:1,$height:1},children:r};i.loadJSON(E);this.normalizeDims();i.compute();i.select(i.root);if(f){i.fx.animate({modes:["node-property:height:dimArray"],duration:1500})}},updateJSON:function(t,n){if(this.busy){return}this.busy=true;var r=this.delegate,i=r.graph,s=t.label&&e.splat(t.label),o=t.values,u=this.config.animate,a=this,f={};for(var l=0,c=o.length;l<c;l++){f[o[l].label]=o[l]}i.eachNode(function(t){var n=f[t.name],r=t.getData("stringArray"),i=t.getData("valueArray"),o=t.getData("next");if(n){n.values=e.splat(n.values);e.each(i,function(e,t){e[0]=n.values[t];if(s){r[t]=s[t]}});t.setData("valueArray",i)}if(o){n=f[o];if(n){e.each(i,function(e,t){e[1]=n.values[t]})}}});this.normalizeDims();r.compute();r.select(r.root);if(u){r.fx.animate({modes:["node-property:height:dimArray"],duration:1500,onComplete:function(){a.busy=false;n&&n.onComplete()}})}},filter:function(t,n){if(this.busy){return}this.busy=true;if(this.config.Tips.enable){this.delegate.tips.hide()}this.select(false,false,false);var r=e.splat(t);var i=this.delegate.graph.getNode(this.delegate.root);var s=this;this.normalizeDims();i.eachAdjacency(function(t){var n=t.nodeTo,i=n.getData("dimArray","end"),s=n.getData("stringArray");n.setData("dimArray",e.map(i,function(t,n){return e.indexOf(r,s[n])>-1?t:[0,0]}),"end")});this.delegate.fx.animate({modes:["node-property:dimArray"],duration:1500,onComplete:function(){s.busy=false;n&&n.onComplete()}})},restore:function(e){if(this.busy){return}this.busy=true;if(this.config.Tips.enable){this.delegate.tips.hide()}this.select(false,false,false);this.normalizeDims();var t=this;this.delegate.fx.animate({modes:["node-property:height:dimArray"],duration:1500,onComplete:function(){t.busy=false;e&&e.onComplete()}})},select:function(e,t,n){if(!this.config.selectOnHover){return}var r=this.selected;if(r.id!=e||r.name!=t||r.index!=n){r.id=e;r.name=t;r.index=n;this.delegate.graph.eachNode(function(e){e.setData("border",false)});if(e){var i=this.delegate.graph.getNode(e);i.setData("border",r);var s=n===0?"prev":"next";s=i.getData(s);if(s){i=this.delegate.graph.getByName(s);if(i){i.setData("border",{name:t,index:1-n})}}}this.delegate.plot()}},getLegend:function(){var t={};var n;this.delegate.graph.getNode(this.delegate.root).eachAdjacency(function(e){n=e.nodeTo});var r=n.getData("colorArray"),i=r.length;e.each(n.getData("stringArray"),function(e,n){t[e]=r[n%i]});return t},getMaxValue:function(){var t=0;this.delegate.graph.eachNode(function(n){var r=n.getData("valueArray"),i=0,s=0;e.each(r,function(e){i+=+e[0];s+=+e[1]});var o=s>i?s:i;t=t>o?t:o});return t},normalizeDims:function(){var t=this.delegate.graph.getNode(this.delegate.root),n=0;t.eachAdjacency(function(){n++});var r=this.getMaxValue()||1,i=this.delegate.canvas.getSize(),s=this.config,o=s.Margin,u=s.labelOffset+s.Label.size,a=(i.width-(o.left+o.right))/n,f=s.animate,l=i.height-(o.top+o.bottom)-(s.showAggregates&&u)-(s.showLabels&&u);this.delegate.graph.eachNode(function(t){var n=0,i=0,s=[];e.each(t.getData("valueArray"),function(e){n+=+e[0];i+=+e[1];s.push([0,0])});var o=i>n?i:n;t.setData("width",a);if(f){t.setData("height",o*l/r,"end");t.setData("dimArray",e.map(t.getData("valueArray"),function(e){return[e[0]*l/r,e[1]*l/r]}),"end");var u=t.getData("dimArray");if(!u){t.setData("dimArray",s)}}else{t.setData("height",o*l/r);t.setData("dimArray",e.map(t.getData("valueArray"),function(e){return[e[0]*l/r,e[1]*l/r]}))}})}});i.BarChart={$extend:true,animate:true,type:"stacked",labelOffset:3,barsOffset:0,hoveredColor:"#9fd4ff",orientation:"horizontal",showAggregates:true,showLabels:true,Tips:{enable:false,onShow:e.empty,onHide:e.empty},Events:{enable:false,onClick:e.empty}};$jit.ST.Plot.NodeTypes.implement({"barchart-stacked":{render:function(t,n){var r=t.pos.getc(true),i=t.getData("width"),s=t.getData("height"),o=this.getAlignedPos(r,i,s),u=o.x,a=o.y,f=t.getData("dimArray"),l=t.getData("valueArray"),c=t.getData("colorArray"),h=c.length,p=t.getData("stringArray");var d=n.getCtx(),v={},m=t.getData("border"),g=t.getData("gradient"),y=t.getData("config"),b=y.orientation=="horizontal",w=y.showAggregates,E=y.showLabels,S=y.Label;if(c&&f&&p){for(var x=0,T=f.length,N=0,C=0;x<T;x++){d.fillStyle=d.strokeStyle=c[x%h];if(g){var k;if(b){k=d.createLinearGradient(u+N+f[x]/2,a,u+N+f[x]/2,a+s)}else{k=d.createLinearGradient(u,a-N-f[x]/2,u+i,a-N-f[x]/2)}var L=e.rgbToHex(e.map(e.hexToRgb(c[x%h].slice(1)),function(e){return e*.5>>0}));k.addColorStop(0,L);k.addColorStop(.5,c[x%h]);k.addColorStop(1,L);d.fillStyle=k}if(b){d.fillRect(u+N,a,f[x],s)}else{d.fillRect(u,a-N-f[x],i,f[x])}if(m&&m.name==p[x]){v.acum=N;v.dimValue=f[x]}N+=f[x]||0;C+=l[x]||0}if(m){d.save();d.lineWidth=2;d.strokeStyle=m.color;if(b){d.strokeRect(u+v.acum+1,a+1,v.dimValue-2,s-2)}else{d.strokeRect(u+1,a-v.acum-v.dimValue+1,i-2,v.dimValue-2)}d.restore()}if(S.type=="Native"){d.save();d.fillStyle=d.strokeStyle=S.color;d.font=S.style+" "+S.size+"px "+S.family;d.textBaseline="middle";var A=w(t.name,C,t);if(A!==false){A=A!==true?A:C;if(b){d.textAlign="right";d.fillText(A,u+N-y.labelOffset,a+s/2)}else{d.textAlign="center";d.fillText(A,u+i/2,a-s-S.size/2-y.labelOffset)}}if(E(t.name,C,t)){if(b){d.textAlign="center";d.translate(u-y.labelOffset-S.size/2,a+s/2);d.rotate(Math.PI/2);d.fillText(t.name,0,0)}else{d.textAlign="center";d.fillText(t.name,u+i/2,a+S.size/2+y.labelOffset)}}d.restore()}}},contains:function(e,t){var n=e.pos.getc(true),r=e.getData("width"),i=e.getData("height"),s=this.getAlignedPos(n,r,i),o=s.x,u=s.y,a=e.getData("dimArray"),f=e.getData("config"),l=t.x-o,c=f.orientation=="horizontal";if(c){if(t.x<o||t.x>o+r||t.y>u+i||t.y<u){return false}}else{if(t.x<o||t.x>o+r||t.y>u||t.y<u-i){return false}}for(var h=0,p=a.length,d=c?o:u;h<p;h++){var v=a[h];if(c){d+=v;var m=d;if(t.x<=m){return{name:e.getData("stringArray")[h],color:e.getData("colorArray")[h],value:e.getData("valueArray")[h],label:e.name}}}else{d-=v;var m=d;if(t.y>=m){return{name:e.getData("stringArray")[h],color:e.getData("colorArray")[h],value:e.getData("valueArray")[h],label:e.name}}}}return false}},"barchart-grouped":{render:function(t,n){var r=t.pos.getc(true),i=t.getData("width"),s=t.getData("height"),o=this.getAlignedPos(r,i,s),u=o.x,a=o.y,f=t.getData("dimArray"),l=t.getData("valueArray"),c=l.length,h=t.getData("colorArray"),p=h.length,d=t.getData("stringArray");var v=n.getCtx(),m={},g=t.getData("border"),y=t.getData("gradient"),b=t.getData("config"),w=b.orientation=="horizontal",E=b.showAggregates,S=b.showLabels,x=b.Label,T=(w?s:i)/c;if(h&&f&&d){for(var N=0,C=c,k=0,L=0;N<C;N++){v.fillStyle=v.strokeStyle=h[N%p];if(y){var A;if(w){A=v.createLinearGradient(u+f[N]/2,a+T*N,u+f[N]/2,a+T*(N+1))}else{A=v.createLinearGradient(u+T*N,a-f[N]/2,u+T*(N+1),a-f[N]/2)}var O=e.rgbToHex(e.map(e.hexToRgb(h[N%p].slice(1)),function(e){return e*.5>>0}));A.addColorStop(0,O);A.addColorStop(.5,h[N%p]);A.addColorStop(1,O);v.fillStyle=A}if(w){v.fillRect(u,a+T*N,f[N],T)}else{v.fillRect(u+T*N,a-f[N],T,f[N])}if(g&&g.name==d[N]){m.acum=T*N;m.dimValue=f[N]}k+=f[N]||0;L+=l[N]||0}if(g){v.save();v.lineWidth=2;v.strokeStyle=g.color;if(w){v.strokeRect(u+1,a+m.acum+1,m.dimValue-2,T-2)}else{v.strokeRect(u+m.acum+1,a-m.dimValue+1,T-2,m.dimValue-2)}v.restore()}if(x.type=="Native"){v.save();v.fillStyle=v.strokeStyle=x.color;v.font=x.style+" "+x.size+"px "+x.family;v.textBaseline="middle";var M=E(t.name,L,t);if(M!==false){M=M!==true?M:L;if(w){v.textAlign="right";v.fillText(M,u+Math.max.apply(null,f)-b.labelOffset,a+s/2)}else{v.textAlign="center";v.fillText(M,u+i/2,a-Math.max.apply(null,f)-x.size/2-b.labelOffset)}}if(S(t.name,L,t)){if(w){v.textAlign="center";v.translate(u-b.labelOffset-x.size/2,a+s/2);v.rotate(Math.PI/2);v.fillText(t.name,0,0)}else{v.textAlign="center";v.fillText(t.name,u+i/2,a+x.size/2+b.labelOffset)}}v.restore()}}},contains:function(e,t){var n=e.pos.getc(true),r=e.getData("width"),i=e.getData("height"),s=this.getAlignedPos(n,r,i),o=s.x,u=s.y,a=e.getData("dimArray"),f=a.length,l=e.getData("config"),c=t.x-o,h=l.orientation=="horizontal",p=(h?i:r)/f;if(h){if(t.x<o||t.x>o+r||t.y>u+i||t.y<u){return false}}else{if(t.x<o||t.x>o+r||t.y>u||t.y<u-i){return false}}for(var d=0,v=a.length;d<v;d++){var m=a[d];if(h){var g=u+p*d;if(t.x<=o+m&&t.y>=g&&t.y<=g+p){return{name:e.getData("stringArray")[d],color:e.getData("colorArray")[d],value:e.getData("valueArray")[d],label:e.name}}}else{var g=o+p*d;if(t.x>=g&&t.x<=g+p&&t.y>=u-m){return{name:e.getData("stringArray")[d],color:e.getData("colorArray")[d],value:e.getData("valueArray")[d],label:e.name}}}}return false}}});$jit.BarChart=new t({st:null,colors:["#416D9C","#70A35E","#EBB056","#C74243","#83548B","#909291","#557EAA"],selected:{},busy:false,initialize:function(t){this.controller=this.config=e.merge(i("Canvas","Margin","Label","BarChart"),{Label:{type:"Native"}},t);var n=this.config.showLabels,r=e.type(n),s=this.config.showAggregates,o=e.type(s);this.config.showLabels=r=="function"?n:e.lambda(n);this.config.showAggregates=o=="function"?s:e.lambda(s);this.initializeViz()},initializeViz:function(){var t=this.config,n=this;var r=t.type.split(":")[0],i=t.orientation=="horizontal",s={};var o=new $jit.ST({injectInto:t.injectInto,width:t.width,height:t.height,orientation:i?"left":"bottom",levelDistance:0,siblingOffset:t.barsOffset,subtreeOffset:0,withLabels:t.Label.type!="Native",useCanvas:t.useCanvas,Label:{type:t.Label.type},Node:{overridable:true,type:"barchart-"+r,align:"left",width:1,height:1},Edge:{type:"none"},Tips:{enable:t.Tips.enable,type:"Native",force:true,onShow:function(e,n,r){var i=r;t.Tips.onShow(e,i,n)}},Events:{enable:true,type:"Native",onClick:function(e,n,r){if(!t.Events.enable){return}var i=n.getContains();t.Events.onClick(i,n,r)},onMouseMove:function(e,r,i){if(!t.hoveredColor){return}if(e){var s=r.getContains();n.select(e.id,s.name,s.index)}else{n.select(false,false,false)}}},onCreateLabel:function(n,r){var i=t.Label,o=r.getData("valueArray"),u=e.reduce(o,function(e,t){return e+t},0);var a={wrapper:document.createElement("div"),aggregate:document.createElement("div"),label:document.createElement("div")};var f=a.wrapper,l=a.label,c=a.aggregate,h=f.style,p=l.style,d=c.style;s[r.id]=a;f.appendChild(l);f.appendChild(c);if(!t.showLabels(r.name,u,r)){p.display="none"}if(!t.showAggregates(r.name,u,r)){d.display="none"}h.position="relative";h.overflow="visible";h.fontSize=i.size+"px";h.fontFamily=i.family;h.color=i.color;h.textAlign="center";d.position=p.position="absolute";n.style.width=r.getData("width")+"px";n.style.height=r.getData("height")+"px";d.left=p.left="0px";l.innerHTML=r.name;n.appendChild(f)},onPlaceLabel:function(e,n){if(!s[n.id]){return}var r=s[n.id],i=r.wrapper.style,o=r.label.style,u=r.aggregate.style,a=t.type.split(":")[0]=="grouped",f=t.orientation=="horizontal",l=n.getData("dimArray"),c=n.getData("valueArray"),h=a&&f?Math.max.apply(null,l):n.getData("width"),p=a&&!f?Math.max.apply(null,l):n.getData("height"),d=parseInt(i.fontSize,10),v=e.style;if(l&&c){i.width=u.width=o.width=e.style.width=h+"px";for(var m=0,g=c.length,y=0;m<g;m++){if(l[m]>0){y+=c[m]}}if(t.showLabels(n.name,y,n)){o.display=""}else{o.display="none"}var b=t.showAggregates(n.name,y,n);if(b!==false){u.display=""}else{u.display="none"}if(t.orientation=="horizontal"){u.textAlign="right";o.textAlign="left";o.textIndex=u.textIndent=t.labelOffset+"px";u.top=o.top=(p-d)/2+"px";e.style.height=i.height=p+"px"}else{u.top=-d-t.labelOffset+"px";o.top=t.labelOffset+p+"px";e.style.top=parseInt(e.style.top,10)-p+"px";e.style.height=i.height=p+"px"}r.aggregate.innerHTML=b!==true?b:y}}});var u=o.canvas.getSize(),a=t.Margin;if(i){o.config.offsetX=u.width/2-a.left-(t.showLabels&&t.labelOffset+t.Label.size);o.config.offsetY=(a.bottom-a.top)/2}else{o.config.offsetY=-u.height/2+a.bottom+(t.showLabels&&t.labelOffset+t.Label.size);o.config.offsetX=(a.right-a.left)/2}this.delegate=o;this.canvas=this.delegate.canvas},loadJSON:function(t){if(this.busy){return}this.busy=true;var n=e.time(),r=[],i=this.delegate,s=e.splat(t.label),o=e.splat(t.color||this.colors),u=this.config,a=!!u.type.split(":")[1],f=u.animate,l=u.orientation=="horizontal",c=this;for(var h=0,p=t.values,d=p.length;h<d;h++){var v=p[h];var m=e.splat(p[h].values);var g=0;r.push({id:n+v.label,name:v.label,data:{value:m,$valueArray:m,$colorArray:o,$stringArray:s,$gradient:a,$config:u},children:[]})}var y={id:n+"$root",name:"",data:{$type:"none",$width:1,$height:1},children:r};i.loadJSON(y);this.normalizeDims();i.compute();i.select(i.root);if(f){if(l){i.fx.animate({modes:["node-property:width:dimArray"],duration:1500,onComplete:function(){c.busy=false}})}else{i.fx.animate({modes:["node-property:height:dimArray"],duration:1500,onComplete:function(){c.busy=false}})}}else{this.busy=false}},updateJSON:function(t,n){if(this.busy){return}this.busy=true;this.select(false,false,false);var r=this.delegate;var i=r.graph;var s=t.values;var o=this.config.animate;var u=this;var a=this.config.orientation=="horizontal";e.each(s,function(n){var r=i.getByName(n.label);if(r){r.setData("valueArray",e.splat(n.values));if(t.label){r.setData("stringArray",e.splat(t.label))}}});this.normalizeDims();r.compute();r.select(r.root);if(o){if(a){r.fx.animate({modes:["node-property:width:dimArray"],duration:1500,onComplete:function(){u.busy=false;n&&n.onComplete()}})}else{r.fx.animate({modes:["node-property:height:dimArray"],duration:1500,onComplete:function(){u.busy=false;n&&n.onComplete()}})}}},select:function(e,t){if(!this.config.hoveredColor){return}var n=this.selected;if(n.id!=e||n.name!=t){n.id=e;n.name=t;n.color=this.config.hoveredColor;this.delegate.graph.eachNode(function(t){if(e==t.id){t.setData("border",n)}else{t.setData("border",false)}});this.delegate.plot()}},getLegend:function(){var t={};var n;this.delegate.graph.getNode(this.delegate.root).eachAdjacency(function(e){n=e.nodeTo});var r=n.getData("colorArray"),i=r.length;e.each(n.getData("stringArray"),function(e,n){t[e]=r[n%i]});return t},getMaxValue:function(){var t=0,n=this.config.type.split(":")[0]=="stacked";this.delegate.graph.eachNode(function(r){var i=r.getData("valueArray"),s=0;if(!i){return}if(n){e.each(i,function(e){s+=+e})}else{s=Math.max.apply(null,i)}t=t>s?t:s});return t},setBarType:function(e){this.config.type=e;this.delegate.config.Node.type="barchart-"+e.split(":")[0]},normalizeDims:function(){var t=this.delegate.graph.getNode(this.delegate.root),n=0;t.eachAdjacency(function(){n++});var r=this.getMaxValue()||1,i=this.delegate.canvas.getSize(),s=this.config,o=s.Margin,u=o.left+o.right,a=o.top+o.bottom,f=s.orientation=="horizontal",l=(i[f?"height":"width"]-(f?a:u)-(n-1)*s.barsOffset)/n,c=s.animate,h=i[f?"width":"height"]-(f?u:a)-(!f&&s.showAggregates&&s.Label.size+s.labelOffset)-(s.showLabels&&s.Label.size+s.labelOffset),p=f?"height":"width",d=f?"width":"height";this.delegate.graph.eachNode(function(t){var n=0,i=[];e.each(t.getData("valueArray"),function(e){n+=+e;i.push(0)});t.setData(p,l);if(c){t.setData(d,n*h/r,"end");t.setData("dimArray",e.map(t.getData("valueArray"),function(e){return e*h/r}),"end");var s=t.getData("dimArray");if(!s){t.setData("dimArray",i)}}else{t.setData(d,n*h/r);t.setData("dimArray",e.map(t.getData("valueArray"),function(e){return e*h/r}))}})}});i.PieChart={$extend:true,animate:true,offset:25,sliceOffset:0,labelOffset:3,type:"stacked",hoveredColor:"#9fd4ff",Events:{enable:false,onClick:e.empty},Tips:{enable:false,onShow:e.empty,onHide:e.empty},showLabels:true,resizeLabels:false,updateHeights:false};b.Radial=new t({compute:function(t){var n=e.splat(t||["current","start","end"]);w.compute(this.graph,n,this.config);this.graph.computeLevels(this.root,0,"ignore");var r=this.createLevelDistanceFunc();this.computeAngularWidths(n);this.computePositions(n,r)},computePositions:function(e,t){var n=e;var r=this.graph;var i=r.getNode(this.root);var s=this.parent;var o=this.config;for(var u=0,a=n.length;u<a;u++){var f=n[u];i.setPos(c(0,0),f);i.setData("span",Math.PI*2,f)}i.angleSpan={begin:0,end:2*Math.PI};r.eachBFS(this.root,function(e){var r=e.angleSpan.end-e.angleSpan.begin;var i=e.angleSpan.begin;var o=t(e);var u=0,a=[],f={};e.eachSubnode(function(e){u+=e._treeAngularWidth;for(var t=0,r=n.length;t<r;t++){var i=n[t],s=e.getData("dim",i);f[i]=i in f?s>f[i]?s:f[i]:s}a.push(e)},"ignore");if(s&&s.id==e.id&&a.length>0&&a[0].dist){a.sort(function(e,t){return(e.dist>=t.dist)-(e.dist<=t.dist)})}for(var l=0,h=a.length;l<h;l++){var p=a[l];if(!p._flag){var d=p._treeAngularWidth/u*r;var v=i+d/2;for(var m=0,g=n.length;m<g;m++){var y=n[m];p.setPos(c(v,o),y);p.setData("span",d,y);p.setData("dim-quotient",p.getData("dim",y)/f[y],y)}p.angleSpan={begin:i,end:i+d};i+=d}}},"ignore")},setAngularWidthForNodes:function(e){this.graph.eachBFS(this.root,function(t,n){var r=t.getData("angularWidth",e[0])||5;t._angularWidth=r/n},"ignore")},setSubtreesAngularWidth:function(){var e=this;this.graph.eachNode(function(t){e.setSubtreeAngularWidth(t)},"ignore")},setSubtreeAngularWidth:function(e){var t=this,n=e._angularWidth,r=0;e.eachSubnode(function(e){t.setSubtreeAngularWidth(e);r+=e._treeAngularWidth},"ignore");e._treeAngularWidth=Math.max(n,r)},computeAngularWidths:function(e){this.setAngularWidthForNodes(e);this.setSubtreesAngularWidth()}});$jit.Sunburst=new t({Implements:[y,a,b.Radial],initialize:function(t){var n=$jit.Sunburst;var r={interpolation:"linear",levelDistance:100,Node:{type:"multipie",height:0},Edge:{type:"none"},Label:{textAlign:"start",textBaseline:"middle"}};this.controller=this.config=e.merge(i("Canvas","Node","Edge","Fx","Tips","NodeStyles","Events","Navigation","Controller","Label"),r,t);var s=this.config;if(s.useCanvas){this.canvas=s.useCanvas;this.config.labelContainer=this.canvas.id+"-label"}else{if(s.background){s.background=e.merge({type:"Circles"},s.background)}this.canvas=new f(this,s);this.config.labelContainer=(typeof s.injectInto=="string"?s.injectInto:s.injectInto.id)+"-label"}this.graphOptions={klass:l,Node:{selected:false,exist:true,drawn:true}};this.graph=new d(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new n.Label[s.Label.type](this);this.fx=new n.Plot(this,n);this.op=new n.Op(this);this.json=null;this.root=null;this.rotated=null;this.busy=false;this.initializeExtras()},createLevelDistanceFunc:function(){var e=this.config.levelDistance;return function(t){return(t._depth+1)*e}},refresh:function(){this.compute();this.plot()},reposition:function(){this.compute("end")},rotate:function(e,t,n){var r=e.getPos(n.property||"current").getp(true).theta;this.rotated=e;this.rotateAngle(-r,t,n)},rotateAngle:function(t,n,r){var i=this;var s=e.merge(this.config,r||{},{modes:["polar"]});var o=r.property||(n==="animate"?"end":"current");if(n==="animate"){this.fx.animation.pause()}this.graph.eachNode(function(e){var n=e.getPos(o);n.theta+=t;if(n.theta<0){n.theta+=Math.PI*2}});if(n=="animate"){this.fx.animate(s)}else{if(n=="replot"){this.fx.plot();this.busy=false}}},plot:function(){this.fx.plot()}});$jit.Sunburst.$extend=true;(function(n){n.Op=new t({Implements:d.Op});n.Plot=new t({Implements:d.Plot});n.Label={};n.Label.Native=new t({Implements:d.Label.Native,initialize:function(e){this.viz=e;this.label=e.config.Label;this.config=e.config},renderLabel:function(e,t,n){var r=t.getData("span");if(r<Math.PI/2&&Math.tan(r)*this.config.levelDistance*t._depth<10){return}var i=e.getCtx();var s=i.measureText(t.name);if(t.id==this.viz.root){var o=-s.width/2,u=0,a=0;var f=0}else{var l=5;var f=n.levelDistance-l;var c=t.pos.clone();c.rho+=l;var h=c.getp(true);var p=c.getc(true);var o=p.x,u=p.y;var d=Math.PI;var v=h.theta>d/2&&h.theta<3*d/2;var a=v?h.theta+d:h.theta;if(v){o-=Math.abs(Math.cos(h.theta)*s.width);u+=Math.sin(h.theta)*s.width}else{if(t.id==this.viz.root){o-=s.width/2}}}i.save();i.translate(o,u);i.rotate(a);i.fillText(t.name,0,0);i.restore()}});n.Label.SVG=new t({Implements:d.Label.SVG,initialize:function(e){this.viz=e},placeLabel:function(e,t,n){var r=t.pos.getc(true),i=this.viz,s=this.viz.canvas;var o=s.getSize();var u={x:Math.round(r.x+o.width/2),y:Math.round(r.y+o.height/2)};e.setAttribute("x",u.x);e.setAttribute("y",u.y);var a=e.getBBox();if(a){var f=e.getAttribute("x");var l=e.getAttribute("y");var c=t.pos.getp(true);var h=Math.PI;var p=c.theta>h/2&&c.theta<3*h/2;if(p){e.setAttribute("x",f-a.width);e.setAttribute("y",l-a.height)}else{if(t.id==i.root){e.setAttribute("x",f-a.width/2)}}var d=p?c.theta+h:c.theta;if(t._depth){e.setAttribute("transform","rotate("+d*360/(2*h)+" "+f+" "+l+")")}}n.onPlaceLabel(e,t)}});n.Label.HTML=new t({Implements:d.Label.HTML,initialize:function(e){this.viz=e},placeLabel:function(e,t,n){var r=t.pos.clone(),i=this.viz.canvas,s=t.getData("height"),o=(s||t._depth==0?s:this.viz.config.levelDistance)/2,u=i.getSize();r.rho+=o;r=r.getc(true);var a={x:Math.round(r.x+u.width/2),y:Math.round(r.y+u.height/2)};var f=e.style;f.left=a.x+"px";f.top=a.y+"px";f.display=this.fitsInCanvas(a,i)?"":"none";n.onPlaceLabel(e,t)}});n.Plot.NodeTypes=new t({none:{render:e.empty,contains:e.lambda(false),anglecontains:function(e,t){var n=e.getData("span")/2,r=e.pos.theta;var i=r-n,s=r+n;if(i<0){i+=Math.PI*2}var o=Math.atan2(t.y,t.x);if(o<0){o+=Math.PI*2}if(i>s){return o>i&&o<=Math.PI*2||o<s}else{return o>i&&o<s}}},pie:{render:function(e,t){var n=e.getData("span")/2,r=e.pos.theta;var i=r-n,s=r+n;var o=e.pos.getp(true);var u=new l(o.rho,i);var a=u.getc(true);u.theta=s;var f=u.getc(true);var c=t.getCtx();c.beginPath();c.moveTo(0,0);c.lineTo(a.x,a.y);c.moveTo(0,0);c.lineTo(f.x,f.y);c.moveTo(0,0);c.arc(0,0,o.rho*e.getData("dim-quotient"),i,s,false);c.fill()},contains:function(e,t){if(this.nodeTypes.none.anglecontains.call(this,e,t)){var n=Math.sqrt(t.x*t.x+t.y*t.y);var r=this.config.levelDistance,i=e._depth;return n<=r*i}return false}},multipie:{render:function(e,t){var n=e.getData("height");var r=n?n:this.config.levelDistance;var i=e.getData("span")/2,s=e.pos.theta;var o=s-i,u=s+i;var a=e.pos.getp(true);var f=new l(a.rho,o);var c=f.getc(true);f.theta=u;var h=f.getc(true);f.rho+=r;var p=f.getc(true);f.theta=o;var d=f.getc(true);var v=t.getCtx();v.moveTo(0,0);v.beginPath();v.arc(0,0,a.rho,o,u,false);v.arc(0,0,a.rho+r,u,o,true);v.moveTo(c.x,c.y);v.lineTo(d.x,d.y);v.moveTo(h.x,h.y);v.lineTo(p.x,p.y);v.fill();if(e.collapsed){v.save();v.lineWidth=2;v.moveTo(0,0);v.beginPath();v.arc(0,0,a.rho+r+5,u-.01,o+.01,true);v.stroke();v.restore()}},contains:function(e,t){if(this.nodeTypes.none.anglecontains.call(this,e,t)){var n=Math.sqrt(t.x*t.x+t.y*t.y);var r=e.getData("height");var i=r?r:this.config.levelDistance;var s=this.config.levelDistance,o=e._depth;return n>=s*o&&n<=s*o+i}return false}},"gradient-multipie":{render:function(t,n){var r=n.getCtx();var i=t.getData("height");var s=i?i:this.config.levelDistance;var o=r.createRadialGradient(0,0,t.getPos().rho,0,0,t.getPos().rho+s);var u=e.hexToRgb(t.getData("color")),a=[];e.each(u,function(e){a.push(parseInt(e*.5,10))});var f=e.rgbToHex(a);o.addColorStop(0,f);o.addColorStop(1,t.getData("color"));r.fillStyle=o;this.nodeTypes.multipie.render.call(this,t,n)},contains:function(e,t){return this.nodeTypes.multipie.contains.call(this,e,t)}},"gradient-pie":{render:function(t,n){var r=n.getCtx();var i=r.createRadialGradient(0,0,0,0,0,t.getPos().rho);var s=e.hexToRgb(t.getData("color")),o=[];e.each(s,function(e){o.push(parseInt(e*.5,10))});var u=e.rgbToHex(o);i.addColorStop(1,u);i.addColorStop(0,t.getData("color"));r.fillStyle=i;this.nodeTypes.pie.render.call(this,t,n)},contains:function(e,t){return this.nodeTypes.pie.contains.call(this,e,t)}}});n.Plot.EdgeTypes=new t({none:e.empty,line:{render:function(e,t){var n=e.nodeFrom.pos.getc(true),r=e.nodeTo.pos.getc(true);this.edgeHelper.line.render(n,r,t)},contains:function(e,t){var n=e.nodeFrom.pos.getc(true),r=e.nodeTo.pos.getc(true);return this.edgeHelper.line.contains(n,r,t,this.edge.epsilon)}},arrow:{render:function(e,t){var n=e.nodeFrom.pos.getc(true),r=e.nodeTo.pos.getc(true),i=e.getData("dim"),s=e.data.$direction,o=s&&s.length>1&&s[0]!=e.nodeFrom.id;this.edgeHelper.arrow.render(n,r,i,o,t)},contains:function(e,t){var n=e.nodeFrom.pos.getc(true),r=e.nodeTo.pos.getc(true);return this.edgeHelper.arrow.contains(n,r,t,this.edge.epsilon)}},hyperline:{render:function(e,t){var n=e.nodeFrom.pos.getc(),r=e.nodeTo.pos.getc(),i=Math.max(n.norm(),r.norm());this.edgeHelper.hyperline.render(n.$scale(1/i),r.$scale(1/i),i,t)},contains:e.lambda(false)}})})($jit.Sunburst);$jit.Sunburst.Plot.NodeTypes.implement({"piechart-stacked":{render:function(t,n){var r=t.pos.getp(true),i=t.getData("dimArray"),s=t.getData("valueArray"),o=t.getData("colorArray"),u=o.length,a=t.getData("stringArray"),f=t.getData("span")/2,c=t.pos.theta,h=c-f,p=c+f,d=new l;var v=n.getCtx(),m={},g=t.getData("gradient"),y=t.getData("border"),b=t.getData("config"),w=b.showLabels,E=b.resizeLabels,S=b.Label;var x=b.sliceOffset*Math.cos((h+p)/2);var T=b.sliceOffset*Math.sin((h+p)/2);if(o&&i&&a){for(var N=0,C=i.length,k=0,L=0;N<C;N++){var A=i[N],O=o[N%u];if(A<=0){continue}v.fillStyle=v.strokeStyle=O;if(g&&A){var M=v.createRadialGradient(x,T,k+b.sliceOffset,x,T,k+A+b.sliceOffset);var _=e.hexToRgb(O),D=e.map(_,function(e){return e*.8>>0}),P=e.rgbToHex(D);M.addColorStop(0,O);M.addColorStop(.5,O);M.addColorStop(1,P);v.fillStyle=M}d.rho=k+b.sliceOffset;d.theta=h;var H=d.getc(true);d.theta=p;var B=d.getc(true);d.rho+=A;var j=d.getc(true);d.theta=h;var F=d.getc(true);v.beginPath();v.arc(x,T,k+.01,h,p,false);v.arc(x,T,k+A+.01,p,h,true);v.fill();if(y&&y.name==a[N]){m.acum=k;m.dimValue=i[N];m.begin=h;m.end=p}k+=A||0;L+=s[N]||0}if(y){v.save();v.globalCompositeOperation="source-over";v.lineWidth=2;v.strokeStyle=y.color;var I=h<p?1:-1;v.beginPath();v.arc(x,T,m.acum+.01+1,m.begin,m.end,false);v.arc(x,T,m.acum+m.dimValue+.01-1,m.end,m.begin,true);v.closePath();v.stroke();v.restore()}if(w&&S.type=="Native"){v.save();v.fillStyle=v.strokeStyle=S.color;var q=E?t.getData("normalizedDim"):1,R=S.size*q>>0;R=R<+E?+E:R;v.font=S.style+" "+R+"px "+S.family;v.textBaseline="middle";v.textAlign="center";d.rho=k+b.labelOffset+b.sliceOffset;d.theta=t.pos.theta;var U=d.getc(true);v.fillText(t.name,U.x,U.y);v.restore()}}},contains:function(e,t){if(this.nodeTypes.none.anglecontains.call(this,e,t)){var n=Math.sqrt(t.x*t.x+t.y*t.y);var r=this.config.levelDistance,i=e._depth;var s=e.getData("config");if(n<=r*i+s.sliceOffset){var o=e.getData("dimArray");for(var u=0,a=o.length,f=s.sliceOffset;u<a;u++){var l=o[u];if(n>=f&&n<=f+l){return{name:e.getData("stringArray")[u],color:e.getData("colorArray")[u],value:e.getData("valueArray")[u],label:e.name}}f+=l}}return false}return false}}});$jit.PieChart=new t({sb:null,colors:["#416D9C","#70A35E","#EBB056","#C74243","#83548B","#909291","#557EAA"],selected:{},busy:false,initialize:function(t){this.controller=this.config=e.merge(i("Canvas","PieChart","Label"),{Label:{type:"Native"}},t);this.initializeViz()},initializeViz:function(){var e=this.config,t=this;var n=e.type.split(":")[0];var r=new $jit.Sunburst({injectInto:e.injectInto,width:e.width,height:e.height,useCanvas:e.useCanvas,withLabels:e.Label.type!="Native",Label:{type:e.Label.type},Node:{overridable:true,type:"piechart-"+n,width:1,height:1},Edge:{type:"none"},Tips:{enable:e.Tips.enable,type:"Native",force:true,onShow:function(t,n,r){var i=r;e.Tips.onShow(t,i,n)}},Events:{enable:true,type:"Native",onClick:function(t,n,r){if(!e.Events.enable){return}var i=n.getContains();e.Events.onClick(i,n,r)},onMouseMove:function(n,r,i){if(!e.hoveredColor){return}if(n){var s=r.getContains();t.select(n.id,s.name,s.index)}else{t.select(false,false,false)}}},onCreateLabel:function(t,n){var r=e.Label;if(e.showLabels){var i=t.style;i.fontSize=r.size+"px";i.fontFamily=r.family;i.color=r.color;i.textAlign="center";t.innerHTML=n.name}},onPlaceLabel:function(n,r){if(!e.showLabels){return}var i=r.pos.getp(true),s=r.getData("dimArray"),o=r.getData("span")/2,u=r.pos.theta,a=u-o,f=u+o,c=new l;var h=e.showLabels,p=e.resizeLabels,d=e.Label;if(s){for(var v=0,m=s.length,g=0;v<m;v++){g+=s[v]}var y=p?r.getData("normalizedDim"):1,b=d.size*y>>0;b=b<+p?+p:b;n.style.fontSize=b+"px";c.rho=g+e.labelOffset+e.sliceOffset;c.theta=(a+f)/2;var i=c.getc(true);var w=t.canvas.getSize();var E={x:Math.round(i.x+w.width/2),y:Math.round(i.y+w.height/2)};n.style.left=E.x+"px";n.style.top=E.y+"px"}}});var i=r.canvas.getSize(),s=Math.min;r.config.levelDistance=s(i.width,i.height)/2-e.offset-e.sliceOffset;this.delegate=r;this.canvas=this.delegate.canvas;this.canvas.getCtx().globalCompositeOperation="lighter"},loadJSON:function(t){var n=e.time(),r=[],i=this.delegate,s=e.splat(t.label),o=s.length,u=e.splat(t.color||this.colors),a=u.length,f=this.config,l=!!f.type.split(":")[1],c=f.animate,h=o==1;for(var p=0,d=t.values,v=d.length;p<v;p++){var m=d[p];var g=e.splat(m.values);r.push({id:n+m.label,name:m.label,data:{value:g,$valueArray:g,$colorArray:h?e.splat(u[p%a]):u,$stringArray:s,$gradient:l,$config:f,$angularWidth:e.reduce(g,function(e,t){return e+t})},children:[]})}var y={id:n+"$root",name:"",data:{$type:"none",$width:1,$height:1},children:r};i.loadJSON(y);this.normalizeDims();i.refresh();if(c){i.fx.animate({modes:["node-property:dimArray"],duration:1500})}},updateJSON:function(t,n){if(this.busy){return}this.busy=true;var r=this.delegate;var i=r.graph;var s=t.values;var o=this.config.animate;var u=this;e.each(s,function(n){var r=i.getByName(n.label),s=e.splat(n.values);if(r){r.setData("valueArray",s);r.setData("angularWidth",e.reduce(s,function(e,t){return e+t}));if(t.label){r.setData("stringArray",e.splat(t.label))}}});this.normalizeDims();if(o){r.compute("end");r.fx.animate({modes:["node-property:dimArray:span","linear"],duration:1500,onComplete:function(){u.busy=false;n&&n.onComplete()}})}else{r.refresh()}},select:function(e,t){if(!this.config.hoveredColor){return}var n=this.selected;if(n.id!=e||n.name!=t){n.id=e;n.name=t;n.color=this.config.hoveredColor;this.delegate.graph.eachNode(function(t){if(e==t.id){t.setData("border",n)}else{t.setData("border",false)}});this.delegate.plot()}},getLegend:function(){var t={};var n;this.delegate.graph.getNode(this.delegate.root).eachAdjacency(function(e){n=e.nodeTo});var r=n.getData("colorArray"),i=r.length;e.each(n.getData("stringArray"),function(e,n){t[e]=r[n%i]});return t},getMaxValue:function(){var t=0;this.delegate.graph.eachNode(function(n){var r=n.getData("valueArray"),i=0;e.each(r,function(e){i+=+e});t=t>i?t:i});return t},normalizeDims:function(){var t=this.delegate.graph.getNode(this.delegate.root),n=0;t.eachAdjacency(function(){n++});var r=this.getMaxValue()||1,i=this.config,s=i.animate,o=this.delegate.config.levelDistance;this.delegate.graph.eachNode(function(t){var n=0,u=[];e.each(t.getData("valueArray"),function(e){n+=+e;u.push(1)});var a=u.length==1&&!i.updateHeights;if(s){t.setData("dimArray",e.map(t.getData("valueArray"),function(e){return a?o:e*o/r}),"end");var f=t.getData("dimArray");if(!f){t.setData("dimArray",u)}}else{t.setData("dimArray",e.map(t.getData("valueArray"),function(e){return a?o:e*o/r}))}t.setData("normalizedDim",n/r)})}});b.TM={};b.TM.SliceAndDice=new t({compute:function(e){var t=this.graph.getNode(this.clickedNode&&this.clickedNode.id||this.root);this.controller.onBeforeCompute(t);var n=this.canvas.getSize(),r=this.config,i=n.width,s=n.height;this.graph.computeLevels(this.root,0,"ignore");t.getPos(e).setc(-i/2,-s/2);t.setData("width",i,e);t.setData("height",s+r.titleHeight,e);this.computePositions(t,t,this.layout.orientation,e);this.controller.onAfterCompute(t)},computePositions:function(e,t,n,r){var i=0;e.eachSubnode(function(e){i+=e.getData("area",r)});var s=this.config,o=s.offset,u=e.getData("width",r),a=Math.max(e.getData("height",r)-s.titleHeight,0),f=e==t?1:t.getData("area",r)/i;var l,c,h,p,d,v,m;var g=n=="h";if(g){n="v";l=a;c=u*f;h="height";p="y";d="x";v=s.titleHeight;m=0}else{n="h";l=a*f;c=u;h="width";p="x";d="y";v=0;m=s.titleHeight}var y=t.getPos(r);t.setData("width",c,r);t.setData("height",l,r);var b=0,w=this;t.eachSubnode(function(e){var i=e.getPos(r);i[p]=b+y[p]+v;i[d]=y[d]+m;w.computePositions(t,e,n,r);b+=e.getData(h,r)})}});b.TM.Area={compute:function(e){e=e||"current";var t=this.graph.getNode(this.clickedNode&&this.clickedNode.id||this.root);this.controller.onBeforeCompute(t);var n=this.config,r=this.canvas.getSize(),i=r.width,s=r.height,o=n.offset,u=i-o,a=s-o;this.graph.computeLevels(this.root,0,"ignore");t.getPos(e).setc(-i/2,-s/2);t.setData("width",i,e);t.setData("height",s,e);var f={top:-s/2+n.titleHeight,left:-i/2,width:u,height:a-n.titleHeight};this.computePositions(t,f,e);this.controller.onAfterCompute(t)},computeDim:function(e,t,n,r,i,s){if(e.length+t.length==1){var o=e.length==1?e:t;this.layoutLast(o,n,r,s);return}if(e.length>=2&&t.length==0){t=[e.shift()]}if(e.length==0){if(t.length>0){this.layoutRow(t,n,r,s)}return}var u=e[0];if(i(t,n)>=i([u].concat(t),n)){this.computeDim(e.slice(1),t.concat([u]),n,r,i,s)}else{var a=this.layoutRow(t,n,r,s);this.computeDim(e,[],a.dim,a,i,s)}},worstAspectRatio:function(e,t){if(!e||e.length==0){return Number.MAX_VALUE}var n=0,r=0,i=Number.MAX_VALUE;for(var s=0,o=e.length;s<o;s++){var u=e[s]._area;n+=u;i=i<u?i:u;r=r>u?r:u}var a=t*t,f=n*n;return Math.max(a*r/f,f/(a*i))},avgAspectRatio:function(e,t){if(!e||e.length==0){return Number.MAX_VALUE}var n=0;for(var r=0,i=e.length;r<i;r++){var s=e[r]._area;var o=s/t;n+=t>o?t/o:o/t}return n/i},layoutLast:function(e,t,n,r){var i=e[0];i.getPos(r).setc(n.left,n.top);i.setData("width",n.width,r);i.setData("height",n.height,r)}};b.TM.Squarified=new t({Implements:b.TM.Area,computePositions:function(e,t,n){var r=this.config,i=Math.max;if(t.width>=t.height){this.layout.orientation="h"}else{this.layout.orientation="v"}var s=e.getSubnodes([1,1],"ignore");if(s.length>0){this.processChildrenLayout(e,s,t,n);for(var o=0,u=s.length;o<u;o++){var a=s[o],f=r.offset,l=i(a.getData("height",n)-f-r.titleHeight,0),c=i(a.getData("width",n)-f,0),h=a.getPos(n);t={width:c,height:l,top:h.y+r.titleHeight,left:h.x};this.computePositions(a,t,n)}}},processChildrenLayout:function(e,t,n,r){var i=n.width*n.height;var s,o=t.length,u=0,a=[];for(s=0;s<o;s++){a[s]=parseFloat(t[s].getData("area",r));u+=a[s]}for(s=0;s<o;s++){t[s]._area=i*a[s]/u}var f=this.layout.horizontal()?n.height:n.width;t.sort(function(e,t){var n=t._area-e._area;return n?n:t.id==e.id?0:t.id<e.id?1:-1});var l=[t[0]];var c=t.slice(1);this.squarify(c,l,f,n,r)},squarify:function(e,t,n,r,i){this.computeDim(e,t,n,r,this.worstAspectRatio,i)},layoutRow:function(e,t,n,r){if(this.layout.horizontal()){return this.layoutV(e,t,n,r)}else{return this.layoutH(e,t,n,r)}},layoutV:function(t,n,r,i){var s=0,o=function(e){return e};e.each(t,function(e){s+=e._area});var u=o(s/n),a=0;for(var f=0,l=t.length;f<l;f++){var c=o(t[f]._area/u);var h=t[f];h.getPos(i).setc(r.left,r.top+a);h.setData("width",u,i);h.setData("height",c,i);a+=c}var p={height:r.height,width:r.width-u,top:r.top,left:r.left+u};p.dim=Math.min(p.width,p.height);if(p.dim!=p.height){this.layout.change()}return p},layoutH:function(t,n,r,i){var s=0;e.each(t,function(e){s+=e._area});var o=s/n,u=r.top,a=0;for(var f=0,l=t.length;f<l;f++){var c=t[f];var n=c._area/o;c.getPos(i).setc(r.left+a,u);c.setData("width",n,i);c.setData("height",o,i);a+=n}var h={height:r.height-o,width:r.width,top:r.top+o,left:r.left};h.dim=Math.min(h.width,h.height);if(h.dim!=h.width){this.layout.change()}return h}});b.TM.Strip=new t({Implements:b.TM.Area,computePositions:function(e,t,n){var r=e.getSubnodes([1,1],"ignore"),i=this.config,s=Math.max;if(r.length>0){this.processChildrenLayout(e,r,t,n);for(var o=0,u=r.length;o<u;o++){var a=r[o];var f=i.offset,l=s(a.getData("height",n)-f-i.titleHeight,0),c=s(a.getData("width",n)-f,0);var h=a.getPos(n);t={width:c,height:l,top:h.y+i.titleHeight,left:h.x};this.computePositions(a,t,n)}}},processChildrenLayout:function(e,t,n,r){var i=n.width*n.height;var s,o=t.length,u=0,a=[];for(s=0;s<o;s++){a[s]=+t[s].getData("area",r);u+=a[s]}for(s=0;s<o;s++){t[s]._area=i*a[s]/u}var f=this.layout.horizontal()?n.width:n.height;var l=[t[0]];var c=t.slice(1);this.stripify(c,l,f,n,r)},stripify:function(e,t,n,r,i){this.computeDim(e,t,n,r,this.avgAspectRatio,i)},layoutRow:function(e,t,n,r){if(this.layout.horizontal()){return this.layoutH(e,t,n,r)}else{return this.layoutV(e,t,n,r)}},layoutV:function(t,n,r,i){var s=0;e.each(t,function(e){s+=e._area});var o=s/n,u=0;for(var a=0,f=t.length;a<f;a++){var l=t[a];var c=l._area/o;l.getPos(i).setc(r.left,r.top+(n-c-u));l.setData("width",o,i);l.setData("height",c,i);u+=c}return{height:r.height,width:r.width-o,top:r.top,left:r.left+o,dim:n}},layoutH:function(t,n,r,i){var s=0;e.each(t,function(e){s+=e._area});var o=s/n,u=r.height-o,a=0;for(var f=0,l=t.length;f<l;f++){var c=t[f];var h=c._area/o;c.getPos(i).setc(r.left+a,r.top+u);c.setData("width",h,i);c.setData("height",o,i);a+=h}return{height:r.height-o,width:r.width,top:r.top,left:r.left,dim:n}}});b.Icicle=new t({compute:function(e){e=e||"current";var t=this.graph.getNode(this.root),n=this.config,r=this.canvas.getSize(),i=r.width,s=r.height,o=n.offset,u=n.constrained?n.levelsToShow:Number.MAX_VALUE;this.controller.onBeforeCompute(t);d.Util.computeLevels(this.graph,t.id,0,"ignore");var a=0;d.Util.eachLevel(t,0,false,function(e,t){if(t>a){a=t}});var f=this.graph.getNode(this.clickedNode&&this.clickedNode.id||t.id);var l=Math.min(a,u-1);var c=f._depth;if(this.layout.horizontal()){this.computeSubtree(f,-i/2,-s/2,i/(l+1),s,c,l,e)}else{this.computeSubtree(f,-i/2,-s/2,i,s/(l+1),c,l,e)}},computeSubtree:function(t,n,r,i,s,o,u,a){t.getPos(a).setc(n,r);t.setData("width",i,a);t.setData("height",s,a);var f,l=0,c=0;var h=d.Util.getSubnodes(t,[1,1],"ignore");if(!h.length){return}e.each(h,function(e){c+=e.getData("dim")});for(var p=0,v=h.length;p<v;p++){if(this.layout.horizontal()){f=s*h[p].getData("dim")/c;this.computeSubtree(h[p],n+i,r,i,f,o,u,a);r+=f}else{f=i*h[p].getData("dim")/c;this.computeSubtree(h[p],n,r+s,f,s,o,u,a);n+=f}}}});$jit.Icicle=new t({Implements:[y,a,b.Icicle],layout:{orientation:"h",vertical:function(){return this.orientation=="v"},horizontal:function(){return this.orientation=="h"},change:function(){this.orientation=this.vertical()?"h":"v"}},initialize:function(t){var n={animate:false,orientation:"h",offset:2,levelsToShow:Number.MAX_VALUE,constrained:false,Node:{type:"rectangle",overridable:true},Edge:{type:"none"},Label:{type:"Native"},duration:700,fps:45};var r=i("Canvas","Node","Edge","Fx","Tips","NodeStyles","Events","Navigation","Controller","Label");this.controller=this.config=e.merge(r,n,t);this.layout.orientation=this.config.orientation;var s=this.config;if(s.useCanvas){this.canvas=s.useCanvas;this.config.labelContainer=this.canvas.id+"-label"}else{this.canvas=new f(this,s);this.config.labelContainer=(typeof s.injectInto=="string"?s.injectInto:s.injectInto.id)+"-label"}this.graphOptions={klass:h,Node:{selected:false,exist:true,drawn:true}};this.graph=new d(this.graphOptions,this.config.Node,this.config.Edge,this.config.Label);this.labels=new $jit.Icicle.Label[this.config.Label.type](this);this.fx=new $jit.Icicle.Plot(this,$jit.Icicle);this.op=new $jit.Icicle.Op(this);this.group=new $jit.Icicle.Group(this);this.clickedNode=null;this.initializeExtras()},refresh:function(){var e=this.config.Label.type;if(e!="Native"){var t=this;this.graph.eachNode(function(e){t.labels.hideLabel(e,false)})}this.compute();this.plot()},plot:function(){this.fx.plot(this.config)},enter:function(e){if(this.busy){return}this.busy=true;var t=this,n=this.config;var r={onComplete:function(){if(n.request){t.compute()}if(n.animate){t.graph.nodeList.setDataset(["current","end"],{alpha:[1,0]});d.Util.eachSubgraph(e,function(e){e.setData("alpha",1,"end")},"ignore");t.fx.animate({duration:500,modes:["node-property:alpha"],onComplete:function(){t.clickedNode=e;t.compute("end");t.fx.animate({modes:["linear","node-property:width:height"],duration:1e3,onComplete:function(){t.busy=false;t.clickedNode=e}})}})}else{t.clickedNode=e;t.busy=false;t.refresh()}}};if(n.request){this.requestNodes(clickedNode,r)}else{r.onComplete()}},out:function(){if(this.busy){return}var e=this,t=d.Util,n=this.config,r=this.graph,i=t.getParents(r.getNode(this.clickedNode&&this.clickedNode.id||this.root)),s=i[0],o=s,u=this.clickedNode;this.busy=true;this.events.hoveredNode=false;if(!s){this.busy=false;return}callback={onComplete:function(){e.clickedNode=s;if(n.request){e.requestNodes(s,{onComplete:function(){e.compute();e.plot();e.busy=false}})}else{e.compute();e.plot();e.busy=false}}};if(n.animate){this.clickedNode=o;this.compute("end");this.clickedNode=u;this.fx.animate({modes:["linear","node-property:width:height"],duration:1e3,onComplete:function(){e.clickedNode=o;r.nodeList.setDataset(["current","end"],{alpha:[0,1]});t.eachSubgraph(u,function(e){e.setData("alpha",1)},"ignore");e.fx.animate({duration:500,modes:["node-property:alpha"],onComplete:function(){callback.onComplete()}})}})}else{callback.onComplete()}},requestNodes:function(t,n){var r=e.merge(this.controller,n),i=this.config.constrained?this.config.levelsToShow:Number.MAX_VALUE;if(r.request){var s=[],o=t._depth;d.Util.eachLevel(t,0,i,function(e){if(e.drawn&&!d.Util.anySubnode(e)){s.push(e);e._level=e._depth-o;if(this.config.constrained){e._level=i-e._level}}});this.group.requestNodes(s,r)}else{r.onComplete()}}});$jit.Icicle.Op=new t({Implements:d.Op});$jit.Icicle.Group=new t({initialize:function(e){this.viz=e;this.canvas=e.canvas;this.config=e.config},requestNodes:function(e,t){var n=0,r=e.length,i={};var s=function(){t.onComplete()};var o=this.viz;if(r==0){s()}for(var u=0;u<r;u++){i[e[u].id]=e[u];t.request(e[u].id,e[u]._level,{onComplete:function(e,t){if(t&&t.children){t.id=e;o.op.sum(t,{type:"nothing"})}if(++n==r){d.Util.computeLevels(o.graph,o.root,0);s()}}})}}});$jit.Icicle.Plot=new t({Implements:d.Plot,plot:function(t,n){t=t||this.viz.controller;var r=this.viz,i=r.graph,s=i.getNode(r.clickedNode&&r.clickedNode.id||r.root),o=s._depth;r.canvas.clear();this.plotTree(s,e.merge(t,{withLabels:true,hideLabels:false,plotSubtree:function(e,t){return!r.config.constrained||t._depth-o<r.config.levelsToShow}}),n)}});$jit.Icicle.Label={};$jit.Icicle.Label.Native=new t({Implements:d.Label.Native,renderLabel:function(e,t,n){var r=e.getCtx(),i=t.getData("width"),s=t.getData("height"),o=t.getLabelData("size"),u=r.measureText(t.name);if(s<o*1.5||i<u.width){return}var a=t.pos.getc(true);r.fillText(t.name,a.x+i/2,a.y+s/2)}});$jit.Icicle.Label.SVG=new t({Implements:d.Label.SVG,initialize:function(e){this.viz=e},placeLabel:function(e,t,n){var r=t.pos.getc(true),i=this.viz.canvas;var s=i.getSize();var o={x:Math.round(r.x+s.width/2),y:Math.round(r.y+s.height/2)};e.setAttribute("x",o.x);e.setAttribute("y",o.y);n.onPlaceLabel(e,t)}});$jit.Icicle.Label.HTML=new t({Implements:d.Label.HTML,initialize:function(e){this.viz=e},placeLabel:function(e,t,n){var r=t.pos.getc(true),i=this.viz.canvas;var s=i.getSize();var o={x:Math.round(r.x+s.width/2),y:Math.round(r.y+s.height/2)};var u=e.style;u.left=o.x+"px";u.top=o.y+"px";u.display="";n.onPlaceLabel(e,t)}});$jit.Icicle.Plot.NodeTypes=new t({none:{render:e.empty},rectangle:{render:function(t,n,r){var i=this.viz.config;var s=i.offset;var o=t.getData("width");var u=t.getData("height");var a=t.getData("border");var f=t.pos.getc(true);var l=f.x+s/2,c=f.y+s/2;var h=n.getCtx();if(o-s<2||u-s<2){return}if(i.cushion){var p=t.getData("color");var d=h.createRadialGradient(l+(o-s)/2,c+(u-s)/2,1,l+(o-s)/2,c+(u-s)/2,o<u?u:o);var v=e.rgbToHex(e.map(e.hexToRgb(p),function(e){return e*.3>>0}));d.addColorStop(0,p);d.addColorStop(1,v);h.fillStyle=d}if(a){h.strokeStyle=a;h.lineWidth=3}h.fillRect(l,c,Math.max(0,o-s),Math.max(0,u-s));a&&h.strokeRect(f.x,f.y,o,u)},contains:function(e,t){if(this.viz.clickedNode&&!$jit.Graph.Util.isDescendantOf(e,this.viz.clickedNode.id)){return false}var n=e.pos.getc(true),r=e.getData("width"),i=e.getData("height");return this.nodeHelper.rectangle.contains({x:n.x+r/2,y:n.y+i/2},t,r,i)}}});$jit.Icicle.Plot.EdgeTypes=new t({none:e.empty});b.ForceDirected=new t({getOptions:function(e){var t=this.canvas.getSize();var n=t.width,r=t.height;var i=0;this.graph.eachNode(function(e){i++});var s=n*r/i,o=Math.sqrt(s);var u=this.config.levelDistance;return{width:n,height:r,tstart:n*.1,nodef:function(e){return s/(e||1)},edgef:function(e){return o*(e-u)}}},compute:function(t,n){var r=e.splat(t||["current","start","end"]);var i=this.getOptions();w.compute(this.graph,r,this.config);this.graph.computeLevels(this.root,0,"ignore");this.graph.eachNode(function(t){e.each(r,function(n){var s=t.getPos(n);if(s.equals(h.KER)){s.x=i.width/5*(Math.random()-.5);s.y=i.height/5*(Math.random()-.5)}t.disp={};e.each(r,function(e){t.disp[e]=p(0,0)})})});this.computePositions(r,i,n)},computePositions:function(e,t,n){var r=this.config.iterations,i=0,s=this;if(n){(function o(){for(var u=n.iter,a=0;a<u;a++){t.t=t.tstart;if(r){t.t*=1-i++/(r-1)}s.computePositionStep(e,t);if(r&&i>=r){n.onComplete();return}}n.onStep(Math.round(i/(r-1)*100));setTimeout(o,1)})()}else{for(;i<r;i++){t.t=t.tstart*(1-i/(r-1));this.computePositionStep(e,t)}}},computePositionStep:function(t,n){var r=this.graph;var i=Math.min,s=Math.max;var o=p(0,0);r.eachNode(function(i){e.each(t,function(e){i.disp[e].x=0;i.disp[e].y=0});r.eachNode(function(r){if(r.id!=i.id){e.each(t,function(e){var t=i.getPos(e),s=r.getPos(e);o.x=t.x-s.x;o.y=t.y-s.y;var u=o.norm()||1;i.disp[e].$add(o.$scale(n.nodef(u)/u))})}})});var u=!!r.getNode(this.root).visited;r.eachNode(function(r){r.eachAdjacency(function(i){var s=i.nodeTo;if(!!s.visited===u){e.each(t,function(e){var t=r.getPos(e),i=s.getPos(e);o.x=t.x-i.x;o.y=t.y-i.y;var u=o.norm()||1;r.disp[e].$add(o.$scale(-n.edgef(u)/u));s.disp[e].$add(o.$scale(-1))})}});r.visited=!u});var a=n.t,f=n.width/2,l=n.height/2;r.eachNode(function(n){e.each(t,function(e){var t=n.disp[e];var r=t.norm()||1;var e=n.getPos(e);e.$add(p(t.x*i(Math.abs(t.x),a)/r,t.y*i(Math.abs(t.y),a)/r));e.x=i(f,s(-f,e.x));e.y=i(l,s(-l,e.y))})})}});$jit.ForceDirected=new t({Implements:[y,a,b.ForceDirected],initialize:function(t){var n=$jit.ForceDirected;var r={iterations:50,levelDistance:50};this.controller=this.config=e.merge(i("Canvas","Node","Edge","Fx","Tips","NodeStyles","Events","Navigation","Controller","Label"),r,t);var s=this.config;if(s.useCanvas){this.canvas=s.useCanvas;this.config.labelContainer=this.canvas.id+"-label"}else{if(s.background){s.background=e.merge({type:"Circles"},s.background)}this.canvas=new f(this,s);this.config.labelContainer=(typeof s.injectInto=="string"?s.injectInto:s.injectInto.id)+"-label"}this.graphOptions={klass:h,Node:{selected:false,exist:true,drawn:true}};this.graph=new d(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new n.Label[s.Label.type](this);this.fx=new n.Plot(this,n);this.op=new n.Op(this);this.json=null;this.busy=false;this.initializeExtras()},refresh:function(){this.compute();this.plot()},reposition:function(){this.compute("end")},computeIncremental:function(t){t=e.merge({iter:20,property:"end",onStep:e.empty,onComplete:e.empty},t||{});this.config.onBeforeCompute(this.graph.getNode(this.root));this.compute(t.property,t)},plot:function(){this.fx.plot()},animate:function(t){this.fx.animate(e.merge({modes:["linear"]},t||{}))}});$jit.ForceDirected.$extend=true;(function(n){n.Op=new t({Implements:d.Op});n.Plot=new t({Implements:d.Plot});n.Label={};n.Label.Native=new t({Implements:d.Label.Native});n.Label.SVG=new t({Implements:d.Label.SVG,initialize:function(e){this.viz=e},placeLabel:function(e,t,n){var r=t.pos.getc(true),i=this.viz.canvas,s=i.translateOffsetX,o=i.translateOffsetY,u=i.scaleOffsetX,a=i.scaleOffsetY,f=i.getSize();var l={x:Math.round(r.x*u+s+f.width/2),y:Math.round(r.y*a+o+f.height/2)};e.setAttribute("x",l.x);e.setAttribute("y",l.y);n.onPlaceLabel(e,t)}});n.Label.HTML=new t({Implements:d.Label.HTML,initialize:function(e){this.viz=e},placeLabel:function(e,t,n){var r=t.pos.getc(true),i=this.viz.canvas,s=i.translateOffsetX,o=i.translateOffsetY,u=i.scaleOffsetX,a=i.scaleOffsetY,f=i.getSize();var l={x:Math.round(r.x*u+s+f.width/2),y:Math.round(r.y*a+o+f.height/2)};var c=e.style;c.left=l.x+"px";c.top=l.y+"px";c.display=this.fitsInCanvas(l,i)?"":"none";n.onPlaceLabel(e,t)}});n.Plot.NodeTypes=new t({none:{render:e.empty,contains:e.lambda(false)},circle:{render:function(e,t){var n=e.pos.getc(true),r=e.getData("dim");this.nodeHelper.circle.render("fill",n,r,t)},contains:function(e,t){var n=e.pos.getc(true),r=e.getData("dim");return this.nodeHelper.circle.contains(n,t,r)}},ellipse:{render:function(e,t){var n=e.pos.getc(true),r=e.getData("width"),i=e.getData("height");this.nodeHelper.ellipse.render("fill",n,r,i,t)},contains:function(e,t){var n=e.pos.getc(true),r=e.getData("width"),i=e.getData("height");return this.nodeHelper.ellipse.contains(n,t,r,i)}},square:{render:function(e,t){var n=e.pos.getc(true),r=e.getData("dim");this.nodeHelper.square.render("fill",n,r,t)},contains:function(e,t){var n=e.pos.getc(true),r=e.getData("dim");return this.nodeHelper.square.contains(n,t,r)}},rectangle:{render:function(e,t){var n=e.pos.getc(true),r=e.getData("width"),i=e.getData("height");this.nodeHelper.rectangle.render("fill",n,r,i,t)},contains:function(e,t){var n=e.pos.getc(true),r=e.getData("width"),i=e.getData("height");return this.nodeHelper.rectangle.contains(n,t,r,i)}},triangle:{render:function(e,t){var n=e.pos.getc(true),r=e.getData("dim");this.nodeHelper.triangle.render("fill",n,r,t)},contains:function(e,t){var n=e.pos.getc(true),r=e.getData("dim");return this.nodeHelper.triangle.contains(n,t,r)}},star:{render:function(e,t){var n=e.pos.getc(true),r=e.getData("dim");this.nodeHelper.star.render("fill",n,r,t)},contains:function(e,t){var n=e.pos.getc(true),r=e.getData("dim");return this.nodeHelper.star.contains(n,t,r)}}});n.Plot.EdgeTypes=new t({none:e.empty,line:{render:function(e,t){var n=e.nodeFrom.pos.getc(true),r=e.nodeTo.pos.getc(true);this.edgeHelper.line.render(n,r,t)},contains:function(e,t){var n=e.nodeFrom.pos.getc(true),r=e.nodeTo.pos.getc(true);return this.edgeHelper.line.contains(n,r,t,this.edge.epsilon)}},arrow:{render:function(e,t){var n=e.nodeFrom.pos.getc(true),r=e.nodeTo.pos.getc(true),i=e.getData("dim"),s=e.data.$direction,o=s&&s.length>1&&s[0]!=e.nodeFrom.id;this.edgeHelper.arrow.render(n,r,i,o,t)},contains:function(e,t){var n=e.nodeFrom.pos.getc(true),r=e.nodeTo.pos.getc(true);return this.edgeHelper.arrow.contains(n,r,t,this.edge.epsilon)}}})})($jit.ForceDirected);$jit.TM={};var E=$jit.TM;$jit.TM.$extend=true;E.Base={layout:{orientation:"h",vertical:function(){return this.orientation=="v"},horizontal:function(){return this.orientation=="h"},change:function(){this.orientation=this.vertical()?"h":"v"}},initialize:function(t){var n={orientation:"h",titleHeight:13,offset:2,levelsToShow:0,constrained:false,animate:false,Node:{type:"rectangle",overridable:true,width:3,height:3,color:"#444"},Label:{textAlign:"center",textBaseline:"top"},Edge:{type:"none"},duration:700,fps:45};this.controller=this.config=e.merge(i("Canvas","Node","Edge","Fx","Controller","Tips","NodeStyles","Events","Navigation","Label"),n,t);this.layout.orientation=this.config.orientation;var r=this.config;if(r.useCanvas){this.canvas=r.useCanvas;this.config.labelContainer=this.canvas.id+"-label"}else{if(r.background){r.background=e.merge({type:"Circles"},r.background)}this.canvas=new f(this,r);this.config.labelContainer=(typeof r.injectInto=="string"?r.injectInto:r.injectInto.id)+"-label"}this.graphOptions={klass:h,Node:{selected:false,exist:true,drawn:true}};this.graph=new d(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new E.Label[r.Label.type](this);this.fx=new E.Plot(this);this.op=new E.Op(this);this.group=new E.Group(this);this.geom=new E.Geom(this);this.clickedNode=null;this.busy=false;this.initializeExtras()},refresh:function(){if(this.busy){return}this.busy=true;var t=this;if(this.config.animate){this.compute("end");this.config.levelsToShow>0&&this.geom.setRightLevelToShow(this.graph.getNode(this.clickedNode&&this.clickedNode.id||this.root));this.fx.animate(e.merge(this.config,{modes:["linear","node-property:width:height"],onComplete:function(){t.busy=false}}))}else{var n=this.config.Label.type;if(n!="Native"){var t=this;this.graph.eachNode(function(e){t.labels.hideLabel(e,false)})}this.busy=false;this.compute();this.config.levelsToShow>0&&this.geom.setRightLevelToShow(this.graph.getNode(this.clickedNode&&this.clickedNode.id||this.root));this.plot()}},plot:function(){this.fx.plot()},leaf:function(e){return e.getSubnodes([1,1],"ignore").length==0},enter:function(e){if(this.busy){return}this.busy=true;var t=this,n=this.config,r=this.graph,i=e,s=this.clickedNode;var o={onComplete:function(){if(n.levelsToShow>0){t.geom.setRightLevelToShow(e)}if(n.levelsToShow>0||n.request){t.compute()}if(n.animate){r.nodeList.setData("alpha",0,"end");e.eachSubgraph(function(e){e.setData("alpha",1,"end")},"ignore");t.fx.animate({duration:500,modes:["node-property:alpha"],onComplete:function(){t.clickedNode=i;t.compute("end");t.clickedNode=s;t.fx.animate({modes:["linear","node-property:width:height"],duration:1e3,onComplete:function(){t.busy=false;t.clickedNode=i}})}})}else{t.busy=false;t.clickedNode=e;t.refresh()}}};if(n.request){this.requestNodes(i,o)}else{o.onComplete()}},out:function(){if(this.busy){return}this.busy=true;this.events.hoveredNode=false;var e=this,t=this.config,n=this.graph,r=n.getNode(this.clickedNode&&this.clickedNode.id||this.root).getParents(),i=r[0],s=i,o=this.clickedNode;if(!i){this.busy=false;return}callback={onComplete:function(){e.clickedNode=i;if(t.request){e.requestNodes(i,{onComplete:function(){e.compute();e.plot();e.busy=false}})}else{e.compute();e.plot();e.busy=false}}};if(t.levelsToShow>0){this.geom.setRightLevelToShow(i)}if(t.animate){this.clickedNode=s;this.compute("end");this.clickedNode=o;this.fx.animate({modes:["linear","node-property:width:height"],duration:1e3,onComplete:function(){e.clickedNode=s;n.eachNode(function(e){e.setDataset(["current","end"],{alpha:[0,1]})},"ignore");o.eachSubgraph(function(e){e.setData("alpha",1)},"ignore");e.fx.animate({duration:500,modes:["node-property:alpha"],onComplete:function(){callback.onComplete()}})}})}else{callback.onComplete()}},requestNodes:function(t,n){var r=e.merge(this.controller,n),i=this.config.levelsToShow;if(r.request){var s=[],o=t._depth;t.eachLevel(0,i,function(e){var t=i-(e._depth-o);if(e.drawn&&!e.anySubnode()&&t>0){s.push(e);e._level=t}});this.group.requestNodes(s,r)}else{r.onComplete()}},reposition:function(){this.compute("end")}};E.Op=new t({Implements:d.Op,initialize:function(e){this.viz=e}});E.Geom=new t({Implements:d.Geom,getRightLevelToShow:function(){return this.viz.config.levelsToShow},setRightLevelToShow:function(e){var t=this.getRightLevelToShow(),n=this.viz.labels;e.eachLevel(0,t+1,function(r){var i=r._depth-e._depth;if(i>t){r.drawn=false;r.exist=false;r.ignore=true;n.hideLabel(r,false)}else{r.drawn=true;r.exist=true;delete r.ignore}});e.drawn=true;delete e.ignore}});E.Group=new t({initialize:function(e){this.viz=e;this.canvas=e.canvas;this.config=e.config},requestNodes:function(e,t){var n=0,r=e.length,i={};var s=function(){t.onComplete()};var o=this.viz;if(r==0){s()}for(var u=0;u<r;u++){i[e[u].id]=e[u];t.request(e[u].id,e[u]._level,{onComplete:function(e,t){if(t&&t.children){t.id=e;o.op.sum(t,{type:"nothing"})}if(++n==r){o.graph.computeLevels(o.root,0);s()}}})}}});E.Plot=new t({Implements:d.Plot,initialize:function(e){this.viz=e;this.config=e.config;this.node=this.config.Node;this.edge=this.config.Edge;this.animation=new r;this.nodeTypes=new E.Plot.NodeTypes;this.edgeTypes=new E.Plot.EdgeTypes;this.labels=e.labels},plot:function(t,n){var r=this.viz,i=r.graph;r.canvas.clear();this.plotTree(i.getNode(r.clickedNode&&r.clickedNode.id||r.root),e.merge(r.config,t||{},{withLabels:true,hideLabels:false,plotSubtree:function(e,t){return e.anySubnode("exist")}}),n)}});E.Label={};E.Label.Native=new t({Implements:d.Label.Native,initialize:function(e){this.config=e.config;this.leaf=e.leaf},renderLabel:function(e,t,n){if(!this.leaf(t)&&!this.config.titleHeight){return}var r=t.pos.getc(true),i=e.getCtx(),s=t.getData("width"),o=t.getData("height"),u=r.x+s/2,a=r.y;i.fillText(t.name,u,a,s)}});E.Label.SVG=new t({Implements:d.Label.SVG,initialize:function(e){this.viz=e;this.leaf=e.leaf;this.config=e.config},placeLabel:function(e,t,n){var r=t.pos.getc(true),i=this.viz.canvas,s=i.translateOffsetX,o=i.translateOffsetY,u=i.scaleOffsetX,a=i.scaleOffsetY,f=i.getSize();var l={x:Math.round(r.x*u+s+f.width/2),y:Math.round(r.y*a+o+f.height/2)};e.setAttribute("x",l.x);e.setAttribute("y",l.y);if(!this.leaf(t)&&!this.config.titleHeight){e.style.display="none"}n.onPlaceLabel(e,t)}});E.Label.HTML=new t({Implements:d.Label.HTML,initialize:function(e){this.viz=e;this.leaf=e.leaf;this.config=e.config},placeLabel:function(e,t,n){var r=t.pos.getc(true),i=this.viz.canvas,s=i.translateOffsetX,o=i.translateOffsetY,u=i.scaleOffsetX,a=i.scaleOffsetY,f=i.getSize();var l={x:Math.round(r.x*u+s+f.width/2),y:Math.round(r.y*a+o+f.height/2)};var c=e.style;c.left=l.x+"px";c.top=l.y+"px";c.width=t.getData("width")*u+"px";c.height=t.getData("height")*a+"px";c.zIndex=t._depth*100;c.display="";if(!this.leaf(t)&&!this.config.titleHeight){e.style.display="none"}n.onPlaceLabel(e,t)}});E.Plot.NodeTypes=new t({none:{render:e.empty},rectangle:{render:function(t,n,r){var i=this.viz.leaf(t),s=this.config,o=s.offset,u=s.titleHeight,a=t.pos.getc(true),f=t.getData("width"),l=t.getData("height"),c=t.getData("border"),h=n.getCtx(),p=a.x+o/2,d=a.y+o/2;if(f<=o||l<=o){return}if(i){if(s.cushion){var v=h.createRadialGradient(p+(f-o)/2,d+(l-o)/2,1,p+(f-o)/2,d+(l-o)/2,f<l?l:f);var m=t.getData("color");var g=e.rgbToHex(e.map(e.hexToRgb(m),function(e){return e*.2>>0}));v.addColorStop(0,m);v.addColorStop(1,g);h.fillStyle=v}h.fillRect(p,d,f-o,l-o);if(c){h.save();h.strokeStyle=c;h.strokeRect(p,d,f-o,l-o);h.restore()}}else{if(u>0){h.fillRect(a.x+o/2,a.y+o/2,f-o,u-o);if(c){h.save();h.strokeStyle=c;h.strokeRect(a.x+o/2,a.y+o/2,f-o,l-o);h.restore()}}}},contains:function(e,t){if(this.viz.clickedNode&&!e.isDescendantOf(this.viz.clickedNode.id)||e.ignore){return false}var n=e.pos.getc(true),r=e.getData("width"),i=this.viz.leaf(e),s=i?e.getData("height"):this.config.titleHeight;return this.nodeHelper.rectangle.contains({x:n.x+r/2,y:n.y+s/2},t,r,s)}}});E.Plot.EdgeTypes=new t({none:e.empty});E.SliceAndDice=new t({Implements:[y,a,E.Base,b.TM.SliceAndDice]});E.Squarified=new t({Implements:[y,a,E.Base,b.TM.Squarified]});E.Strip=new t({Implements:[y,a,E.Base,b.TM.Strip]});$jit.RGraph=new t({Implements:[y,a,b.Radial],initialize:function(t){var n=$jit.RGraph;var r={interpolation:"linear",levelDistance:100};this.controller=this.config=e.merge(i("Canvas","Node","Edge","Fx","Controller","Tips","NodeStyles","Events","Navigation","Label"),r,t);var s=this.config;if(s.useCanvas){this.canvas=s.useCanvas;this.config.labelContainer=this.canvas.id+"-label"}else{if(s.background){s.background=e.merge({type:"Circles"},s.background)}this.canvas=new f(this,s);this.config.labelContainer=(typeof s.injectInto=="string"?s.injectInto:s.injectInto.id)+"-label"}this.graphOptions={klass:l,Node:{selected:false,exist:true,drawn:true}};this.graph=new d(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new n.Label[s.Label.type](this);this.fx=new n.Plot(this,n);this.op=new n.Op(this);this.json=null;this.root=null;this.busy=false;this.parent=false;this.initializeExtras()},createLevelDistanceFunc:function(){var e=this.config.levelDistance;return function(t){return(t._depth+1)*e}},refresh:function(){this.compute();this.plot()},reposition:function(){this.compute("end")},plot:function(){this.fx.plot()},getNodeAndParentAngle:function(e){var t=false;var n=this.graph.getNode(e);var r=n.getParents();var i=r.length>0?r[0]:false;if(i){var s=i.pos.getc(),o=n.pos.getc();var u=s.add(o.scale(-1));t=Math.atan2(u.y,u.x);if(t<0){t+=2*Math.PI}}return{parent:i,theta:t}},tagChildren:function(e,t){if(e.angleSpan){var n=[];e.eachAdjacency(function(e){n.push(e.nodeTo)},"ignore");var r=n.length;for(var i=0;i<r&&t!=n[i].id;i++){}for(var s=(i+1)%r,o=0;t!=n[s].id;s=(s+1)%r){n[s].dist=o++}}},onClick:function(t,n){if(this.root!=t&&!this.busy){this.busy=true;this.root=t;var r=this;this.controller.onBeforeCompute(this.graph.getNode(t));var i=this.getNodeAndParentAngle(t);this.tagChildren(i.parent,t);this.parent=i.parent;this.compute("end");var s=i.theta-i.parent.endPos.theta;this.graph.eachNode(function(e){e.endPos.set(e.endPos.getp().add(c(s,0)))});var o=this.config.interpolation;n=e.merge({onComplete:e.empty},n||{});this.fx.animate(e.merge({hideLabels:true,modes:[o]},n,{onComplete:function(){r.busy=false;n.onComplete()}}))}}});$jit.RGraph.$extend=true;(function(n){n.Op=new t({Implements:d.Op});n.Plot=new t({Implements:d.Plot});n.Label={};n.Label.Native=new t({Implements:d.Label.Native});n.Label.SVG=new t({Implements:d.Label.SVG,initialize:function(e){this.viz=e},placeLabel:function(e,t,n){var r=t.pos.getc(true),i=this.viz.canvas,s=i.translateOffsetX,o=i.translateOffsetY,u=i.scaleOffsetX,a=i.scaleOffsetY,f=i.getSize();var l={x:Math.round(r.x*u+s+f.width/2),y:Math.round(r.y*a+o+f.height/2)};e.setAttribute("x",l.x);e.setAttribute("y",l.y);n.onPlaceLabel(e,t)}});n.Label.HTML=new t({Implements:d.Label.HTML,initialize:function(e){this.viz=e},placeLabel:function(e,t,n){var r=t.pos.getc(true),i=this.viz.canvas,s=i.translateOffsetX,o=i.translateOffsetY,u=i.scaleOffsetX,a=i.scaleOffsetY,f=i.getSize();var l={x:Math.round(r.x*u+s+f.width/2),y:Math.round(r.y*a+o+f.height/2)};var c=e.style;c.left=l.x+"px";c.top=l.y+"px";c.display=this.fitsInCanvas(l,i)?"":"none";n.onPlaceLabel(e,t)}});n.Plot.NodeTypes=new t({none:{render:e.empty,contains:e.lambda(false)},circle:{render:function(e,t){var n=e.pos.getc(true),r=e.getData("dim");this.nodeHelper.circle.render("fill",n,r,t)},contains:function(e,t){var n=e.pos.getc(true),r=e.getData("dim");return this.nodeHelper.circle.contains(n,t,r)}},ellipse:{render:function(e,t){var n=e.pos.getc(true),r=e.getData("width"),i=e.getData("height");this.nodeHelper.ellipse.render("fill",n,r,i,t)},contains:function(e,t){var n=e.pos.getc(true),r=e.getData("width"),i=e.getData("height");return this.nodeHelper.ellipse.contains(n,t,r,i)}},square:{render:function(e,t){var n=e.pos.getc(true),r=e.getData("dim");this.nodeHelper.square.render("fill",n,r,t)},contains:function(e,t){var n=e.pos.getc(true),r=e.getData("dim");return this.nodeHelper.square.contains(n,t,r)}},rectangle:{render:function(e,t){var n=e.pos.getc(true),r=e.getData("width"),i=e.getData("height");this.nodeHelper.rectangle.render("fill",n,r,i,t)},contains:function(e,t){var n=e.pos.getc(true),r=e.getData("width"),i=e.getData("height");return this.nodeHelper.rectangle.contains(n,t,r,i)}},triangle:{render:function(e,t){var n=e.pos.getc(true),r=e.getData("dim");this.nodeHelper.triangle.render("fill",n,r,t)},contains:function(e,t){var n=e.pos.getc(true),r=e.getData("dim");return this.nodeHelper.triangle.contains(n,t,r)}},star:{render:function(e,t){var n=e.pos.getc(true),r=e.getData("dim");this.nodeHelper.star.render("fill",n,r,t)},contains:function(e,t){var n=e.pos.getc(true),r=e.getData("dim");return this.nodeHelper.star.contains(n,t,r)}}});n.Plot.EdgeTypes=new t({none:e.empty,line:{render:function(e,t){var n=e.nodeFrom.pos.getc(true),r=e.nodeTo.pos.getc(true);this.edgeHelper.line.render(n,r,t)},contains:function(e,t){var n=e.nodeFrom.pos.getc(true),r=e.nodeTo.pos.getc(true);return this.edgeHelper.line.contains(n,r,t,this.edge.epsilon)}},arrow:{render:function(e,t){var n=e.nodeFrom.pos.getc(true),r=e.nodeTo.pos.getc(true),i=e.getData("dim"),s=e.data.$direction,o=s&&s.length>1&&s[0]!=e.nodeFrom.id;this.edgeHelper.arrow.render(n,r,i,o,t)},contains:function(e,t){var n=e.nodeFrom.pos.getc(true),r=e.nodeTo.pos.getc(true);return this.edgeHelper.arrow.contains(n,r,t,this.edge.epsilon)}}})})($jit.RGraph);h.prototype.moebiusTransformation=function(e){var t=this.add(e);var n=e.$conjugate().$prod(this);n.x++;return t.$div(n)};d.Util.moebiusTransformation=function(e,t,n,r,i){this.eachNode(e,function(e){for(var i=0;i<n.length;i++){var s=t[i].scale(-1),o=r?r:n[i];e.getPos(n[i]).set(e.getPos(o).getc().moebiusTransformation(s))}},i)};$jit.Hypertree=new t({Implements:[y,a,b.Radial],initialize:function(t){var n=$jit.Hypertree;var r={radius:"auto",offset:0,Edge:{type:"hyperline"},duration:1500,fps:35};this.controller=this.config=e.merge(i("Canvas","Node","Edge","Fx","Tips","NodeStyles","Events","Navigation","Controller","Label"),r,t);var s=this.config;if(s.useCanvas){this.canvas=s.useCanvas;this.config.labelContainer=this.canvas.id+"-label"}else{if(s.background){s.background=e.merge({type:"Circles"},s.background)}this.canvas=new f(this,s);this.config.labelContainer=(typeof s.injectInto=="string"?s.injectInto:s.injectInto.id)+"-label"}this.graphOptions={klass:l,Node:{selected:false,exist:true,drawn:true}};this.graph=new d(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new n.Label[s.Label.type](this);this.fx=new n.Plot(this,n);this.op=new n.Op(this);this.json=null;this.root=null;this.busy=false;this.initializeExtras()},createLevelDistanceFunc:function(){var e=this.getRadius();var t=0,n=Math.max,r=this.config;this.graph.eachNode(function(e){t=n(e._depth,t)},"ignore");t++;var i=function(t){return function(n){n.scale=e;var i=n._depth+1;var s=0,o=Math.pow;while(i){s+=o(t,i--)}return s-r.offset}};for(var s=.51;s<=1;s+=.01){var o=(1-Math.pow(s,t))/(1-s);if(o>=2){return i(s-.01)}}return i(.75)},getRadius:function(){var e=this.config.radius;if(e!=="auto"){return e}var t=this.canvas.getSize();return Math.min(t.width,t.height)/2},refresh:function(e){if(e){this.reposition();this.graph.eachNode(function(e){e.startPos.rho=e.pos.rho=e.endPos.rho;e.startPos.theta=e.pos.theta=e.endPos.theta})}else{this.compute()}this.plot()},reposition:function(){this.compute("end");var e=this.graph.getNode(this.root).pos.getc().scale(-1);d.Util.moebiusTransformation(this.graph,[e],["end"],"end","ignore");this.graph.eachNode(function(e){if(e.ignore){e.endPos.rho=e.pos.rho;e.endPos.theta=e.pos.theta}})},plot:function(){this.fx.plot()},onClick:function(e,t){var n=this.graph.getNode(e).pos.getc(true);this.move(n,t)},move:function(t,n){var r=p(t.x,t.y);if(this.busy===false&&r.norm()<1){this.busy=true;var i=this.graph.getClosestNodeToPos(r),s=this;this.graph.computeLevels(i.id,0);this.controller.onBeforeCompute(i);n=e.merge({onComplete:e.empty},n||{});this.fx.animate(e.merge({modes:["moebius"],hideLabels:true},n,{onComplete:function(){s.busy=false;n.onComplete()}}),r)}}});$jit.Hypertree.$extend=true;(function(n){n.Op=new t({Implements:d.Op});n.Plot=new t({Implements:d.Plot});n.Label={};n.Label.Native=new t({Implements:d.Label.Native,initialize:function(e){this.viz=e},renderLabel:function(e,t,n){var r=e.getCtx();var i=t.pos.getc(true);var s=this.viz.getRadius();r.fillText(t.name,i.x*s,i.y*s)}});n.Label.SVG=new t({Implements:d.Label.SVG,initialize:function(e){this.viz=e},placeLabel:function(e,t,n){var r=t.pos.getc(true),i=this.viz.canvas,s=i.translateOffsetX,o=i.translateOffsetY,u=i.scaleOffsetX,a=i.scaleOffsetY,f=i.getSize(),l=this.viz.getRadius();var c={x:Math.round(r.x*u*l+s+f.width/2),y:Math.round(r.y*a*l+o+f.height/2)};e.setAttribute("x",c.x);e.setAttribute("y",c.y);n.onPlaceLabel(e,t)}});n.Label.HTML=new t({Implements:d.Label.HTML,initialize:function(e){this.viz=e},placeLabel:function(e,t,n){var r=t.pos.getc(true),i=this.viz.canvas,s=i.translateOffsetX,o=i.translateOffsetY,u=i.scaleOffsetX,a=i.scaleOffsetY,f=i.getSize(),l=this.viz.getRadius();var c={x:Math.round(r.x*u*l+s+f.width/2),y:Math.round(r.y*a*l+o+f.height/2)};var h=e.style;h.left=c.x+"px";h.top=c.y+"px";h.display=this.fitsInCanvas(c,i)?"":"none";n.onPlaceLabel(e,t)}});n.Plot.NodeTypes=new t({none:{render:e.empty,contains:e.lambda(false)},circle:{render:function(e,t){var n=this.node,r=e.getData("dim"),i=e.pos.getc();r=n.transform?r*(1-i.squaredNorm()):r;i.$scale(e.scale);if(r>.2){this.nodeHelper.circle.render("fill",i,r,t)}},contains:function(e,t){var n=e.getData("dim"),r=e.pos.getc().$scale(e.scale);return this.nodeHelper.circle.contains(r,t,n)}},ellipse:{render:function(e,t){var n=e.pos.getc().$scale(e.scale),r=e.getData("width"),i=e.getData("height");this.nodeHelper.ellipse.render("fill",n,r,i,t)},contains:function(e,t){var n=e.getData("width"),r=e.getData("height"),i=e.pos.getc().$scale(e.scale);return this.nodeHelper.circle.contains(i,t,n,r)}},square:{render:function(e,t){var n=this.node,r=e.getData("dim"),i=e.pos.getc();r=n.transform?r*(1-i.squaredNorm()):r;i.$scale(e.scale);if(r>.2){this.nodeHelper.square.render("fill",i,r,t)}},contains:function(e,t){var n=e.getData("dim"),r=e.pos.getc().$scale(e.scale);return this.nodeHelper.square.contains(r,t,n)}},rectangle:{render:function(e,t){var n=this.node,r=e.getData("width"),i=e.getData("height"),s=e.pos.getc();r=n.transform?r*(1-s.squaredNorm()):r;i=n.transform?i*(1-s.squaredNorm()):i;s.$scale(e.scale);if(r>.2&&i>.2){this.nodeHelper.rectangle.render("fill",s,r,i,t)}},contains:function(e,t){var n=e.getData("width"),r=e.getData("height"),i=e.pos.getc().$scale(e.scale);return this.nodeHelper.rectangle.contains(i,t,n,r)}},triangle:{render:function(e,t){var n=this.node,r=e.getData("dim"),i=e.pos.getc();r=n.transform?r*(1-i.squaredNorm()):r;i.$scale(e.scale);if(r>.2){this.nodeHelper.triangle.render("fill",i,r,t)}},contains:function(e,t){var n=e.getData("dim"),r=e.pos.getc().$scale(e.scale);return this.nodeHelper.triangle.contains(r,t,n)}},star:{render:function(e,t){var n=this.node,r=e.getData("dim"),i=e.pos.getc();r=n.transform?r*(1-i.squaredNorm()):r;i.$scale(e.scale);if(r>.2){this.nodeHelper.star.render("fill",i,r,t)}},contains:function(e,t){var n=e.getData("dim"),r=e.pos.getc().$scale(e.scale);return this.nodeHelper.star.contains(r,t,n)}}});n.Plot.EdgeTypes=new t({none:e.empty,line:{render:function(e,t){var n=e.nodeFrom.pos.getc(true),r=e.nodeTo.pos.getc(true),i=e.nodeFrom.scale;this.edgeHelper.line.render({x:n.x*i,y:n.y*i},{x:r.x*i,y:r.y*i},t)},contains:function(e,t){var n=e.nodeFrom.pos.getc(true),r=e.nodeTo.pos.getc(true),i=e.nodeFrom.scale;this.edgeHelper.line.contains({x:n.x*i,y:n.y*i},{x:r.x*i,y:r.y*i},t,this.edge.epsilon)}},arrow:{render:function(e,t){var n=e.nodeFrom.pos.getc(true),r=e.nodeTo.pos.getc(true),i=e.nodeFrom.scale,s=e.getData("dim"),o=e.data.$direction,u=o&&o.length>1&&o[0]!=e.nodeFrom.id;this.edgeHelper.arrow.render({x:n.x*i,y:n.y*i},{x:r.x*i,y:r.y*i},s,u,t)},contains:function(e,t){var n=e.nodeFrom.pos.getc(true),r=e.nodeTo.pos.getc(true),i=e.nodeFrom.scale;this.edgeHelper.arrow.contains({x:n.x*i,y:n.y*i},{x:r.x*i,y:r.y*i},t,this.edge.epsilon)}},hyperline:{render:function(e,t){var n=e.nodeFrom.pos.getc(),r=e.nodeTo.pos.getc(),i=this.viz.getRadius();this.edgeHelper.hyperline.render(n,r,i,t)},contains:e.lambda(false)}})})($jit.Hypertree)})();t.mixin({getId:function(e){if(!jQuery(e).attr("id")){var n=t.uniqueId("satree-");jQuery(e).attr("id",n);return n}return jQuery(e).attr("id")},cloneDeep:function(e){var t={};jQuery.extend(true,t,e);return t},warn:function(e){if(console&&console.warn){console.warn(arguments)}}});FlancheJs.defineClass("satree.Node",{init:function(e,n){this.setContent(e);this.$id=n||t.uniqueId("satree-node-")},properties:{content:{value:null},parent:{value:null,set:function(e){if(e&&!t.contains(e.getChildren(),this)){e.addChild(this)}this.$parent=e}},children:{value:[],set:function(e){var n=this;t.each(e,function(e){n.addChild(e)})}},tag:{value:null},mathId:{value:null},id:{value:null}},methods:{addChild:function(e){this.$children.push(e);e.setParent(this)},removeChild:function(e){e.setParent(null);var t=this.getChildren();for(var n=0;n<t.length;n++){if(t[n]==e){this.$children.splice(n,1)}}},forEach:function(e){e.call(this,this);var n=this;t.each(this.getChildren(),function(t){n.forEach.call(t,e)})},isLeaf:function(){return this.getChildren().length==0},isRoot:function(){return this.getParent()==null},getSubtree:function(e){var t=this.clone();var n=null;t.forEach(function(t){if(t.getContent()==e.getContent()&&e.getMathId()==t.getMathId()){n=t}});n.getParent().removeChild(n);return t},clone:function(){return this._cloneRecursive(this)},replace:function(e,t){var n=null;if(this.getId()==e.getId()){t.setParent(null);n=t.clone()}else{var n=this.clone();var r=null;n.forEach(function(t){if(t.getId()==e.getId()){r=t}});var i=r.getParent();i.removeChild(r);i.addChild(t);t.setParent(i)}return n},getSimpleRepresentation:function(){var e=function(t){var n={content:t.getContent(),tag:t.getTag(),children:[]};var r=t.getChildren();for(var i=0;i<r.length;i++){n.children.push(e(r[i]))}return n};return e(this.clone())}},internals:{cloneRecursive:function(e){var t=new satree.Node(e.getContent(),e.getId());t.setMathId(e.getMathId());for(var n=0;n<e.getChildren().length;n++){t.addChild(this._cloneRecursive(e.getChildren()[n]))}return t}}});FlancheJs.defineClass("satree.MathParser",{init:function(e,t){this._mathId=e;this._mode=t},internals:{mathId:null,mode:null,getMathDisplay:function(e){var n=e.getAttribute("xref");if(!n){t.warn("Ref id not found for "+e+". Parsing cannot continue")}var r=this._mapElemDisplay(e);if(r==null){var i=document.getElementById(n);if(i&&!this._isElemMathTag(e)){var s=new XMLSerializer;r="<math>"+s.serializeToString(i.cloneNode())+"</math>"}else{t.warn("No reference id found for: ",e," Defaulting to textContent || tagName || UnknowSymbol");r=e.textContent||e.tagName||this.UnknownSymbol}}return r},mapElemDisplay:function(e){if(e.tagName=="apply"){var t=e.children[0];if(this._mode===satree.MathParser.ModeMath&&!(t.tagName=="csymbol"&&t.getAttribute("cd")=="cdlf")){e.removeChild(e.children[0]);return this._getMathDisplay(t)}return satree.MathParser.ApplySymbol}else if(e.tagName=="csymbol"){if(!this._isElemMathTag(e)){return e.textContent}}return null},isElemMathTag:function(e){var t=e.getAttribute("xref");var n=document.getElementById(t);return n!=null&&n.tagName=="math"},parseModeApply:function(){var e=document.getElementById(this._mathId).children[0].children[1].cloneNode(true);var t=null;return this._parseModeApplyRecursive(t,e.children[0])},parseModeApplyRecursive:function(e,n){var r=null;var i=this._getMathDisplay(n);r=new satree.Node(i);r.setMathId(n.getAttribute("xref"));this._tagCdlfNodes(r,n);if(e==null){e=r}else{r.setParent(e)}var s=this;t.each(n.children,function(e){s._parseModeApplyRecursive(r,e)});return e},tagCdlfNodes:function(e,t){if(t.getAttribute("cd")=="cdlf"){e.setTag("ambiguous")}},parseModeMath:function(){var e=document.getElementById(this._mathId).children[0].children[1].cloneNode(true);var t=null;t=this._parseModeApplyRecursive(t,e.children[0]);return t},removeFirstNodeFromEachLevel:function(e){var t=e.getChildren();if(t.length>0){e.removeChild(t[0]);t=e.getChildren();for(var n=0;n<t.length;n++){this._removeFirstNodeFromEachLevel(t[n])}}}},statics:{ModeApply:1,ModeMath:2,ApplySymbol:"@",UnknownSymbol:"USym"},methods:{parse:function(){if(this._mode===this.ModeApply){return this._parseModeApply()}else if(this._mode===this.ModeMath){return this._parseModeMath()}else{throw new Error("Please provide a valid parsing model")}}}});FlancheJs.defineClass("satree._ConfigManager",{init:function(){},properties:{summarizedMode:{value:false},renderMode:{value:satree.MathParser.ModeApply},submitUrl:{value:null}}});satree.ConfigManager=new satree._ConfigManager;FlancheJs.defineClass("satree.Disambiguator",{init:function(e){this._tree=e},methods:{generateTrees:function(){var e=this._tree;var t=[];var n=[e];while(n.length){var r=n.pop();var i=this._generateTreesRecursive(r);for(var s=0;s<i.length;s++){if(this._treeHasAmbiguities(i[s])){n.push(i[s])}else{t.push(i[s])}}}return t}},internals:{tree:null,splitNode:null,applys:null,searchNoMore:false,generateTreesRecursive:function(e){var t=this._lookupCdlfNodes();var n=[];if(t.applys){for(var r=0;r<t.applys.length;r++){var i=e.clone().replace(t.splitNode,t.applys[r]);n.push(i)}}else{n.push(e)}return n},treeHasAmbiguities:function(e){var t=false;e.forEach(function(e){if(e.getTag()=="ambiguous"){t=true}});return t},lookupCdlfNodes:function(){var e={applys:null,splitNode:null};this._searchNoMore=false;this._lookupCdlfNodesRecursive(this._tree,e);return e},lookupCdlfNodesRecursive:function(e,t){if(e.getTag()=="ambiguous"&&!this._searchNoMore){e.setTag(null);this._searchNoMore=true;t.applys=e.getParent().getChildren().slice(1);t.splitNode=e.getParent();return}else{if(e.isLeaf()){return}var n=this;e.getChildren().forEach(function(e){n._lookupCdlfNodesRecursive(e,t)})}}}});FlancheJs.defineClass("satree.TreeRenderer",{init:function(e,t,n){this.setTree(e);this.setSelector(t);if(n){this.setRenderMode(n)}else{this.setRenderMode(this.SpaceTree)}},properties:{tree:{value:null},selector:{value:null},renderMode:{value:null},offsetX:{value:0},offsetY:{value:125}},methods:{streamUpContent:function(e){},render:function(){var e=this;var n=this._toSpaceTreeJson();var r=satree.ConfigManager.getSummarizedMode()?1:100;this._tree=new $jit.ST({injectInto:t.getId(this.getSelector()),duration:100,levelsToShow:r,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),transition:$jit.Trans.Quart.easeInOut,levelDistance:20,Navigation:{enable:true,panning:true},Node:{type:"ellipse",color:"#A1A4C5",autoWidth:true,height:0,overridable:true},Edge:{type:"bezier",lineWidth:2,color:"#CBCDCD",overridable:true},onBeforeCompute:function(e){},onAfterCompute:function(){},onCreateLabel:function(t,n){if(satree.ConfigManager.getSummarizedMode()&&n._depth){var r="";var i=document.getElementById(n.id.split("-satree")[0]);if(i){if(i.tagName=="math"){r=satree.TreeRenderer="..."}else{console.log(i);r="<math>"+i.cloneNode(true).innerHTML+"</math>"}}else{r="#USymbol#"}n.name=r}t.id=n.id;t.innerHTML=n.name;t.onclick=function(){e._tree.onClick(n.id)};var s=t.style;s.cursor="pointer";s.color="#333";s.fontSize="13px";s.textAlign="center";s.padding="10px 0 0 16px";s.fontWeight="bold"},onBeforePlotNode:function(e){if(e.selected){e.data.$color="#D25232"}else{delete e.data.$color}},onBeforePlotLine:function(e){if(e.nodeFrom.selected&&e.nodeTo.selected){e.data.$color="#3E73CB";e.data.$lineWidth=3}else{delete e.data.$color;delete e.data.$lineWidth}}});this._tree.loadJSON(n);this._tree.compute();this._tree.geom.translate(new $jit.Complex(-200,0),"current");this._tree.onClick(this._tree.root)},destroy:function(){jQuery(this.getSelector()).html("");delete this._spaceTree},refresh:function(){this.destroy();this.render()}},internals:{toSpaceTreeJson:function(){var e=this._toSpaceTreeJsonRecursive(this.getTree());return e},toSpaceTreeJsonRecursive:function(e){var n={id:e.getMathId()+"-"+t.uniqueId("satree-"),name:e.getContent(),children:[]};if(!e.isLeaf()){var r=e.getChildren();var i=[];for(var s=0;s<r.length;s++){i.push(this._toSpaceTreeJsonRecursive(r[s]))}n.children=i}return n},spaceTree:null},statics:{SpaceTree:1,CannotSummarizeSymbol:"#USym#"}});FlancheJs.defineClass("satree.Panel",{init:function(e,t,n){this.$formula=t;this.$trees=n;this.$id=e;this._json=new Array(n.length)},properties:{formula:{},trees:{},id:{}},methods:{render:function(){var t="";trees=this.getTrees();for(var n=0;n<trees.length;n++){t+='<div class="tree-div">'+'<div class="tree-div-header">'+'<button id="success-'+n+'" class="tree-ok btn btn-success">OK</button>'+'<button id="fail-'+n+'" class="tree-fail btn btn-danger">Incorrect</button>'+"</div>"+'<div class="tree" id="tree-'+n+'"></div><textarea class="text-tree" id="text-'+n+'">Comment...</textarea></div>'}var r='<div id="myModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">'+'<div class="modal-header">'+this.getFormula()+"</div>"+'<div class="modal-body">'+t+"</div>"+'<div class="modal-footer">'+'<button id="myModal-close" class="btn" data-dismiss="modal" aria-hidden="true">Close</button>'+"</div>"+"</div>";e("body").append(r);e("#myModal").modal();var i=this;var s=function(t){ok_id=e(this).attr("id").split("-");ok_id=ok_id[1];e.post(satree.ConfigManager.getSubmitUrl(),{correct:t,id:i.getId(),formula:i.getFormula(),tree:i._json[n]});e("#myModal-close").click()};e(".tree-ok").click(function(){s(true)});e(".tree-fail").click(function(){s(false)});e(".tree-div").css("width",100/n-1+"%");var o=0;e(".modal").css("width",screen.width*.9);e(".modal").css("margin-left",-.9*screen.width/2);e(".modal").css("height",screen.height*.7);e(".modal-body").css("max-height","none");e(".tree").css("height",screen.height*.7-220);e(".text-tree").css("margin-left","5px");e(".tree").css("width",screen.width*.85/trees.length);e(".tree-div").each(function(){o++;if(o==trees.length){return false}else{e(this).css("border-right","1px solid #000")}});setTimeout(function(){for(n=0;n<trees.length;n++){var e=new satree.TreeRenderer(trees[n],"#tree-"+n);i._json[n]=e._toSpaceTreeJson();e.render()}},200);e("#myModal").on("hidden",function(){e("#myModal").remove();e(".modal-backdrop").remove()})}},internals:{json:{}}});FlancheJs.defineClass("satree.Manager",{init:function(t){this.setSelector(e(t).find(this.getSelector()))},properties:{selector:{value:"math"},showForAllMath:{value:true},mathMode:{value:satree.MathParser.ModeApply},showControls:{value:true},summarizeLabels:{value:false}},methods:{run:function(){this._highlightAmbiguity();this._listenOnMathClick();if(this.getShowControls()){this._addControls()}},stop:function(){if(this.getShowControls()){this._removeControls()}this._unlistenOnMathClick();this._unhighlightAmbiguity()}},internals:{highlightAmbiguity:function(){e(this.getSelector()).each(function(){e(this).wrap("<span>");e(this).parent().css("cursor","pointer");if(e(this).find('csymbol[cd="cdlf"]').length){e(this).parent().css("background-color","#ffff99")}})},unhighlightAmbiguity:function(){e(this.getSelector()).each(function(){e(this).unwrap()})},listenOnMathClick:function(){var t=this;if(this.getShowForAllMath()){e(this.getSelector()).click(function(){t._listenerFunction.call(this,t)})}else{e(this.getSelector()).filter(":has(csymbol[cd='cdlf'])").click(function(){t._listenerFunction.call(this,t)})}},unlistenOnMathClick:function(){e(this.getSelector()).off("click")},listenerFunction:function(t){e(this).parent().css("color","blue");var n=this.getAttribute("id");var r=document.createElement("div");r.appendChild(document.getElementById(n).cloneNode(true));var i=r.innerHTML;var s=new satree.MathParser(n,satree.ConfigManager.getRenderMode());var o=s.parse();var u=new satree.Disambiguator(o);var a=u.generateTrees();var f=new satree.Panel(n,i,a);f.render()},addControls:function(){var t=this;var n="<div id='satree-math-controls'><h2>Disambiguator Options</h2>"+"Tree Display: <br/>"+"<input type='radio' name='satree-math-mode' value='1' checked> Apply Mode</input><br />"+"<input type='radio' name='satree-math-mode' value='2'> Math Mode</input><br/>"+"<input type='checkbox' name='satree-summarized-mode' /> Summarize Math"+"</div>";e("body").append(n);e("input[name='satree-math-mode']").change(function(){var t=e("input[name='satree-math-mode']:checked").val();if(t==1){satree.ConfigManager.setRenderMode(satree.MathParser.ModeApply)}else{satree.ConfigManager.setRenderMode(satree.MathParser.ModeMath)}});e("input[name='satree-summarized-mode']").change(function(){var t=false;if(e(this).prop("checked")){t=true}satree.ConfigManager.setSummarizedMode(t)})},removeControls:function(){e(document.getElementById("satree-math-controls")).remove()}}});JOBAD.modules.register({info:{identifier:"math.satree",title:"SaTree Module",author:"Tom Wiesing",description:"Enables the SATree library on the page. ",externals:{css:["satree.min.css"]}},config:{tree_display:["list",["apply","math"],"apply",["Tree Display","Apply Mode","Math Mode"]],summarise_math:["bool",false,["Summarize Math"]]},configUpdate:function(e,t){if(e=="tree_display"){if(this.UserConfig.get("tree_display")=="apply"){satree.ConfigManager.setRenderMode(satree.MathParser.ModeApply)}else{satree.ConfigManager.setRenderMode(satree.MathParser.ModeMath)}}if(e=="summarise_math"){satree.ConfigManager.setSummarizedMode(this.UserConfig.get("summarise_math"))}},init:function(e){var t=new satree.Manager(e.element);this.localStore.set("manager",t)},contextMenuEntries:function(e){var e=e.closest("math");if(e.length>0){var t=this.localStore.get("manager");return{SATree:function(){t._listenerFunction.call(e.get(0),t)}}}}})})(jQuery.noConflict(),JOBAD.util);
